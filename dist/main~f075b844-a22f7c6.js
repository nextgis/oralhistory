(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{124:function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var n={brill:'<path d="m6 0-5 6 5 6 5-6z"/>',circle:'<circle cx="6" cy="6" r="6"/>',rect:'<rect width="12" height="12"/>',marker:'<path d="m6 0c-1.85 0-4 1.19-4 4.22 0 2.05 3.08 6.59 4 7.78 0.821-1.19 4-5.62 4-7.78 0-3.03-2.15-4.22-4-4.22z"/>',cross:'<path d="M 2.4,12 6,8.4 9.6,12 12,9.6 8.4,6 12,2.4 9.6,0 6,3.6 2.4,0 0,2.4 3.6,6 0,9.6 Z"/>',star:'<path d="m6 0.25 1.71 4.18 4.29-1.04e-4 -3.43 3.14 0.857 4.18-3.43-3.14-3.43 3.14 0.857-4.18-3.43-3.14 4.29-0.209z"/>',triangle:'<path d="m12 11.7h-12l6-11.2z"/>',plus:'<path d="m7.5 12v-4.5h4.5v-3h-4.5v-4.5h-3v4.5h-4.5v3h4.5v4.5z"/>',minus:'<path d="m12 7.5v-3h-12v3z"/>',asterisk:'<path d="m7.59 12v-3.27l2.83 1.64 1.58-2.74-2.85-1.64 2.83-1.64-1.56-2.74-2.83 1.64v-3.24h-3.17v3.24l-2.85-1.64-1.57 2.74 2.84 1.64-2.84 1.64 1.57 2.74 2.85-1.64v3.27z"/>'};function o(t){void 0===t&&(t={});var e=t.shape||"circle",r=t.color||"blue",o=t.strokeColor||"white",i=t.size||12,a=i/2,s="number"==typeof t.stroke?t.stroke:.8,u=i/12,c=n[e]||"circle",p=function(t,e,r,n){void 0===r&&(r=0);var o=r/2,i='<svg\n    version="1.1"\n    xmlns="http://www.w3.org/2000/svg"\n    width="'+t+'"\n    height="'+e+'"\n    viewBox="-'+o+" -"+o+" "+(t+r)+" "+(e+r)+'"\n  >'+n+"</svg>";return(new DOMParser).parseFromString(i,"image/svg+xml").documentElement}(i,i,s*u,"string"==typeof c?c:c(t)),l=p.firstChild,f="scale("+u+")";return l.setAttribute("fill",r),s&&(l.setAttribute("stroke",o),l.setAttribute("stroke-width",String(s))),l.setAttribute("transform",f),{type:"icon",iconSize:[i,i],iconAnchor:[a,a],html:(new XMLSerializer).serializeToString(p),svg:p}}},127:function(t,e,r){"use strict";var n=r(26),o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},i=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},a=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},s={tms:"TILE"};function u(t){return new Promise((function(e,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState&&200===o.status&&o.responseText)try{e(JSON.parse(o.responseText))}catch(t){r(t)}},o.open("GET",Object(n.c)(t),!0),o.send()}))}function c(t,e){return void 0===e&&(e="https://qms.nextgis.com"),function(){function r(t,e){this.map=t,this.options=e,this.options.baseLayer=!0}return r.prototype.addLayer=function(r){return i(this,void 0,void 0,(function(){var n,i,c,p;return a(this,(function(a){switch(a.label){case 0:return this.qms||!r.qmsId?[3,2]:(n=this,[4,u(e+"/api/v1/geoservices/"+r.qmsId)]);case 1:n.qms=a.sent(),a.label=2;case 2:return(i=this.qms)&&(c=s[i.type||"tms"],(p=t.mapAdapter.layerAdapters[c])&&"TILE"===c)?(r=o(o({maxZoom:t.options.maxZoom,minZoom:t.options.minZoom},this.options),function(t){var e=("https:"===location.protocol?"https":"http")+"://";return{url:t.url.replace(/^(https?|ftp):\/\//,e),name:t.name,attribution:t.copyright_text,maxZoom:t.z_max,minZoom:t.z_min}}(i)),this.options=r,[2,new p(this.map,r).addLayer(r)]):[2]}}))}))},r}()}var p=function(){return(p=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},l=function(){function t(t){this.options={url:"https://qms.nextgis.com"},this.options=p(p({},this.options),t),this.url=this.options.url}return t.prototype.getLayerAdapters=function(){var t=this;return Promise.resolve([{name:"QMS",createAdapter:function(e){return Promise.resolve(t._createAdapter(e))}}])},t.prototype._createAdapter=function(t){return c(t,this.url)},t.utils={createQmsAdapter:c},t}();e.a=l},167:function(t,e,r){"use strict";var n,o=r(38);try{n=r(306)}catch(t){}function i(t,e){var r=window.document.createElement("canvas"),o=r.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");if(r.setAttribute("width",String(e.width)),r.setAttribute("height",String(e.height)),!n&&t instanceof HTMLImageElement)o.drawImage(t,0,0,e.width,e.height);else if("string"==typeof t){if(n.Canvg)n.Canvg.fromString(o,t).start();else n(r,t)}return o.getImageData(0,0,e.width,e.height)}var a=0,s=function(t,e){this.map=t,this.options=e,this._layerId="layer-"+a++},u={circle:[["fillColor","color"],["fillOpacity","opacity"],["strokeColor","stroke-color"],["strokeOpacity","stroke-opacity"],["weight","stroke-width"],"radius"],line:[["strokeColor","color"],["strokeOpacity","opacity"],["weight","width"]],fill:[["fillColor","color"],["fillOpacity","opacity"]],icon:["color","opacity"].concat([])},c={Point:"circle",LineString:"line",MultiPoint:"circle",Polygon:"fill",MultiLineString:"line",MultiPolygon:"fill",GeometryCollection:"fill"},p={circle:"Point",line:"LineString",fill:"Polygon",icon:"Point"},l={icon:["Point"]};for(var f in c){var h=c[f],y=l[h]||[];y.push(f),l[h]=y}function d(t){for(var e={},r=0;r<t.length;r++)e[t[r]]=1+(e[t[r]]||0);var n="";for(var o in e){var i=n?e[n]:0;e[o]>i&&(n=o)}return n}function v(t,e){var r=l[e];return!!r&&-1!==r.indexOf(t)}var m,b=(m=function(t,e){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}m(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),_=function(){return(_=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},g=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},w=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},O=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},L={gt:">",lt:"<",ge:">=",le:"<=",eq:"==",ne:"!=",in:"in",notin:"!in",like:"==",ilike:"=="},I={gt:L.le,lt:L.ge,ge:L.lt,le:L.gt,eq:L.ne,ne:L.eq,in:L.notin,notin:L.in,like:L.ne,ilike:L.ne},P={color:"blue",opacity:1,radius:10},x=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.map=e,n.options=r,n.selected=!1,n.featureIdName="id",n._types=["fill","circle","line"],n._selectedFeatureIds=[],n._sourceId=n.options.source?n.options.source:"source-"+n._layerId,n.options.featureIdName?n.featureIdName=n.options.featureIdName:n.options.source?n.featureIdName="$id":n.featureIdName="_fid",n._selectionName=n._layerId+"-highlighted",n.$onLayerClick=n._onLayerClick.bind(n),n}return b(e,t),e.prototype.addLayer=function(t){return g(this,void 0,void 0,(function(){var e,r,n,o,i,a,s,u,c;return w(this,(function(l){switch(l.label){case 0:if(t=this.options=_(_({},this.options),t||{}),this.layer=[],e=this._types=t.type?[t.type]:this._types,!t.paint)return[3,5];this._onAddLayer(this._sourceId),r=0,n=e,l.label=1;case 1:return r<n.length?(o=n[r],(i=p[o])?(a=o,"circle"===o&&"icon"===this._detectPaintType(t.paint)&&(a="icon"),s=this._getLayerNameFromType(o),u=e.length>1?["==","$type",i]:void 0,[4,this._addLayer(s,a,[u,this._getNativeFilter()])]):[3,4]):[3,5];case 2:return l.sent(),this.layer.push(s),t.selectedPaint?(c=this._getSelectionLayerNameFromType(o),[4,this._addLayer(c,a,[u,["in",this.featureIdName,""]],this.options.selectedLayout)]):[3,4];case 3:l.sent(),this.layer.push(c),l.label=4;case 4:return r++,[3,1];case 5:return this._addEventsListeners(),[2,this.layer]}}))}))},e.prototype.propertiesFilter=function(t,e){this._filterProperties=t,this._updatePropertiesFilter()},e.prototype.removeFilter=function(){this._filterProperties=void 0,this._updateFilter()},e.prototype.select=function(t){"function"!=typeof t&&(this._selectProperties=t,this._updateFilter()),this.selected=!0},e.prototype.unselect=function(){this._selectProperties=void 0,this._updateFilter(),this.selected=!1},e.prototype.removeLayer=function(){var t=this.map;this.layer&&this.layer.forEach((function(e){t.removeLayer(e)}))},e.prototype._updateWithNativeFilter=function(t){var e=this._getNativeFilter();return e.length&&t.push(e),t},e.prototype._getNativeFilter=function(){return this.options.nativeFilter?this.options.nativeFilter:[]},e.prototype._addLayer=function(t,e,r,n){return g(this,void 0,void 0,(function(){var o,i,a,s,u,c;return w(this,(function(p){return o=this.options,i=o.minZoom,a=o.maxZoom,s="icon"===e?"symbol":e,n=n||this.options.layout||{},u=_({id:t,type:s,source:this._sourceId,layout:_({visibility:"none"},n)},this._getAdditionalLayerOptions()),i&&(u.minzoom=i-1),a&&(u.maxzoom=a-1),this.map.addLayer(u),(c=O(["all"],r||[]).filter((function(t){return t}))).length>1&&this.map.setFilter(u.id,c),[2]}))}))},e.prototype._onAddLayer=function(t,e){},e.prototype._updateLayerPaint=function(t){return g(this,void 0,void 0,(function(){var e,r,n,o,i,a,s,u,c,p;return w(this,(function(l){switch(l.label){case 0:if(e=this._getLayerNameFromType(t),!this.options.paint)return[3,6];r=[[e,this.options.paint]],this.options.selectedPaint&&(n=this._getSelectionLayerNameFromType(t),r.push([n,this.options.selectedPaint])),o=0,i=r,l.label=1;case 1:return o<i.length?(a=i[o],s=a[0],u=a[1],c=void 0,this.options.nativePaint?(c="boolean"==typeof this.options.nativePaint?u:this.options.nativePaint,[3,4]):[3,2]):[3,6];case 2:return[4,this._createPaintForType(u,t,s)];case 3:c=l.sent(),l.label=4;case 4:if("icon-image"in c)for(p in c["icon-allow-overlap"]=!0,c)this.map.setLayoutProperty(s,p,c[p]);else for(p in c)this.map.setPaintProperty(s,p,c[p]);l.label=5;case 5:return o++,[3,1];case 6:return[2]}}))}))},e.prototype._getLayerNameFromType=function(t){return t+"-"+this._layerId},e.prototype._getSelectionLayerNameFromType=function(t){return t+"-"+this._selectionName},e.prototype._createPaintForType=function(t,e,r){return g(this,void 0,void 0,(function(){var r,n,o,i;return w(this,(function(a){switch(a.label){case 0:return"function"==typeof t?[3,3]:(r={},n=_(_({},P),t||{}),"icon"===t.type&&t.html?[4,this._registerImage(t)]:[3,2]);case 1:return a.sent(),[2,{"icon-image":t.html}];case 2:for(i in o=function(t){var o=u[e];if(o){var i=o.find((function(e){return"string"==typeof e?e===t:!!Array.isArray(e)&&e[0]===t}));if(i){var a=Array.isArray(i)?i[1]:i;r[e+"-"+a]=n[t]}}},n)o(i);return r[e+"-opacity-transition"]={duration:0},[2,r];case 3:return[2]}}))}))},e.prototype._getFeatureFilterId=function(t){var e=t._featureFilterId;return void 0!==e?e:t.properties&&void 0!==t.properties[this.featureIdName]?t.properties[this.featureIdName]:t.id},e.prototype._registerImage=function(t){return g(this,void 0,void 0,(function(){var e,r,o;return w(this,(function(a){switch(a.label){case 0:return t.html?this.map.hasImage(t.html)?[3,2]:(e=12,r=12,t.iconSize&&(e=t.iconSize[0],r=t.iconSize[1]),[4,(s=t.html,u={width:e,height:r},new Promise((function(t){if(n)t(i(s,u));else{var e=new Image;e.crossOrigin="Anonymous",e.src="data:image/svg+xml;base64,"+btoa(s),e.onload=function(){var r=i(e,u);t(r)}}})))]):[3,2];case 1:o=a.sent(),this.map.addImage(t.html,o),a.label=2;case 2:return[2]}var s,u}))}))},e.prototype._selectFeature=function(t){},e.prototype._unselectFeature=function(t){},e.prototype._getAdditionalLayerOptions=function(){return{}},e.prototype._updateFilter=function(){this._updatePropertiesFilter()},e.prototype._updatePropertiesFilter=function(){var t=this,e=this.layer;e&&this._types.forEach((function(r){var n=p[r];if(n){var o=["==","$type",n],i=t._getLayerNameFromType(r),a=t._getSelectionLayerNameFromType(r),s=t._selectProperties,u=t._filterProperties,c=u&&t._convertToMapboxFilter(u);if(-1!==e.indexOf(a)&&t._selectionName){var l=[];s||t._selectedFeatureIds?(s?l=t._convertToMapboxFilter(s)||[]:t._selectedFeatureIds&&(l=[O(["in",t.featureIdName],t._selectedFeatureIds)]),c&&c.forEach((function(t){return l.push(t)})),t.map.setFilter(a,O(["all",o],l))):(l=["in","$id",""],t.map.setFilter(a,l))}if(-1!==e.indexOf(i)){var f=["all",o];if(t._updateWithNativeFilter(f),s)t._convertToMapboxFilter(s,!0).forEach((function(t){return f.push(t)}));else t._selectedFeatureIds&&f.push(O(["!in",t.featureIdName],t._selectedFeatureIds));c&&c.forEach((function(t){return f.push(t)})),t.map.setFilter(i,f)}}}))},e.prototype._convertToMapboxFilter=function(t,e){void 0===e&&(e=!1);var r=e?I:L;return t.map((function(t){if("string"==typeof t)return t;if(Object(o.a)(t)){var e=t[0],n=t[1],i=t[2],a=r[n];return"in"===n||"notin"===n?O([a,e],i):[a,e,i]}}))},e.prototype.isFeatureSelected=function(t){if(this._selectedFeatureIds){var e=this._getFeatureFilterId(t);if(e)return-1!==this._selectedFeatureIds.indexOf(e)}return!1},e.prototype._onLayerClick=function(t){var e=this;if(t.preventDefault(),this.layer){var r=this.layer.reduce((function(r,n){var o=e.map.queryRenderedFeatures(t.point,{layers:[n]});return r.concat(o)}),[])[0];if(r){var n=this.isFeatureSelected(r);n?this.options&&this.options.unselectOnSecondClick&&this._unselectFeature(r):this._selectFeature(r),n=this.isFeatureSelected(r),this.options.onLayerClick&&this.options.onLayerClick({layer:this,feature:r,selected:n})}}},e.prototype._detectPaintType=function(t){if("type"in t)return t.type;if("function"==typeof t)try{var e=t({type:"Feature",properties:{},geometry:{}});return this._detectPaintType(e)}catch(t){}},e.prototype._addEventsListeners=function(){var t=this;this.layer&&this.options&&this.options.selectable&&this.layer.forEach((function(e){if(t.$onLayerClick){var r=t.$onLayerClick;t.map.on("click",e,(function(t){r(t)}))}t.map.on("mousemove",e,(function(){t.map.getCanvas().style.cursor="pointer"})),t.map.on("mouseleave",e,(function(){t.map.getCanvas().style.cursor=""}))}))},e}(s),k=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),F=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},E=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},S=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k(e,t),e.prototype.addLayer=function(e){return F(this,void 0,void 0,(function(){var r;return E(this,(function(n){switch(n.label){case 0:return[4,t.prototype.addLayer.call(this,e)];case 1:return r=n.sent(),this._updateLayerPaint(this.options.type||"fill"),[2,r]}}))}))},e.prototype._getAdditionalLayerOptions=function(){return e.sources.includes(this.options.url)||(this.map.addSource(this.options.url,{type:"vector",tiles:[this.options.url]}),this.source=this.options.url,e.sources.push(this.options.url)),{source:this.options.url,"source-layer":this.options.sourceLayer}},e.sources=[],e}(x),C=r(51),A=r.n(C),j=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),N=function(){return(N=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype.addLayer=function(t){var e,r=(t=N(N({},this.options),t||{})).minZoom,n=t.maxZoom;(e=t&&t.subdomains?t.subdomains.split("").map((function(e){return t.url.replace("{s}",e)})):[t.url],t.headers)&&this.map.transformRequests.push((function(e,r){var n=e;if((n=(n=(n=n.replace(/(z=\d+)/,"z={z}")).replace(/(x=\d+)/,"x={x}")).replace(/(y=\d+)/,"y={y}"))===t.url)return{url:e,headers:t.headers}}));var o={type:"raster",tiles:e,tileSize:256};t.attribution&&(o.attribution=t.attribution);var i={id:this._layerId,type:"raster",layout:{visibility:"none"},source:o};return r&&(i.minzoom=r-1),n&&(i.maxzoom=n-1),this.map.addLayer(i,t.before),this.layer=[this._layerId]},e}(s),M=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),R={url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright" target="_blank">OpenStreetMap</a> contributors',subdomains:"abc"},G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return M(e,t),e.prototype.addLayer=function(e){return t.prototype.addLayer.call(this,Object.assign({},R,e))},e}(T),q=r(41),D=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),z=function(){return(z=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Z=function(t){function e(e){void 0===e&&(e={});return e=z(z({},e),{showCompass:!1}),t.call(this,e)||this}return D(e,t),e.prototype._createButton=function(e,r,n){var o=t.prototype._createButton.call(this,e,r,n),i={"Zoom in":"zoomInTitle","Zoom out":"zoomOutTitle"}[r],a=i&&this.options[i];return a&&(o.title=a,o.setAttribute("aria-label",a)),o},e}(C.NavigationControl),B=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),U=function(t){function e(e){void 0===e&&(e={});return e=Object.assign({},e,{showZoom:!1}),t.call(this,e)||this}return B(e,t),e}(C.NavigationControl),Q=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Q(e,t),e}(C.AttributionControl),H=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),J=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},V=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},$=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},X=0,K=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.map=e,n.options=r,n.selected=!1,n._features=[],n._sources={},n.source=n._sourceId,n}return H(e,t),e.prototype.addLayer=function(e){return J(this,void 0,void 0,(function(){var r;return V(this,(function(n){switch(n.label){case 0:return[4,t.prototype.addLayer.call(this,e)];case 1:return r=n.sent(),this.options.data&&this.addData(this.options.data),[2,r]}}))}))},e.prototype.removeLayer=function(){t.prototype.removeLayer.call(this),this.map.getSource(this._sourceId)&&this.map.removeSource(this._sourceId)},e.prototype.clearLayer=function(t){var e=[],r=this.map.getSource(this._sourceId);t&&(e=this._features=this._features.filter((function(e){return!t(e)}))),r.setData({type:"FeatureCollection",features:e})},e.prototype.addData=function(t){return J(this,void 0,void 0,(function(){var e,r,n=this;return V(this,(function(o){switch(o.label){case 0:return this.options.type&&(e=this.options.type),!e&&t&&(r=function(t){var e;if("FeatureCollection"===t.type)e=d(t.features.map((function(t){return t.geometry.type})));else if("GeometryCollection"===t.type){e=d(t.geometries.map((function(t){return t.type})))}else e="Feature"===t.type?t.geometry.type:t.type;return e}(t),e=c[r]),t&&e?(this.filterGeometries(t,e).forEach((function(t){var e="_"+X++;t._featureFilterId=e,t.properties&&(t.properties[n.featureIdName]=e)})),this._filterFun&&this._filter(this._filterFun),[4,this._updateLayerPaint(e)]):[3,2];case 1:o.sent(),this.map.getSource(this._sourceId).setData({type:"FeatureCollection",features:this._features}),o.label=2;case 2:return[2]}}))}))},e.prototype.getLayers=function(){var t=this,e=this._filteredFeatureIds;return this._getFeatures().map((function(r){var n=!1;if(e){var o=t._getFeatureFilterId(r);void 0!==o&&(n=-1!==e.indexOf(o))}return{feature:r,visible:n}}))},e.prototype.filter=function(t){this._filterFun=t,this._filter(t)},e.prototype.removeFilter=function(){this._filterFun=void 0,this._filteredFeatureIds=void 0,this._updateFilter()},e.prototype.getSelected=function(){var t=this,e=[];return this._getFeatures().forEach((function(r){var n=t._getFeatureFilterId(r);n&&t._selectedFeatureIds&&-1!==t._selectedFeatureIds.indexOf(n)&&e.push({feature:r})})),e},e.prototype.select=function(e){if(e)if("function"==typeof e){var r=this._getFeatures().filter((function(t){return e({feature:t})}));this._selectFeature(r)}else this.selected=!0,this._selectProperties=e,t.prototype._updateFilter.call(this);else this.selected||this._selectFeature(this._getFeatures())},e.prototype.unselect=function(t){if(this._selectProperties=void 0,t){if("function"==typeof t){var e=this._getFeatures().filter((function(e){return t({feature:e})}));this._unselectFeature(e),this.selected=!!Array.isArray(this._selectedFeatureIds)}}else this.selected&&(this.selected=!1,this._unselectFeature())},e.prototype._onAddLayer=function(t){var e=this,r=this.map.getSource(t);if(!r){var n={type:"geojson",data:{type:"FeatureCollection",features:[]}};["cluster","clusterMaxZoom","clusterRadius"].forEach((function(t){var r=e.options[t];void 0!==r&&(n[t]=r)})),this.map.addSource(t,n),r=this.map.getSource(t)}this._sources[t]=r,this.options.type&&this._updateLayerPaint(this.options.type)},e.prototype._createPaintForType=function(e,r,n){return J(this,void 0,void 0,(function(){return V(this,(function(o){switch(o.label){case 0:return"function"!=typeof e?[3,2]:[4,this._getPaintFromCallback(e,r,n)];case 1:return[2,o.sent()];case 2:return[2,t.prototype._createPaintForType.call(this,e,r,n)]}}))}))},e.prototype._selectFeature=function(t){var e=this,r=this._selectedFeatureIds||[];this.options&&!this.options.multiselect&&(r=[]);(Array.isArray(t)?t:[t]).forEach((function(t){var n=e._getFeatureFilterId(t);void 0!==n&&r.push(n)})),this._selectedFeatureIds=r,this._updateFilter()},e.prototype._unselectFeature=function(t){var e=this;if(t){var r=[];(r=Array.isArray(t)?t:[t]).length&&r.forEach((function(t){var r=e._getFeatureFilterId(t),n=e._selectedFeatureIds;if(n&&void 0!==r){var o=n.indexOf(r);-1!==o&&n.splice(o,1)}}))}else this._selectedFeatureIds=!1;this._updateFilter()},e.prototype._updateFilter=function(){var e=this;if(this._filterProperties||this._selectProperties)return t.prototype._updateFilter.call(this);var r=this._selectedFeatureIds,n=[],o=[],i=this._filteredFeatureIds;i?this._getFeatures().forEach((function(t){var a=e._getFeatureFilterId(t);void 0!==a&&-1!==i.indexOf(a)&&(r&&-1!==r.indexOf(a)?n.push(a):o.push(a))})):r&&(n=r),this.selected=!!r;var a=this.layer;a&&this._types.forEach((function(t){var r=p[t];if(r){var s=["==","$type",r],u=e._getLayerNameFromType(t),c=e._getSelectionLayerNameFromType(t);if(-1!==a.indexOf(c)&&e._selectionName&&e.map.setFilter(c,["all",s,$(["in",e.featureIdName],n)]),-1!==a.indexOf(u)){var l=["all",s];i?l.push($(["in",e.featureIdName],o)):(l.push($(["!in",e.featureIdName],n)),e._updateWithNativeFilter(l)),e.map.setFilter(u,l)}}}))},e.prototype._getFeatures=function(){return this.source?this.map.querySourceFeatures(this.source):this._features},e.prototype._filter=function(t){var e=this,r=[];this._getFeatures().forEach((function(n){var o=t({feature:n}),i=e._getFeatureFilterId(n);o&&i&&r.push(i)})),this._filteredFeatureIds=r,this._updateFilter()},e.prototype.filterGeometries=function(t,e){var r=[];if("FeatureCollection"===t.type){var n=t.features.filter((function(t){return v(t.geometry.type,e)}));t.features=n,r=n}else if("Feature"===t.type){if(!v(t.geometry.type,e))return[];r.push(t)}else if("GeometryCollection"===t.type){var o=t;o.geometries=o.geometries.filter((function(t){return v(t.type,e)})),r=o.geometries.map((function(t){return{type:"Feature",geometry:t,properties:{}}}))}else if(c[t.type]){r=[{type:"Feature",geometry:t,properties:{}}]}return this._features=this._features.concat(r),r},e.prototype._getPaintFromCallback=function(t,e,r){return J(this,void 0,void 0,(function(){var n,o,i,a,s,u,c;return V(this,(function(p){switch(p.label){case 0:n={},o=0,i=this._features,p.label=1;case 1:return o<i.length?(a=i[o],"icon"!==(s=t(a)).type?[3,3]:[4,this._registerImage(s)]):[3,5];case 2:return p.sent(),a.properties&&(a.properties["_icon-image-"+r]=s.html),n["icon-image"]="{_icon-image-"+r+"}",[3,4];case 3:for(u in s)c=s[u],a.properties&&(a.properties["_paint_"+u+"_"+r]=c),n[u]=["get","_paint_"+u+"_"+r];p.label=4;case 4:return o++,[3,1];case 5:return"icon-image"in n?[2,n]:[2,this._createPaintForType(n,e,r)]}}))}))},e}(x);function Y(t,e){return void 0===e&&(e={}),new(function(){function r(){}return r.prototype.getDefaultPosition=function(){return"top-left"},r.prototype.onAdd=function(){var r=document.createElement("div"),n=t.onAdd();return r.classList.add("mapboxgl-ctrl"),e.bar&&r.classList.add("mapboxgl-bar"),e.addClass&&r.classList.add(e.addClass),r.appendChild(n),this._container=r,this._container},r.prototype.onRemove=function(){if(this._container){var e=this._container.parentNode;e&&e.removeChild(this._container)}return t.onRemove()},r.prototype.remove=function(){this.onRemove()},r}())}var tt=function(){return(tt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},et={},rt=function(){function t(){this.options={},this.emitter=new q.EventEmitter,this.layerAdapters=t.layerAdapters,this.controlAdapters=t.controlAdapters,this.isLoaded=!1,this._universalEvents=["zoomstart","zoom","zoomend","movestart","move","moveend"],this._sourceDataLoading={}}return t.prototype.create=function(t){var e=this;return new Promise((function(r,n){if(!e.map&&(e.options=t,t.accessToken&&(A.a.accessToken=t.accessToken),t.target)){var o={container:t.target,attributionControl:!1,bounds:t.bounds,fitBoundsOptions:tt(tt({},t.fitOptions),et),transformRequest:function(t,r){var n=e._transformRequest(t,r);return n||{url:t}}};"string"==typeof t.style?o.style=t.style:o.style=tt({version:8,name:"Empty style",sources:{},layers:[]},t.style),void 0!==t.center&&(o.center=t.center),void 0!==t.zoom&&(o.zoom=t.zoom-1),t.maxZoom&&(o.maxZoom=t.maxZoom-1),t.minZoom&&(o.minZoom=t.minZoom-1),e.map=new C.Map(o),e.map.once("load",(function(){e.map.transformRequests=[],e.isLoaded=!0,e.emitter.emit("create",e),r(e)})),e._addEventsListeners()}}))},t.prototype.destroy=function(){this.map&&this.map.remove()},t.prototype.getContainer=function(){return this.map&&this.map.getContainer()},t.prototype.setView=function(t,e){if(this.map){var r={center:t};e&&(r.zoom=e-1),this.map.jumpTo(r)}},t.prototype.setCenter=function(t){this.map&&this.map.setCenter(t)},t.prototype.getCenter=function(){if(this.map){var t=this.map.getCenter();return[t.lng,t.lat]}},t.prototype.setZoom=function(t){this.map&&this.map.setZoom(t-1)},t.prototype.getZoom=function(){if(this.map){var t=this.map.getZoom();return t?t+1:void 0}},t.prototype.fitBounds=function(t,e){void 0===e&&(e={}),this.map&&this.map.fitBounds([[t[0],t[1]],[t[2],t[3]]],tt(tt({linear:!0},e),et))},t.prototype.setRotation=function(t){},t.prototype.showLayer=function(t){var e=this;t.forEach((function(t){e._toggleLayer(t,!0)}))},t.prototype.hideLayer=function(t){var e=this;t.forEach((function(t){e._toggleLayer(t,!1)}))},t.prototype.removeLayer=function(t){if(this.map){var e=this.map;t.forEach((function(t){e.removeLayer(t),e.getSource(t)&&e.removeSource(t)}))}},t.prototype.setLayerOrder=function(t,e,r){var n=this;this._sortTimerId&&window.clearTimeout(this._sortTimerId),this._sortTimerId=window.setTimeout((function(){return n._setLayerOrder(r)}))},t.prototype.setLayerOpacity=function(t,e){var r=this,n=this.map;n&&t.forEach((function(t){r._onMapLoad().then((function(){var r=n.getLayer(t);r&&("symbol"===r.type?(n.setPaintProperty(t,"text-opacity",e),n.setPaintProperty(t,"icon-opacity",e)):n.setPaintProperty(t,r.type+"-opacity",e))}))}))},t.prototype.createControl=function(t,e){return Y(t,e)},t.prototype.createButtonControl=function(t){return function(t){var e=document.createElement("button");if(e.className="mapboxgl-ctrl-icon",e.setAttribute("role","button"),t.title&&(e.title=t.title,e.setAttribute("aria-label",t.title)),t.html){t.html instanceof HTMLElement?e.appendChild(t.html):e.innerHTML=t.html;var r=e.firstElementChild;r&&(r.style.width="100%",r.style.height="100%",r.style.lineHeight=(e.offsetHeight||30)+"px")}t.addClass&&t.addClass.split(" ").forEach((function(t){return e.classList.add(t)}));var n=function(e){e.stopPropagation(),t.onClick()};return void 0!==t.onClick&&e.addEventListener("click",n),Y({onAdd:function(){return e},onRemove:function(){var r=e.parentNode;r&&r.removeChild(e),void 0!==t.onClick&&e.removeEventListener("click",n)}},{bar:!0,addClass:"mapboxgl-ctrl-group"})}(t)},t.prototype.addControl=function(t,e){if(this.map)return this.map.addControl(t,e),t},t.prototype.removeControl=function(t){this.map&&this.map.removeControl(t)},t.prototype.onMapClick=function(t){var e=t.lngLat,r=t.point,n=r.x,o=r.y;this.emitter.emit("click",{latLng:e,pixel:{top:o,left:n}})},t.prototype._onMapLoad=function(t){var e=this;return new Promise((function(r){var n=function(){t&&t(),e.map&&r(e.map)};e.isLoaded?n():e.map&&e.emitter.once("create",(function(){n()}))}))},t.prototype._setLayerOrder=function(t){var e=this.map;if(e){var r=[],n=[];for(var o in t){var i=t[o];i.options.baseLayer?r.push(i):n.push(i)}n=n.sort((function(t,e){return void 0!==t.options.order&&void 0!==e.options.order?t.options.order-e.options.order:0}));for(var a=function(t){var r=n[t+1],o=r&&r.layer&&r.layer[0],i=n[t];s._getLayerIds(i).forEach((function(t){e.moveLayer(t,o)}))},s=this,u=0;u<n.length;u++)a(u);var c=n.find((function(t){return Array.isArray(t.layer)}));if(c){var p=this._getLayerIds(c)[0];r.forEach((function(t){t.layer&&t.layer.forEach((function(t){e.moveLayer(t,p)}))}))}}},t.prototype._getLayerIds=function(t){var e=[];if(t)if(Array.isArray(t.layer))e=t.layer;else if(t.getDependLayers){t.getDependLayers().forEach((function(t){var r=t.layer&&t.layer.layer||t;Array.isArray(r)&&r.forEach((function(t){e.push(t)}))}))}return e},t.prototype._toggleLayer=function(t,e){this._onMapLoad().then((function(r){r.setLayoutProperty(t,"visibility",e?"visible":"none")}))},t.prototype._onMapSourceData=function(t){var e=this;if("source"===t.dataType){var r=t.isSourceLoaded;this._onDataLoad(t,r,(function(t){e.emitter.emit("data-loaded",{target:t})}))}},t.prototype._onMapError=function(t){var e=this;if(this._sourceDataLoading[t.sourceId]){var r=t.isSourceLoaded;this._onDataLoad(t,r,(function(t){e.emitter.emit("data-error",{target:t})}))}},t.prototype._onDataLoad=function(t,e,r){if(void 0===e&&(e=!1),e)Object.keys(this._sourceDataLoading).forEach((function(t){r(t)})),this._sourceDataLoading={};else{var n=this._sourceDataLoading[t.sourceId];if(n&&t.tile){var o=n.indexOf(t.tile);-1!==o&&this._sourceDataLoading[t.sourceId].splice(o,1),n.length||(r(t.sourceId),delete this._sourceDataLoading[t.sourceId])}}},t.prototype._transformRequest=function(t,e){var r=this.map&&this.map.transformRequests;if(r)for(var n=0,o=r;n<o.length;n++){var i=(0,o[n])(t,e);if(i)return i}else;},t.prototype._addEventsListeners=function(){var t=this,e=this.map;e&&(e.on("sourcedataloading",(function(e){t._sourceDataLoading[e.sourceId]=t._sourceDataLoading[e.sourceId]||[],e.tile&&t._sourceDataLoading[e.sourceId].push(e.tile)})),e.on("sourcedata",this._onMapSourceData.bind(this)),e.on("error",this._onMapError.bind(this)),e.on("click",(function(e){t.onMapClick(e)})),this._universalEvents.forEach((function(r){e.on(r,(function(){return t.emitter.emit(r,t)}))})))},t.layerAdapters={TILE:T,MVT:S,OSM:G,GEOJSON:K},t.controlAdapters={ZOOM:Z,COMPASS:U,ATTRIBUTION:W},t}();e.a=rt},223:function(t,e,r){"use strict";var n=r(41),o=r(26),i=r(38),a=r(30),s=r(36),u=r(124);function c(){return i.b.decorators.onLoad("build-map")}var p=r(127),l=function(){return(l=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function f(t,e,r,n){if("number"==typeof e||"string"==typeof e)e=Number(e),t.push(l(l({},r),{resourceId:e}));else if(Array.isArray(e)){var o=e[0],i=e[1];t.push(l(l(l({},r),{resourceId:o,id:i}),n))}else"object"==typeof e&&t.push(l(l(l({},r),e),n))}var h={target:"map",baseUrl:"",controls:["ZOOM","ATTRIBUTION"],controlsOptions:{ZOOM:{position:"top-left"},ATTRIBUTION:{position:"bottom-right",customAttribution:['<a href="http://nextgis.ru" target="_blank">©NextGIS</a>']}},pixelRadius:10};var y,d=(y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),v=function(){return(v=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},m=function(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},b=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},_=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},g=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},w=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r},O=function(t){function e(e,r){var i=t.call(this,function(t,e){var r=[new p.a];!e.connector&&e.baseUrl?e.connector=new a.b({baseUrl:e.baseUrl,auth:e.auth}):e.connector&&(e.baseUrl=e.connector.options.baseUrl);var n=Object(o.b)(h,e);return n.connector&&r.push(new s.a({connector:n.connector,auth:n.auth,identification:n.identification})),{mapAdapter:t,starterKits:r,runtimeParams:e.runtimeParams}}(e,r))||this;return i.emitter=new n.EventEmitter,i.options={},i._ngwLayers={},r.connector&&(i.connector=r.connector),i.options=Object(o.b)(h,r),i._createWebMap().then((function(){var t=i.getContainer();t&&t.classList.add("ngw-map-container"),i._addControls()})),i}return d(e,t),e.prototype.fit=function(){var t=this.options,e=t.center,r=t.zoom,n=t.bounds;e?(this.setCenter(e),r&&this.setZoom(r)):n&&this.fitBounds(n)},e.prototype.addControl=function(e,r,n){return _(this,void 0,void 0,(function(){return g(this,(function(o){return[2,t.prototype.addControl.call(this,e,r,n)]}))}))},e.prototype.addNgwLayer=function(t){return _(this,void 0,void 0,(function(){var e,r,n,o,i,a;return g(this,(function(u){switch(u.label){case 0:if(e=t.keyname,r=t.resourceId,!e&&!r)throw new Error("resourceId or keyname is required parameter to add NGW layer");if(!this.options.baseUrl&&""!==this.options.baseUrl)return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),n=s.a.utils.addNgwLayer(t,this,this.options.baseUrl,this.connector),[4,this.addLayer(n,v(v({visibility:!0},t),t.adapterOptions))];case 2:return o=u.sent(),i=o&&this.getLayerId(o),o&&i&&(this._ngwLayers[i]={layer:o,resourceId:o.resourceId},o.options.baseLayer&&this.getActiveBaseLayer()),[2,o];case 3:return a=u.sent(),console.error("can't add ngw layer",a),[3,4];case 4:return[2]}}))}))},e.prototype.getNgwLayerItem=function(t){return _(this,void 0,a.a,(function(){return g(this,(function(e){return[2,s.a.utils.getNgwLayerItem(v({connector:this.connector},t))]}))}))},e.prototype.getNgwLayerItems=function(t){return _(this,void 0,a.a,(function(){return g(this,(function(e){return[2,s.a.utils.getNgwLayerItems(v({connector:this.connector},t))]}))}))},e.prototype.getNgwLayerFeature=function(t){return _(this,void 0,a.a,(function(){return g(this,(function(e){return[2,s.a.utils.getNgwLayerFeature(v({connector:this.connector},t))]}))}))},e.prototype.getNgwLayerFeatures=function(t){return _(this,void 0,a.a,(function(){return g(this,(function(e){return[2,s.a.utils.getNgwLayerFeatures(v({connector:this.connector},t))]}))}))},e.prototype.getIdentifyGeoJson=function(t,e){return void 0===e&&(e=!1),_(this,void 0,a.a,(function(){return g(this,(function(r){return[2,s.a.utils.getIdentifyGeoJson({identify:t,connector:this.connector,multiple:e})]}))}))},e.prototype.getNgwLayers=function(){return _(this,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,this.onLoad()];case 1:return t.sent(),[2,this._ngwLayers]}}))}))},e.prototype.getNgwLayerByResourceId=function(t){return _(this,void 0,void 0,(function(){var e,r,n,o,i,a,s,u;return g(this,(function(c){switch(c.label){case 0:for(r in e=[],this._ngwLayers)e.push(r);n=0,c.label=1;case 1:return n<e.length?(o=e[n],(i=this._ngwLayers[o]).resourceId!==t?[3,2]:[2,i&&i.layer]):[3,6];case 2:return i.layer.getIdentificationIds?[4,i.layer.getIdentificationIds()]:[3,4];case 3:if((a=c.sent())&&a.some((function(e){return e===t})))return[2,i.layer];c.label=4;case 4:if(i.layer.getDependLayers&&(s=i.layer.getDependLayers(),u=s.find((function(e){return e.item&&e.item.parentId===t}))))return[2,u.layer];c.label=5;case 5:return n++,[3,1];case 6:return[2]}}))}))},e.prototype.zoomToLayer=function(t){return _(this,void 0,void 0,(function(){var e,r,n,o,i,a=this;return g(this,(function(u){switch(u.label){case 0:return e="string"==typeof t||"number"==typeof t?String(e):t.id,(r=e&&this._ngwLayers[e])?r.layer.getExtent?[4,r.layer.getExtent()]:[3,2]:[3,6];case 1:return(n=u.sent())&&this.fitBounds(n),[3,6];case 2:return o=void 0,r.layer.item?(o=r.layer.item,[3,5]):[3,3];case 3:return i=r.resourceId,[4,this.connector.get("resource.item",null,{id:i})];case 4:o=u.sent(),u.label=5;case 5:s.a.utils.getNgwResourceExtent(o,this.connector).then((function(t){t&&a.fitBounds(t)})),u.label=6;case 6:return[2]}}))}))},e.prototype.onLoad=function(e){return void 0===e&&(e="ngw-map:create"),t.prototype.onLoad.call(this,e)},e.prototype.removeLayer=function(e){var r=this.getLayer(e);if(r){var n=this.getLayerId(r);n&&delete this._ngwLayers[n],t.prototype.removeLayer.call(this,r)}},e.prototype.enableSelection=function(){var t=this;this.__selectFromNgwRaster||(this.__selectFromNgwRaster=function(e){return t._selectFromNgwRaster(e)},this.__selectFromNgwVector=function(e){return t._selectFromNgwVector(e)},this.emitter.on("click",this.__selectFromNgwRaster),this.emitter.on("layer:click",this.__selectFromNgwVector))},e.prototype.disableSelection=function(){this.__selectFromNgwRaster&&(this.emitter.off("click",this.__selectFromNgwRaster),this.emitter.off("click",this._selectFromNgwVector),this.__selectFromNgwRaster=void 0,this.__selectFromNgwVector=void 0)},e.prototype._isFitFromResource=function(){var t=this._initMapState;return!t.zoom||!t.center},e.prototype._createWebMap=function(){return _(this,void 0,void 0,(function(){var t,e,r,n,o,i,a,s,u=this;return g(this,(function(c){switch(c.label){case 0:return[4,this.create(v({},this.options))];case 1:return c.sent(),this.options.qmsId?(t=void 0,e=void 0,Array.isArray(this.options.qmsId)?(t=this.options.qmsId[0],e=this.options.qmsId[1]):t=Number(this.options.qmsId),r={qmsId:t},e&&(r.id=e),[4,this.addBaseLayer("QMS",r).then((function(t){u.showLayer(t)}))]):[3,3];case 2:c.sent(),c.label=3;case 3:n=[],o=this._isFitFromResource(),this.options.webmapId&&f(n,this.options.webmapId,{fit:o}),this.options.resources&&Array.isArray(this.options.resources)&&this.options.resources.forEach((function(t){var e={};o||(e.fit=!1),f(n,t,{},e)})),i=0,a=n,c.label=4;case 4:return i<a.length?(s=a[i],[4,this.addNgwLayer(s)]):[3,7];case 5:c.sent(),c.label=6;case 6:return i++,[3,4];case 7:return this._emitStatusEvent("ngw-map:create",this),this.enableSelection(),[2]}}))}))},e.prototype._addControls=function(){var t=this;this.options.controls&&this.options.controls.forEach((function(e){var r=e,n={};"string"==typeof e&&t.options.controlsOptions&&t.options.controlsOptions[e]&&void 0!==(n=t.options.controlsOptions[e]).control&&(r=n.control);var o=n.position,i=w(n,["position"]);t.addControl(r,o||"top-left",i)})),this._emitStatusEvent("controls:create")},e.prototype._selectFromNgwVector=function(t){return _(this,void 0,void 0,(function(){var e,r,n,o,i,a,s;return g(this,(function(u){return e=t.layer,r=e.item&&e.item.resource.id,n=t.feature,void 0!==r&&n&&(o=n.id)?(i={id:Number(o),fields:n.properties,label:"#"+r,layerId:Number(r),parent:"",geom:n.geometry},(s={featureCount:1})[r]={featureCount:1,features:[i]},a=s,this._emitStatusEvent("ngw:select",v(v({},a),{resources:[r],sourceType:"vector"})),[2,a]):[2]}))}))},e.prototype._selectFromNgwRaster=function(t){return _(this,void 0,void 0,(function(){var e,r,n,o,i,a,u,c,p,l,f=this;return g(this,(function(h){switch(h.label){case 0:for(r in this._emitStatusEvent("ngw:preselect"),e=[],this._ngwLayers)(n=this._ngwLayers[r].layer).getIdentificationIds&&n.options.selectable&&e.push(n.getIdentificationIds());return[4,Promise.all(e)];case 1:return o=h.sent(),i=[],o.forEach((function(t){t&&t.forEach((function(t){return i.push(t)}))})),i.length?(a=this.options.pixelRadius||10,u=this.getCenter(),c=this.getZoom(),u&&c?(p=40075016.686*Math.abs(Math.cos(180*u[1]/Math.PI))/Math.pow(2,c+8),l=a*p*5e-4,[2,s.a.utils.sendIdentifyRequest(t,{layers:i,connector:this.connector,radius:l}).then((function(e){return f._emitStatusEvent("ngw:select",v(v({},e),{resources:i,sourceType:"raster",event:t})),e}))]):(this._emitStatusEvent("ngw:select",null),[2])):(this._emitStatusEvent("ngw:select",null),[2])}}))}))},e.utils=v(v(v({},i.b.utils),s.a.utils),{fixUrlStr:o.c,deepmerge:o.b}),e.decorators=v({onMapLoad:c},i.b.decorators),e.getIcon=u.a,m([i.b.decorators.onLoad("controls:create"),b("design:type",Function),b("design:paramtypes",[Object,String,Object]),b("design:returntype",Promise)],e.prototype,"addControl",null),m([c(),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",Promise)],e.prototype,"addNgwLayer",null),e}(i.b);e.a=O},30:function(t,e,r){"use strict";var n=function(t,e,r,n){try{t(r(n))}catch(t){e(t)}},o=function(){function t(t,e){this.onCancel=e,this._canceled=!1,this._promise=new Promise(t)}return t.resolve=function(e){return new t((function(t){return t(e)}))},t.reject=function(e){return new t((function(t,r){return r(e)}))},t.all=function(e){return new t((function(t,r){Promise.all(e).then(t).catch(r)}))},t.prototype.then=function(e,r){var o=this,i=new t((function(t,a){o._promise&&o._promise.then((function(r){o._canceled&&i.cancel(),e&&!o._canceled?n(t,a,e,r):t(r)}),(function(e){o._canceled&&i.cancel(),r&&!o._canceled?n(t,a,r,e):a(e)}))}),(function(){o.cancel()}));return i},t.prototype.catch=function(t){return this.then(void 0,t)},t.prototype.cancel=function(t){return this._canceled=!0,t&&this._promise&&this._promise.catch(t),this.onCancel&&this.onCancel(),this._destroy(),this},t.prototype.finally=function(t){return this._promise?this._promise.finally(t):Promise.reject(t)},t.prototype._destroy=function(){this.onCancel=void 0,this._promise=void 0},t}();var i=/\{ *([\w_-]+) *\}/g;function a(t,e){return t.replace(i,(function(t,r){var n=e[r];if(void 0===n)throw new Error("No value provided for letiable "+t);return"function"==typeof n&&(n=n(e)),n}))}var s=r(41),u=function(){return(u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},p=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},l=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},f=function(){function t(t){this.options=t,this.emitter=new s.EventEmitter,this.routeStr="/api/component/pyramid/route",this._loadingQueue={},this._loadingStatus={},this._keynames={},this.options.route&&(this.routeStr=this.options.route)}return t.prototype.setNextGisWeb=function(t){this.logout(),this.options.baseUrl=t},t.prototype.connect=function(){return c(this,void 0,o,(function(){var t,e,r,n=this;return p(this,(function(o){switch(o.label){case 0:return this.route?[2,Promise.resolve(this.route)]:[3,1];case 1:return this.options.auth?(t=this.options.auth,e=t.login,r=t.password,e&&r?[4,this.getUserInfo({login:e,password:r})]:[3,3]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.makeQuery(this.routeStr,{},{}).then((function(t){return n.route=t,t}))];case 4:return[2,o.sent()]}}))}))},t.prototype.login=function(t){return c(this,void 0,void 0,(function(){return p(this,(function(e){return this.logout(),[2,this.getUserInfo(t)]}))}))},t.prototype.logout=function(){this._rejectLoadingQueue(),this._loadingStatus={},this.options.auth=void 0,this.route=void 0,this.user=void 0,this.emitter.emit("logout")},t.prototype.getUserInfo=function(t){var e=this;if(this.user&&this.user.id)return o.resolve(this.user);t&&(this.options.auth=t);var r={headers:this.getAuthorizationHeaders(t)};return this.makeQuery("/api/component/auth/current_user",{},r).then((function(t){return e.user=t,e.emitter.emit("login",t),t})).catch((function(t){throw e.emitter.emit("login:error",t),t}))},t.prototype.getAuthorizationHeaders=function(t){var e=this.makeClientId(t);if(e)return{Authorization:"Basic "+e}},t.prototype.makeClientId=function(t){if(t=t||this.options.auth){var e=t.login,r=t.password;return window.btoa(unescape(encodeURIComponent(e+":"+r)))}},t.prototype.getResourceByKeyname=function(t){return c(this,void 0,void 0,(function(){var e,r;return p(this,(function(n){switch(n.label){case 0:return(e=this._keynames.keyname)?[3,2]:[4,this.get("resource.search",null,{keyname:t})];case 1:r=n.sent(),(e=r[0])&&(this._keynames[t]=e),n.label=2;case 2:return[2,e]}}))}))},t.prototype.getResourceChildren=function(t){return c(this,void 0,void 0,(function(){var e,r;return p(this,(function(n){switch(n.label){case 0:if(e=t.resourceId,!t.keyname&&!t.resourceId)throw new Error("No keyname or resourceId is set");return t.keyname?[4,this.getResourceByKeyname(t.keyname)]:[3,2];case 1:r=n.sent(),e=r.resource.id,n.label=2;case 2:return[4,this.get("resource.collection",null,{parent:e})];case 3:return[2,n.sent()]}}))}))},t.prototype.request=function(t,e,r){return void 0===e&&(e={}),c(this,void 0,o,(function(){var n,i,s,u,c,f,h,y;return p(this,(function(p){switch(p.label){case 0:return[4,this.connect()];case 1:if(n=p.sent(),i=n&&n[t]){if(i=l(i),s=i.shift(),i.length){for(u={},c=0;c<i.length;c++)if(f=i[c],u[c]="{"+f+"}",void 0===e[f])throw new Error("`"+f+"` url api argument is not specified");s&&(s=a(s,u))}if(e){for(y in h=[],e)-1===i.indexOf(y)&&h.push(y+"="+e[y]);h.length&&(s=s+"?"+h.join("&"))}if(s)return[2,this.makeQuery(s,e,r)];throw new Error("request url is not set")}return[2,o.resolve({})]}}))}))},t.prototype.post=function(t,e,r){return(e=e||{}).method="POST",e.nocache=!0,this.request(t,r,e)},t.prototype.get=function(t,e,r){return(e=e||{}).method="GET",e.nocache=!0,this.request(t,r,e)},t.prototype.patch=function(t,e,r){return(e=e||{}).method="PATCH",e.nocache=!0,this.request(t,r,e)},t.prototype.put=function(t,e,r){return(e=e||{}).method="PUT",e.nocache=!0,this.request(t,r,e)},t.prototype.delete=function(t,e,r){return(e=e||{}).method="DELETE",e.nocache=!0,this.request(t,r,e)},t.prototype.makeQuery=function(t,e,r){var n=this;if(void 0===r&&(r={}),t=(this.options.baseUrl?this.options.baseUrl:"")+t)return e&&(t=a(t,e)),t=t.replace(/([^:]\/)\/+/g,"$1"),!this._loadingStatus[t]||r.nocache?(this._loadingStatus[t]=!0,this._getJson(t,r).then((function(e){return n._loadingStatus[t]=!1,n._executeLoadingQueue(t,e),e})).catch((function(e){throw n._loadingStatus[t]=!1,n._executeLoadingQueue(t,e,!0),n.emitter.emit("error",e),e}))):(this._loadingStatus[t]=!1,new o((function(e,r){n._setLoadingQueue(t,e,r)})));throw new Error("No `url` parameter set for option "+name)},t.prototype._setLoadingQueue=function(t,e,r){this._loadingQueue[t]=this._loadingQueue[t]||{name:t,waiting:[]},this._loadingQueue[t].waiting.push({resolve:e,reject:r,timestamp:new Date})},t.prototype._rejectLoadingQueue=function(){for(var t in this._loadingQueue){this._loadingQueue[t].waiting.forEach((function(t){t.reject()})),delete this._loadingQueue[t]}},t.prototype._executeLoadingQueue=function(t,e,r){var n=this._loadingQueue[t];if(n){for(var o=0;o<n.waiting.length;o++){var i=n.waiting[o];r?i.reject&&i.reject():i.resolve(e)}n.waiting=[]}},t.prototype._getJson=function(t,e){var r=this,n=[];return e.responseType=e.responseType||"json",new o((function(o,i){r.user&&((e=e||{}).headers=u(u({},r.getAuthorizationHeaders()),e.headers)),function(t,e,r,n,o){void 0===r&&(r={}),r.method=r.method||"GET";var i=new XMLHttpRequest;i.open(r.method||"GET",t,!0),"blob"===r.responseType&&(i.responseType=r.responseType);var a=function(t){void 0===t&&(t=!1);var o=t?n:e;if("blob"===r.responseType)o(i.response);else if(i.responseText)try{o(JSON.parse(i.responseText))}catch(t){o(i.responseText)}else n({message:""})};i.onreadystatechange=function(){4===i.readyState&&200===i.status||3===i.readyState&&201===i.status?a():3===i.readyState&&400===i.status?a():4===i.readyState&&500===i.status?a():4===i.readyState&&401===i.status?n(i.statusText):4===i.readyState&&n("request error")},i.onerror=function(t){n(t)},i.upload.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;r.onProgress&&r.onProgress(e)}};var s,u=r.headers;if(u)for(var c in u){var p=u[c];"string"==typeof p&&i.setRequestHeader(c,p)}if(void 0!==r.withCredentials&&(i.withCredentials=r.withCredentials),r.file){if((s=new FormData).append("file",r.file),r.data)for(var l in s)s.append(l,s[l])}else s=r.data?"string"==typeof r.data?r.data:JSON.stringify(r.data):null;o&&o.push((function(){i.abort()})),i.send(s)}(t,o,e,i,n)}),(function(){n.forEach((function(t){return t()}))}))},t}();r.d(e,"a",(function(){return o}));e.b=f},36:function(t,e,r){"use strict";var n=r(30),o=r(127),i=r(38),a=function(){return(a=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},s={srs:4326,geom_format:"geojson"};function u(t){var e=t.geom;return{id:t.id,type:"Feature",properties:t.fields,geometry:e}}function c(t){var e=a({},s);return t.connector.get("feature_layer.feature.item",null,a({id:t.resourceId,fid:t.featureId},e))}function p(t){return c(t).then((function(t){return u(t)}))}function l(t){var e=a({},s),r=t.connector,o=t.filters,i=t.limit,u=t.fields,p=t.intersects,l=t.resourceId;if(o){var f=o.filter((function(t){return Array.isArray(t)})),h=f.find((function(t){return"id"===t[0]}));if(h)return function(t){var e=t.filterById[2],r="number"==typeof e?[e]:e.split(",").map((function(t){return Number(t)}));if("eq"!==t.filterById[1]&&"in"!==t.filterById[1])throw new Error("Unable to filter by object id. Except `eq` or `in` operator");var o=r.map((function(e){return c({connector:t.connector,resourceId:t.resourceId,featureId:e})}));return n.a.all(o)}({filterById:h,connector:r,resourceId:l});f.forEach((function(t){var r=t[0],n=t[1],o=t[2];e["fld_"+r+"__"+n]=""+o}))}return i&&(e.limit=i),u&&(e.fields=u.join()),p&&(e.intersects=p),r.get("feature_layer.feature.collection",null,a({id:l},e))}function f(t){return l(t).then((function(t){var e=[];return t.forEach((function(t){e.push(u(t))})),{type:"FeatureCollection",features:e}}))}var h=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},y=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function d(t,e){return h(this,void 0,void 0,(function(){var r,n,o;return y(this,(function(i){switch(i.label){case 0:return r=t.keyname,(n=t.resourceId)||!r?[3,2]:[4,e.getResourceByKeyname(r)];case 1:o=i.sent(),n=o.resource.id,i.label=2;case 2:return[2,n]}}))}))}var v,m=(v=function(t,e){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),b=function(){return(b=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},_=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},g=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function w(t,e,r){return _(this,void 0,void 0,(function(){var n,o,a,s,u,c,p,l,h=this;return g(this,(function(y){switch(y.label){case 0:return n=e.mapAdapter.layerAdapters.GEOJSON,a=!1,[4,d(t,r)];case 1:return u=y.sent(),c=function(t,e){return _(h,void 0,void 0,(function(){return g(this,(function(n){switch(n.label){case 0:return s={filters:t,options:e},[4,o=f(b({resourceId:u,filters:t,connector:r},e))];case 1:return[2,n.sent()]}}))}))},p=function(){o&&(o.cancel(),o=void 0)},l=function(e){var r={data:e};return t.id&&(r.id=t.id),i.b.utils.updateGeoJsonAdapterOptions(r)},[2,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.addLayer=function(e){return _(this,void 0,void 0,(function(){var r,n,o;return g(this,(function(i){switch(i.label){case 0:return r={},e.data?[3,2]:[4,c(e.propertiesFilter,{limit:e.limit})];case 1:r=i.sent(),i.label=2;case 2:return n=l(r),(o=b(b({},e),n)).data&&0===Object.keys(o.data).length&&(o.data=void 0),[2,t.prototype.addLayer.call(this,o)]}}))}))},e.prototype.beforeRemove=function(){p()},e.prototype.updateLayer=function(){return _(this,void 0,void 0,(function(){var t,e,r,n;return g(this,(function(o){switch(o.label){case 0:return e=(t=s||{}).filters,r=t.options,[4,c(e,r)];case 1:return n=o.sent(),this.setData&&this.setData(n),[2]}}))}))},e.prototype.propertiesFilter=function(t,e){return _(this,void 0,void 0,(function(){var r;return g(this,(function(n){switch(n.label){case 0:return p(),this.filter&&a?(this.filter((function(e){return!e.feature||!e.feature.properties||i.b.utils.propertiesFilter(e.feature.properties,t)})),[3,3]):[3,1];case 1:return this.setData?(this.clearLayer&&this.clearLayer(),[4,c(t,e)]):[3,3];case 2:r=n.sent(),this.setData(r),n.label=3;case 3:return[2]}}))}))},e.prototype.removeFilter=function(){s=void 0,this.propertiesFilter([]),this.filter&&this.filter((function(){return!0}))},e}(n)]}}))}))}var O=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),L=function(){return(L=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},I=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},P=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function x(t,e,r,n){return I(this,void 0,void 0,(function(){var o,i,a,s;return P(this,(function(u){switch(u.label){case 0:return"IMAGE"===(o=t.adapter||"IMAGE")&&(i=e.getLayerAdapters(),!i||i.IMAGE||(o="TILE")),"IMAGE"!==o&&"TILE"!==o&&"MVT"!==o?[3,2]:(a=e.mapAdapter.layerAdapters[o],[4,d(t,n)]);case 1:return s=u.sent(),[2,function(n){function o(o,i){var a=n.call(this,o,i)||this;a.map=o,a.resourceId=s;var u=vt(t,e,r);if(u)if(u.resourceId){var c=L(L({},u),{resourceId:u.resourceId});a.options=L(L({},a.options),c)}else{var p=u;a.options=L(L({},a.options),p)}return a}return O(o,n),o.prototype.addLayer=function(t){return n.prototype.addLayer.call(this,L(L({},this.options),t))},o.prototype.getIdentificationIds=function(){return I(this,void 0,void 0,(function(){var t;return P(this,(function(e){return(t=this.item&&this.item.resource.parent.id)?[2,[t]]:[2]}))}))},o}(a)];case 2:throw new Error(o+" not supported yet. Only TILE")}}))}))}var k=r(26);function F(t,e,r,n){void 0===e&&(e=function(t){return!!t}),void 0===n&&(n=[]);var o=[];if(Array.isArray(t))o=t;else{e(t)&&n.push(t);var i=r(t);i&&(Array.isArray(i)?o=i:o.push(i))}for(var a=0;a<o.length;a++)o[a]&&F(o[a],e,r,n);return n}var E,S=function(){function t(t){this._children=[],this.item=t}return t.prototype.setParent=function(t){this._parent=t},t.prototype.addChild=function(t){this._children.push(t)},t.prototype.getParent=function(){return this._parent},t.prototype.getParents=function(t){var e=this.getParent();return e?F(e,t,(function(t){return t.tree.getParent()})):[]},t.prototype.getRoot=function(){for(var t=this.getParent(),e=t;t;)(t=t.tree.getParent())&&(e=t);return e},t.prototype.find=function(t){return F(this._children,t,(function(t){return t.tree.getChildren()}))[0]},t.prototype.all=function(t){return this.getDescendants(t)},t.prototype.getDescendants=function(t){return F(this._children,t,(function(t){return t.tree.getChildren()}))},t.prototype.getChildren=function(){return this._children},t}();try{E=r(41)}catch(t){}var C,A=E&&E.EventEmitter,j=function(){function t(t,e,r){this.emitter=A&&new A,this._blocked=!1,this.item=e,this.options=Object.assign({},r),this.name=t,this._value=this.getProperty()}return t.prototype.getProperty=function(){return"function"==typeof this.options.getProperty?this.options.getProperty.call(this,this.item):this.options.value},t.prototype.getParents=function(){return this.item.tree.getParents()||[]},t.prototype.getParent=function(){return this.item.tree.getParent()},t.prototype.isGroup=function(){return this.item.tree.getDescendants().length},t.prototype.isBlocked=function(){var t=this;if(void 0===this._blocked){var e=this.item.tree.getParents();if(e){var r=e.find((function(e){var r=e.properties&&e.properties.property(t.name);return!!r&&!r.get()}));this._blocked=!!r}else this._blocked=!1}return this._blocked},t.prototype.set=function(t,e){this._value=this._prepareValue(t),this.update(this._value,e),this._fireChangeEvent(this._value,e)},t.prototype.get=function(){return this.getValue()},t.prototype.update=function(t,e){this._callOnSet(t,e)},t.prototype.getContainer=function(){return this._container},t.prototype.destroy=function(){if(this._container){var t=this._container.parentNode;t&&t.removeChild(this._container)}this._removeEventsListener&&this._removeEventsListener()},t.prototype.getValue=function(){return void 0!==this._value?this._value:this.getProperty()},t.prototype._prepareValue=function(t){return t},t.prototype._callOnSet=function(t,e){this.options.onSet&&this.options.onSet.call(this,t,e,this.item)},t.prototype._fireChangeEvent=function(t,e){var r=this;this.emitter&&(t=void 0!==t?t:this.getValue(),this.emitter.emit("change",{value:t,options:e}),this.item.tree.getParents().forEach((function(n){var o=n.properties&&n.properties.property(r.name);o&&o.emitter.emit("change-tree",{value:t,options:e,item:r.item})})))},t}(),N=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),T=function(){return(T=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},M=function(t){function e(r,n,o){var i=t.call(this,r,n,T(T({},e.options),o))||this;return i.set(i.get()),i}return N(e,t),e.prototype.update=function(t,e){if(t){if(e&&e.bubble||this.options.bubble){this.unBlock(e);var r=this.getParent(),n=r&&r.properties&&r.properties.property(this.name);n&&n.set(t,Object.assign({},e,{bubble:!0,propagation:!1}))}this.isBlocked()||this._turnOn(e)}else this._turnOff(e);(e&&e.propagation||this.options.propagation)&&this._propagation(t,e)},e.prototype.getHierarchyValue=function(){var t=this;return this.get()&&this.getParents().every((function(e){var r=e.properties&&e.properties.get(t.name);return r&&r.get()}))},e.prototype._prepareValue=function(t){return t},e.prototype._turnOff=function(t){this.options.turnOff&&this.options.turnOff.call(this,t),this._callOnSet(!1,t),this.options.hierarchy&&this.isGroup()&&this.blockChilds(t)},e.prototype._turnOn=function(t){this.options.turnOn&&this.options.turnOn.call(this,t),this._callOnSet(!0,t),this.options.hierarchy&&this.isGroup()&&this.unblockChilds(t)},e.prototype.block=function(t){this._blocked=!0,this._block(t)},e.prototype._block=function(t){this._turnOff(t)},e.prototype.unBlock=function(t){this._blocked=!1,this.getValue()&&this._unBlock(t)},e.prototype._unBlock=function(t){this._turnOn(t)},e.prototype.blockChilds=function(t){var e=this;this.item.tree.getDescendants().forEach((function(r){return e._blockChild(r,t)}))},e.prototype.unblockChilds=function(t){var e=this;this.item.tree.getChildren().forEach((function(r){return e._unBlockChild(r,t)}))},e.prototype._blockChild=function(t,e){var r=t.properties&&t.properties.property(this.name);r&&r.block&&r.block(e)},e.prototype._unBlockChild=function(t,e){var r=t.properties&&t.properties.property(this.name);r&&r.unBlock&&r.unBlock(e)},e.prototype._propagation=function(t,e){if(this.isGroup())for(var r=this.item.tree.getChildren(),n=0;n<r.length;n++){var o=r[n],i=o.properties&&o.properties.property(this.name);i&&i.set(t,T(T({},e),{propagation:!0,bubble:!1}))}},e.options={hierarchy:!0,bubble:!1,propagation:!1,label:"Toggle"},e}(j),R=function(){return(R=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},G=function(){function t(t,e){this.item=t,this.options={},this._properties={},this._propertiesList=[],e&&e.forEach(this._setPropertyHandler.bind(this))}return t.prototype.add=function(t){this._setPropertyHandler(t)},t.prototype._setPropertyHandler=function(e){var r=t.handlers,n=e.handler;if(!n&&e.type)switch(e.type){case"boolean":n=r.CheckProperty;break;case"string":n=r.BaseProperty;break;default:n=r.BaseProperty}if(n&&e.name){var o=R({},e||{});this._properties[e.name]=new n(e.name,this.item,o),this._propertiesList.push(e.name)}},t.prototype.update=function(){this.list().forEach((function(t){t.update()}))},t.prototype.get=function(t){var e=this.property(t);if(e)return e.get()},t.prototype.set=function(t,e,r){var n=this.property(t);if(n)return n.set(e,r)},t.prototype.property=function(t){return this._properties[t]},t.prototype.list=function(){var t=this;return this._propertiesList.map((function(e){return t._properties[e]}))},t.prototype.destroy=function(){for(var t in this._properties){var e=this.property(t);e&&e.destroy&&e.destroy()}this._properties={},this._propertiesList=[]},t.handlers={CheckProperty:M},t}(),q=function(){return(q=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};try{C=r(41)}catch(t){}var D=C&&C.EventEmitter,z=0,Z=function(){function t(t){this.options={},this.id=z,this.emitter=D&&new D,z+=1,this.options=q({},t),this.tree=new S(this)}return t.prototype.initProperties=function(){this.properties=new G(this,this.options.properties)},t}(),B=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),U=function(){return(U=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Q=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},W=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},H=function(t){function e(r,n,o,i){var a=t.call(this,U(U({},e.options),o))||this;if(a.webMap=r,a._rootDescendantsCount=0,i&&a.tree.setParent(i),a.item=n,"root"===a.item.item_type)a._rootDescendantsCount=a._sumUp(a.item.children);else{var s=a.tree.getRoot();s&&(a._rootDescendantsCount=s._rootDescendantsCount)}return a.initProperties(),a._init(n),a}return B(e,t),e.prototype.initItem=function(t){return Q(this,void 0,void 0,(function(){var r,n,o,i,a,s,u,c,p,l=this;return W(this,(function(f){switch(f.label){case 0:return r=t._layer,n=t,"group"!==t.item_type&&"root"!==t.item_type?[3,1]:(t.children&&t.children.length&&t.children.reverse().forEach((function(t){var r=new e(l.webMap,t,l.options,l);l.tree.addChild(r)})),[3,3]);case 1:return"layer"!==t.item_type?[3,3]:(o=t.adapter||t.layer_adapter.toUpperCase(),i=t.layer_max_scale_denom?this._mapScaleToZoomLevel(t.layer_max_scale_denom):this.webMap.options.maxZoom,a=t.layer_min_scale_denom?this._mapScaleToZoomLevel(t.layer_min_scale_denom):this.webMap.options.minZoom,s=U(U({maxZoom:i,minZoom:a,minScale:t.layer_min_scale_denom,maxScale:t.layer_max_scale_denom},t),{headers:this.options.headers}),this.options.order&&(u=this.options.drawOrderEnabled?this._rootDescendantsCount-t.draw_order_position:this.id,s.order=Number((0|this.options.order)+"."+u)),[4,this.webMap.addLayer(o,s)]);case 2:r=f.sent(),f.label=3;case 3:return r&&(n._layer=r,this.layer=r,this.properties&&"layer"===t.item_type&&t.layer_enabled&&this.properties.property("visibility").set(!0),"number"==typeof(c="layer"===t.item_type&&t.layer_transparency)&&(p=(100-c)/100,this.webMap.setLayerOpacity(r,p))),[2]}}))}))},e.prototype.bringToFront=function(){},e.prototype.fit=function(){"layer"===this.item.item_type&&console.log(this.item)},e.prototype._mapScaleToZoomLevel=function(t){return xt(t)},e.prototype._init=function(t){return Q(this,void 0,void 0,(function(){return W(this,(function(e){switch(e.label){case 0:return[4,this.initItem(t)];case 1:return e.sent(),this.emitter.emit("init"),[2]}}))}))},e.prototype._sumUp=function(t,e){void 0===e&&(e=0);for(var r=0,n=t;r<n.length;r++){var o=n[r];"layer"===o.item_type?(e+=1,o.draw_order_position=o.draw_order_position||e):"group"===o.item_type&&(e=this._sumUp(o.children,e))}return e},e.options={properties:[{type:"boolean",name:"visibility",getProperty:function(t){if(t){if("group"===t.item.item_type)return!0;if("layer"===t.item.item_type)return t.item.layer_enabled;if("root"===t.item.item_type)return!0}return!1},onSet:function(t,e,r){r&&r.layer&&"layer"===r.item.item_type&&(t?r.webMap.showLayer(r.layer):r.webMap.hideLayer(r.layer),r.item.layer_enabled=t)}}]},e}(Z),J=r(41),V=function(){return(V=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},$=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},X=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},K=function(){function t(t,e){this.map=t,this.options=e,this.pixelRadius=10,this.emitter=new J.EventEmitter;var r=e.resourceId;if(Array.isArray(r)?(this.resourceId=r[0],this.options.id=r[1]):this.resourceId=r,!this.resourceId)throw new Error("NGW `resourceId` is not defined")}return t.prototype.addLayer=function(t){return $(this,void 0,void 0,(function(){var e,r,n=this;return X(this,(function(o){switch(o.label){case 0:return this.options=V(V({},this.options),t),e=this,[4,this._getWebMapLayerItem()];case 1:return e.layer=o.sent(),this.options.identification?[4,this._getWebMapIds()]:[3,3];case 2:(r=o.sent())&&(this._webmapLayersIds=r,this.$$onMapClick=function(t){return n._onMapClick(t)},this.options.webMap.emitter.on("click",this.$$onMapClick)),o.label=3;case 3:return[2,this.layer]}}))}))},t.prototype.removeLayer=function(){var t=this.options.webMap.mapAdapter;this.$$onMapClick&&this.options.webMap.emitter.off("click",this.$$onMapClick),this.getDependLayers().forEach((function(e){"layer"in e&&t.removeLayer(e.layer.layer)})),this.$$onMapClick=void 0,delete this.options,delete this.layer,delete this.response,delete this._webmapLayersIds},t.prototype.showLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!0)},t.prototype.hideLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!1)},t.prototype.getExtent=function(){var t=this.response&&this.response.webmap;if(t)return bt(t)},t.prototype.getDependLayers=function(){return this.layer&&this.layer.tree.getDescendants()||[]},t.prototype.getIdentificationIds=function(){return $(this,void 0,void 0,(function(){var t,e;return X(this,(function(r){switch(r.label){case 0:return t=[],(e=this._webmapLayersIds)?[3,2]:[4,this._getWebMapIds()];case 1:e=r.sent(),this._webmapLayersIds=e,r.label=2;case 2:return e&&e.length&&this.getDependLayers().sort((function(t,e){return t.id-e.id})).forEach((function(e){var r=e.item,n=r.parentId;if(void 0!==n&&"layer"===r.item_type){var o=e.properties.property("visibility");o.get()&&!o.isBlocked()&&t.push(n)}})),[2,t]}}))}))},t.prototype._getWebMapLayerItem=function(){return $(this,void 0,void 0,(function(){var t,e=this;return X(this,(function(r){switch(r.label){case 0:return this.resourceId?[4,this.getWebMapConfig(this.resourceId)]:[3,2];case 1:if((t=r.sent())&&t.root_item)return[2,new Promise((function(r){var n={};if(e.options.connector&&e.options.connector.options.auth){var o=e.options.connector.getAuthorizationHeaders();o&&(n.headers=o)}n.order=e.options.order,n.drawOrderEnabled=t.draw_order_enabled;var i=new H(e.options.webMap,t.root_item,n);i.emitter.on("init",(function(){return r(i)}))}))];r.label=2;case 2:return[2]}}))}))},t.prototype.getWebMapConfig=function(t){return $(this,void 0,void 0,(function(){var e,r;return X(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.options.connector.get("resource.item",null,{id:t})];case 1:return e=n.sent(),this.response=e,(r=e.webmap)?(this._updateItemsParams(r.root_item,this.options.webMap,e),[2,r]):[3,3];case 2:throw n.sent();case 3:return[2]}}))}))},t.prototype._updateItemsParams=function(t,e,r){var n=this;if(t)if("group"===t.item_type||"root"===t.item_type)t.children&&(t.children=t.children.map((function(t){return n._updateItemsParams(t,e,r)}))),"root"===t.item_type&&(t.display_name=r.resource.display_name);else if("layer"===t.item_type){var o=Object(k.c)(this.options.baseUrl+"/api/component/render/image"),i=t.layer_style_id;t.url=o,t.resourceId=i,t.updateWmsParams=function(t){return dt(t,i)},t=V(V({},t),vt({adapter:t.layer_adapter.toUpperCase(),resourceId:i},e,this.options.baseUrl))}return t},t.prototype._getWebMapIds=function(){return $(this,void 0,void 0,(function(){var t,e,r,n=this;return X(this,(function(o){switch(o.label){case 0:return(t=this.layer)&&"root"===t.item.item_type?(e=t.tree.getDescendants(),r=[],e.forEach((function(t){var e=t.item;if("layer"===e.item_type){var o=e.layer_style_id,i=n.options.connector.get("resource.item",{},{id:o}).then((function(t){if(t){var r=Number(t.resource.parent.id);return e.parentId=r,r}}));r.push(i)}})),[4,Promise.all(r)]):[3,2];case 1:return[2,o.sent().filter((function(t){return void 0!==t}))];case 2:return[2]}}))}))},t.prototype._sendIdentifyRequest=function(t){var e=this;if(this._webmapLayersIds)return It(t,{layers:this._webmapLayersIds,connector:this.options.connector,radius:this.pixelRadius}).then((function(r){return e.emitter.emit("identify",{ev:t,data:r}),r}))},t.prototype._onMapClick=function(t){this._sendIdentifyRequest(t)},t}(),Y=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),tt=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},et=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};var rt=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},nt=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},ot=function(){function t(){}return t.prototype.getExtent=function(){return rt(this,void 0,void 0,(function(){var t;return nt(this,(function(e){switch(e.label){case 0:return this._extent?[2,this._extent]:this.item?(t=this,[4,gt(this.item,this.connector).then()]):[3,2];case 1:return t._extent=e.sent(),[2,this._extent];case 2:return[2]}}))}))},t}(),it=function(){return(it=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},at=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},st=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},ut=["mapserver_style","qgis_vector_style","qgis_raster_style","raster_style"];function ct(t,e,r,n,o){return at(this,void 0,void 0,(function(){var i,a;return st(this,(function(s){switch(s.label){case 0:return[4,o.get("resource.collection",null,{parent:t})];case 1:return i=s.sent(),(a=i&&i[0])?[2,pt(it(it({},e),{resourceId:a.resource.id}),r,n,o)]:[2]}}))}))}function pt(t,e,r,n){return at(this,void 0,void 0,(function(){var i,a,s,u,c,p;return st(this,(function(l){switch(l.label){case 0:return l.trys.push([0,4,,5]),s=t.adapter,[4,d(t,n)];case 1:return(u=l.sent())?[4,n.get("resource.item",null,{id:u})]:[3,3];case 2:if(!(a=l.sent()))throw new Error("Can't add NGW layer because Resource item is not found");if(c=it(it({},t),{resourceId:u}),a.webmap)i=function(t,e,r,n){return tt(this,void 0,void 0,(function(){var o;return et(this,(function(i){switch(i.label){case 0:return[4,d(t,n)];case 1:return o=i.sent(),[2,function(t){function i(i){return t.call(this,i,{webMap:e,resourceId:o,baseUrl:r,connector:n})||this}return Y(i,t),i}(K)]}}))}))}(c,e,r,n);else if(-1!==ut.indexOf(a.resource.cls))"GEOJSON"===s?(p=it(it({},t),{resourceId:a.resource.parent.id}),i=w(p,e,n)):i=x(c,e,r,n);else if("vector_layer"===a.resource.cls)if(void 0!==s&&"GEOJSON"!==s){if("MVT"!==s)return[2,ct(a.resource.id,c,e,r,n)];i=x(c,e,r,n)}else i=w(c,e,n);else{if("raster_layer"===a.resource.cls)return[2,ct(a.resource.id,c,e,r,n)];a.basemap_layer&&a.basemap_layer.qms&&(i=Promise.resolve(o.a.utils.createQmsAdapter(e))).then((function(t){if(t&&a&&a.basemap_layer&&a.basemap_layer.qms){var e=JSON.parse(a.basemap_layer.qms);t.prototype.qms=e,t.prototype.baseLayer=!0}}))}l.label=3;case 3:return[3,5];case 4:return l.sent(),[3,5];case 5:return i?[2,i.then((function(t){if(t){var e=t;return e.prototype.item=a,e.prototype.connector=n,r=e,[ot].forEach((function(t){Object.getOwnPropertyNames(t.prototype).forEach((function(e){var n=Object.getOwnPropertyDescriptor(t.prototype,e);n&&Object.defineProperty(r.prototype,e,n)}))})),e}var r}))]:[2]}}))}))}var lt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ft=function(){return(ft=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},ht=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},yt=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function dt(t,e){return{resource:e,extent:t.bbox,size:t.width+","+t.height,timestamp:Date.now()}}function vt(t,e,r){var n=t.adapter||"IMAGE",o=e.getLayerAdapters(),i=!o||o.IMAGE,a=t.resourceId;if(a){if("IMAGE"===n){if(i)return{url:r+"/api/component/render/image",resourceId:a,headers:t.headers,updateWmsParams:function(t){return dt(t,a)}};n="TILE"}if("MVT"===n)return{url:r+"/api/component/feature_layer/mvt?x={x}&y={y}&z={z}&resource="+a+"&simplification="+(t.simplification||0)};if("TILE"===n)return{url:r+"/api/component/render/tile?z={z}&x={x}&y={y}&resource="+a,adapter:n}}else console.log("Options `resourceId` not set")}function mt(t,e,r,n){var o=n.getAuthorizationHeaders();return o&&(t.headers=o),pt(t,e,r,n)}function bt(t){var e=t.extent_bottom,r=t.extent_left,n=t.extent_top,o=t.extent_right;if(e&&r&&n&&o){var i=[r,e,o,n];return i[3]>82&&(i[3]=82),i[1]<-82&&(i[1]=-82),i}}function _t(t,e){return e.get("layer.extent",name,{id:t}).then((function(t){if(t){var e=t.extent,r=e.maxLat,n=e.maxLon,o=e.minLat;return[e.minLon,o,n,r]}}))}function gt(t,e){return ht(this,void 0,void 0,(function(){var r;return yt(this,(function(n){return t.webmap?[2,bt(t.webmap)]:-1!==(r=t.resource).cls.indexOf("style")?[2,e.get("resource.item",null,{id:r.parent.id}).then((function(t){return _t(t.resource.id,e)}))]:[2,_t(r.id,e)]}))}))}var wt,Ot=Math.PI/180,Lt=180/Math.PI;function It(t,e){var r=function(t,e,r,n){void 0===r&&(r=10),void 0===n&&(n=6);for(var o=r/3963*Lt,i=o/Math.cos(e*Ot),a=[],s=0;s<n+1;s++){var u=Math.PI*(s/(n/2)),c=t+i*Math.cos(u),p=e+o*Math.sin(u);a.push([c,p])}return a}(t.latLng.lng,t.latLng.lat,e.radius),n=[];r.forEach((function(t){var e=function(t,e){var r=20037508.34*t/180,n=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return[r,n=20037508.34*n/180]}(t[0],t[1]),r=e[0],o=e[1];n.push(r+" "+o)}));var o={geom:"POLYGON(("+n.join(", ")+"))",srs:3857,layers:e.layers};return e.connector.post("feature_layer.identify",{data:o})}function Pt(){if(void 0===wt){var t=document.createElement("div");t.style.cssText="position: absolute;  left: -100%;  top: -100%;  width: 100cm;",document.body.appendChild(t);var e=t.offsetWidth;document.body.removeChild(t),wt=e}return wt}function xt(t,e){if(void 0===e&&(e=104),e){var r=e;return function(t){return Math.log(t/256)/Math.LN2}(Pt()*function(t){return 12756274*Math.PI*Math.cos(t*Math.PI/180)}(r)/t)}return Math.round(Math.log(591657550.5/(t/2))/Math.log(2))}var kt=function(){return(kt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function Ft(t,e){var r;void 0===e&&(e=!1);var n=[],o=[];for(var i in t){var a=Number(i);isNaN(a)||n.push(a)}var s=t.resources;s&&n.sort((function(t,e){return s.indexOf(t)-s.indexOf(e)}));for(var u=0;u<n.length;u++){var c=t[i=n[u]].features,p=Number(i),l=c[0];if(l&&(r={featureId:l.id,resourceId:p},o.push(r),!e))break}return o}function Et(t){var e=t.connector,r=t.identify;for(var n in r){var o=Number(n);if(!isNaN(o)){var i=r[n].features.find((function(t){return t.geom}));if(i&&i.geom){var a=i.geom;return u(kt(kt({},i),{geom:a}))}}}var s=Ft(r);if(s)return p(kt({connector:e},s[0]))}var St=function(){return(St=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Ct=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},At=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},jt=function(){function t(t){if(this.options=t,this.options.connector)this.url=this.options.connector.options.baseUrl,this.connector=this.options.connector;else{if(!this.options.baseUrl)throw new Error("url is not defined");this.url=this.options.baseUrl,this.connector=new n.b({baseUrl:this.url,auth:this.options.auth})}}return t.prototype.onLoadSync=function(t){return Ct(this,void 0,void 0,(function(){var e,r,n,o,i;return At(this,(function(a){switch(a.label){case 0:if(!this.options.resourceId||!this.url)return[3,4];if(!(e=[this.options.resourceId]).length)return[3,4];r=0,n=e,a.label=1;case 1:return r<n.length?(o=n[r],i={resourceId:o,connector:this.connector,baseUrl:this.url,webMap:t},[4,t.addLayer(K,St({visibility:!0,fit:!0,identification:this.options.identification,pixelRadius:this.options.pixelRadius},i))]):[3,4];case 2:return[2,a.sent()];case 3:return r++,[3,1];case 4:return[2]}}))}))},t.prototype.getLayerAdapters=function(){return Promise.resolve([this._getLayerAdapter()])},t.prototype._getLayerAdapter=function(){var t=this;return{name:"WEBMAP",createAdapter:function(e){return Promise.resolve(t._createAdapter(e))}}},t.prototype._createAdapter=function(t){var e,r=this.connector,n=this.url;return e={webMap:t,connector:r,baseUrl:n},function(t){function r(r,n){return n=ft(ft({},e),n),t.call(this,r,n)||this}return lt(r,t),r}(K)},t.utils={addNgwLayer:mt,getNgwResourceExtent:gt,sendIdentifyRequest:It,pixelsInMeterWidth:Pt,getNgwLayerFeature:p,getNgwLayerFeatures:f,getNgwLayerItems:l,getNgwLayerItem:c,getIdentifyGeoJson:Et,getIdentifyGeoJsonParams:Ft,createGeoJsonFeature:u,setScaleRatio:xt},t.updateWmsParams=dt,t.getLayerAdapterOptions=vt,t.addNgwLayer=mt,t}();e.a=jt},52:function(t){t.exports=JSON.parse('{"baseUrl":"https://pastandnow.nextgis.com","#qmsId":3033,"qmsId":448,"ngwMarkerLayerId":14,"layerWithPhotos":12,"districtsLayer":9,"feedbackUrl":"https://docs.google.com/forms/d/1sxwoa9CG5Lgl3LXFFxdGHLE6ETWBkA2a_vioFz_IEcQ/viewform?fbclid=IwAR1tx97wsOX9j4GLZCL8PhdW0ZOgZascQ3tHpXkhmGQ8q4CZuZG0W8NFuUg&edit_requested=true"}')}}]);
//# sourceMappingURL=main~f075b844-a22f7c6.js.map