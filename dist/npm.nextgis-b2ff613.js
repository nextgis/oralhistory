(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{152:function(t,e,r){var n;"undefined"!=typeof self&&self,t.exports=(n=r(24),function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e){t.exports=n},function(t,e,r){"use strict";r.r(e);var n=function(){this.backspace=8,this.tab=9,this.enter=13,this.shift=16,this.ctrl=17,this.alt=18,this["pause/break"]=19,this.caps_lock=20,this.escape=27,this.page_up=33,this.page_down=34,this.end=35,this.home=36,this.left_arrow=37,this.up_arrow=38,this.right_arrow=39,this.down_arrow=40,this.insert=45,this.delete=46,this.left_window_key=91,this.right_window_key=92,this.select_key=93,this.numpad_0=96,this.numpad_1=97,this.numpad_2=98,this.numpad_3=99,this.numpad_4=100,this.numpad_5=101,this.numpad_6=102,this.numpad_7=103,this.numpad_8=104,this.numpad_9=105,this.multiply=106,this.add=107,this.subtract=109,this.decimal_point=110,this.divide=111,this.f1=112,this.f2=113,this.f3=114,this.f4=115,this.f5=116,this.f6=117,this.f7=118,this.f8=119,this.f9=120,this.f10=121,this.f11=122,this.f12=123,this.num_lock=144,this.scroll_lock=145,this["semi-colon"]=186,this.equal_sign=187,this[","]=188,this["-"]=189,this["."]=190,this["/"]=191,this["`"]=192,this["["]=219,this["\\"]=220,this["]"]=221,this["'"]=222},o=function(){function t(){this.keyCodeAlias=new n,this.keys={},this._windowOnFocus=this.windowOnFocus.bind(this),this._keysPressed=this.keysPressed.bind(this),this._keysReleased=this.keysReleased.bind(this),this.addKeyboardEventsListener()}return t.prototype.pressed=function(t){var e=this.keyCodeAlias[t];return!!e&&this.keys[e]},t.prototype.addKeyboardEventsListener=function(){window.addEventListener("focus",this._windowOnFocus,!1),window.addEventListener("keydown",this._keysPressed,!1),window.addEventListener("keyup",this._keysReleased,!1)},t.prototype.removeKeyboardEventsListener=function(){window.removeEventListener("focus",this._windowOnFocus,!1),window.removeEventListener("keydown",this._keysPressed,!1),window.removeEventListener("keyup",this._keysReleased,!1)},t.prototype.keysPressed=function(t){t.stopPropagation(),this.keys[t.keyCode]||(this.keys[t.keyCode]=!0)},t.prototype.keysReleased=function(t){t.stopPropagation(),this.keys[t.keyCode]=!1},t.prototype.windowOnFocus=function(){this.keys={}},t}(),i=r(0);function s(t){return function(e,r,n){var o=n.value;return n.value=function(){for(var e=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this;return new Promise(function(n,s){var a=function(){var t=o.apply(e,r);t&&t.then?t.then(n).catch(s):n(t)};void 0!==i._eventsStatus[t]&&i._eventsStatus[t]?a():i.emitter.once(t,function(){i._eventsStatus[t]=!0,a()})})},n}}Object.prototype.toString;var a=function(){return(a=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},u=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},c=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},p=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})},l=function(t,e){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},f=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,o){!function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)}(n,o,(e=t[r](e)).done,e.value)})}}},h=function(){function t(t){this.options={},this.displayProjection="EPSG:3857",this.lonlatProjection="EPSG:4326",this.emitter=new i.EventEmitter,this.keys=new o,this.runtimeParams=[],this._eventsStatus={},this.DPI=1e3/39.37/.28,this.IPM=39.37,this._baseLayers=[],this._layers={},this._layersIds=1,this._selectedLayers=[],this.mapAdapter=t.mapAdapter,this._starterKits=t.starterKits||[],this._addEventsListeners()}return t.prototype.create=function(t){return p(this,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return this.options=function t(e,r,n){void 0===n&&(n=!1);var o=Array.isArray(r),i=o&&[]||{};return o?n?(e=e||[],i=i.concat(e),r.forEach(function(r,o){void 0===i[o]?i[o]=r:"object"==typeof r?i[o]=t(e[o],r,n):-1===e.indexOf(r)&&i.push(r)})):i=r:(e&&"object"==typeof e&&Object.keys(e).forEach(function(t){i[t]=e[t]}),Object.keys(r).forEach(function(o){"object"==typeof r[o]&&r[o]&&e[o]?i[o]=t(e[o],r[o],n):i[o]=r[o]})),i}(this.options||{},t),[4,this._setupMap()];case 1:return e.sent(),[2,this]}})})},t.prototype.getContainer=function(){if(this.mapAdapter.getContainer)return this.mapAdapter.getContainer();if(this.options.target){if(this.options.target instanceof HTMLElement)return this.options.target;if("string"==typeof this.options.target){var t=document.getElementById(this.options.target);if(t)return t}}},t.prototype.setCursor=function(t){this.mapAdapter.setCursor&&this.mapAdapter.setCursor(t)},t.prototype.onMapLoad=function(t){var e=this.mapAdapter.onMapLoad;return e?e.call(this.mapAdapter,t):Promise.resolve(t)},t.prototype.addBaseLayer=function(t,e){return p(this,void 0,void 0,function(){var r,n;return l(this,function(o){switch(o.label){case 0:return[4,this.addLayer(t,a({maxZoom:this.options.maxZoom,minZoom:this.options.minZoom},e,{baseLayer:!0}))];case 1:return r=o.sent(),n=this.getLayerId(r),r&&n&&this._baseLayers.push(n),[2,r]}})})},t.prototype.isBaseLayer=function(t){return-1!==this._baseLayers.indexOf(t)},t.prototype.setCenter=function(t){return this.mapAdapter.setCenter(t),this},t.prototype.setZoom=function(t){return this.mapAdapter.setZoom(t),this},t.prototype.getZoom=function(){return this.mapAdapter.getZoom()},t.prototype.setView=function(t,e){this.mapAdapter.setView&&t&&e?this.mapAdapter.setView(t,e):(t&&this.mapAdapter.setCenter(t),e&&this.mapAdapter.setZoom(e))},t.prototype.fit=function(t,e){return this.mapAdapter.fit(t,e),this},t.prototype.fitLayer=function(t){return p(this,void 0,void 0,function(){var e,r;return l(this,function(n){switch(n.label){case 0:return(e=this.getLayer(t))&&e.getExtent?[4,e.getExtent()]:[3,2];case 1:(r=n.sent())&&this.fit(r),n.label=2;case 2:return[2]}})})},t.prototype.getLayerAdapters=function(){return this.mapAdapter.layerAdapters},t.prototype.getLayerAdapter=function(t){return this.mapAdapter.layerAdapters[t]},t.prototype.getLayer=function(t){return"string"==typeof t?this._layers[t]:t},t.prototype.getLayerId=function(t){var e=this.getLayer(t);if(e&&e.options)return e.options.id;throw new Error("No id for layer")},t.prototype.getLayers=function(){return Object.keys(this._layers)},t.prototype.isLayerOnTheMap=function(t){var e=this.getLayer(t);return!(!e||void 0===e.options.visibility)&&e.options.visibility},t.prototype.createControl=function(t,e){if(this.mapAdapter.createControl)return this.mapAdapter.createControl(t,e)},t.prototype.createButtonControl=function(t){if(this.mapAdapter.createButtonControl)return this.mapAdapter.createButtonControl(t)},t.prototype.createToggleControl=function(t){if(this.mapAdapter.createToggleControl)return this.mapAdapter.createToggleControl(t)},t.prototype.removeControl=function(t){t.remove?t.remove():this.mapAdapter.removeControl&&this.mapAdapter.removeControl(t)},t.prototype.getControl=function(t,e){var r=this.mapAdapter.controlAdapters[t];if(r)return new r(e)},t.prototype.addControl=function(t,e,r){return p(this,void 0,void 0,function(){var n,o;return l(this,function(i){switch(i.label){case 0:return(n="string"==typeof t?this.getControl(t,r):t)?[4,n]:[3,2];case 1:return o=i.sent(),[2,this.mapAdapter.addControl(o,e)];case 2:return[2]}})})},t.prototype.addLayer=function(t,e){return p(this,void 0,void 0,function(){var r,n,o,i,s,u,c=this;return l(this,function(p){switch(p.label){case 0:return(r="string"==typeof t?this.getLayerAdapter(t):t)?(n=e.onLayerClick,e.onLayerClick=function(t){return n&&n(t),c._onLayerClick(t)},o=this._layersIds++,(e=a({id:String(o),visibility:!1,order:o},e)).baseLayer&&(e.order=0),i=new r(this.mapAdapter.map,e),[4,this.onMapLoad()]):[3,3];case 1:return p.sent(),[4,i.addLayer(e)];case 2:return s=p.sent(),i.layer=s,i.id=i.options.id,(u=i.options.id)&&(e.baseLayer&&this._baseLayers.push(u),this._layers[u]=i,e.visibility&&this.showLayer(u)),[2,i];case 3:return[2,Promise.reject("No adapter")]}})})},t.prototype.removeLayers=function(){for(var t in this._layers)this._layers.hasOwnProperty(t)&&this.removeLayer(t);this._layers={}},t.prototype.removeLayer=function(t){var e=this.getLayer(t),r=e&&this.getLayerId(e);if(e&&r){if(this.mapAdapter.removeLayer(e.layer),e.options.baseLayer){var n=this._baseLayers.indexOf(r);n&&this._baseLayers.splice(n,1)}delete this._layers[r]}},t.prototype.showLayer=function(t){this.toggleLayer(t,!0)},t.prototype.hideLayer=function(t){this.toggleLayer(t,!1)},t.prototype.setLayerOpacity=function(t,e){if(this.mapAdapter.setLayerOpacity){var r=this.getLayer(t);r&&this.mapAdapter.setLayerOpacity(r.layer,e)}},t.prototype.getScaleForResolution=function(t,e){return t*(e*this.IPM*this.DPI)},t.prototype.getResolutionForScale=function(t,e){return t/(e*this.IPM*this.DPI)},t.prototype.toggleLayer=function(t,e){var r=this,n=this.getLayer(t),o=n&&n.options.visibility,i=void 0!==e?e:!o,s=function(t,e){if(e.options.visibility=i,i&&t){var n=e.options.baseLayer?0:e.options.order;e.showLayer?e.showLayer.call(e,e.layer):r.mapAdapter.showLayer(e.layer),void 0!==n&&r.mapAdapter.setLayerOrder(e.layer,n,r._layers)}else e.hideLayer?e.hideLayer.call(e,e.layer):r.mapAdapter.hideLayer(e.layer)};n&&n.options.visibility!==i&&(this.mapAdapter.map?s(this.mapAdapter,n):this.mapAdapter.emitter.once("create",function(t){s(t.map,n)}))},t.prototype.requestGeomString=function(t,e){if(this.mapAdapter.requestGeomString)return this.mapAdapter.requestGeomString(t,e)},t.prototype.onMapClick=function(t){this.emitter.emit("click",t)},t.prototype.selectLayer=function(t){var e=this.getLayer(t);if(e){var r=e;r&&r.select&&r.select();var n=this.getLayerId(e);n&&this._selectedLayers.push(n)}},t.prototype.unSelectLayer=function(t){var e=this.getLayer(t);if(e){var r=e&&e;r.unselect&&r.unselect();var n=this.getLayerId(e);if(n){var o=this._selectedLayers.indexOf(n);-1!==o&&this._selectedLayers.splice(o,1)}}},t.prototype.filterLayer=function(t,e){var r=this.getLayer(t);r.filter&&r.filter(e)},t.prototype.setLayerData=function(t,e){var r=this.getLayer(t);r.setData&&r.setData(e)},t.prototype.addLayerData=function(t,e){var r=this.getLayer(t);r.addData&&r.addData(e)},t.prototype.clearLayerData=function(t,e){var r=this.getLayer(t);r.clearLayer&&r.clearLayer(e)},t.prototype.getAttributions=function(t){var e=[];for(var r in this._layers)if(this._layers.hasOwnProperty(r)){var n=this._layers[r];if(void 0!==t.onlyVisible&&!t.onlyVisible||n.options.visibility){var o=n.options&&n.options.attribution;o&&e.push(o)}}return e},t.prototype._setupMap=function(){return p(this,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return this.mapAdapter.displayProjection=this.displayProjection,this.mapAdapter.lonlatProjection=this.lonlatProjection,this.mapAdapter.create(this.options),this._zoomToInitialExtent(),[4,this._addLayerProviders()];case 1:return t.sent(),[4,this._onLoadSync()];case 2:return t.sent(),this._emitLoadEvent("build-map",this.mapAdapter),[2,this]}})})},t.prototype._zoomToInitialExtent=function(){if(this._extent)this.mapAdapter.fit(this._extent);else if(this.options.bounds)this.fit(this.options.bounds);else{var t=this.options,e=t.center,r=t.zoom;this.setView(e,r)}},t.prototype._addLayerProviders=function(){return p(this,void 0,void 0,function(){var t,e,r,n,o,i,s,a,u,c,p,h,d,y,v;return l(this,function(l){switch(l.label){case 0:l.trys.push([0,26,,27]),l.label=1;case 1:l.trys.push([1,19,20,25]),o=f(this._starterKits),l.label=2;case 2:return[4,o.next()];case 3:return(i=l.sent()).done?[3,18]:(s=i.value).getLayerAdapters?[4,s.getLayerAdapters.call(s)]:[3,17];case 4:if(!(a=l.sent()))return[3,17];l.label=5;case 5:l.trys.push([5,11,12,17]),u=f(a),l.label=6;case 6:return[4,u.next()];case 7:return(c=l.sent()).done?[3,10]:[4,(p=c.value).createAdapter(this)];case 8:(h=l.sent())&&(this.mapAdapter.layerAdapters[p.name]=h),l.label=9;case 9:return[3,6];case 10:return[3,17];case 11:return d=l.sent(),r={error:d},[3,17];case 12:return l.trys.push([12,,15,16]),c&&!c.done&&(n=u.return)?[4,n.call(u)]:[3,14];case 13:l.sent(),l.label=14;case 14:return[3,16];case 15:if(r)throw r.error;return[7];case 16:return[7];case 17:return[3,2];case 18:return[3,25];case 19:return y=l.sent(),t={error:y},[3,25];case 20:return l.trys.push([20,,23,24]),i&&!i.done&&(e=o.return)?[4,e.call(o)]:[3,22];case 21:l.sent(),l.label=22;case 22:return[3,24];case 23:if(t)throw t.error;return[7];case 24:return[7];case 25:return[3,27];case 26:throw v=l.sent(),new Error(v);case 27:return[2]}})})},t.prototype._onLoadSync=function(){return p(this,void 0,void 0,function(){var t,e,r,n,o,i,s;return l(this,function(a){switch(a.label){case 0:a.trys.push([0,14,,15]),a.label=1;case 1:a.trys.push([1,7,8,13]),r=f(this._starterKits),a.label=2;case 2:return[4,r.next()];case 3:return(n=a.sent()).done?[3,6]:(o=n.value).onLoadSync?[4,o.onLoadSync.call(o,this)]:[3,5];case 4:a.sent(),a.label=5;case 5:return[3,2];case 6:return[3,13];case 7:return i=a.sent(),t={error:i},[3,13];case 8:return a.trys.push([8,,11,12]),n&&!n.done&&(e=r.return)?[4,e.call(r)]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,12];case 11:if(t)throw t.error;return[7];case 12:return[7];case 13:return[3,15];case 14:return s=a.sent(),console.error(s),[3,15];case 15:return[2]}})})},t.prototype._emitLoadEvent=function(t,e){this._eventsStatus[t]=!0,this.emitter.emit(t,e)},t.prototype._onLayerClick=function(t){return p(this,void 0,void 0,function(){return l(this,function(e){return this.emitter.emit("layer:click",t),[2,Promise.resolve(t)]})})},t.prototype._addEventsListeners=function(){var t=this;this.mapAdapter.emitter.on("click",function(e){return t._onMapClick(e)})},t.prototype._onMapClick=function(t){var e=this;this.emitter.emit("click",t),this._starterKits.forEach(function(r){r.onMapClick&&r.onMapClick(t,e)})},u([s("build-map"),c("design:type",Function),c("design:paramtypes",[Object,Object]),c("design:returntype",Object)],t.prototype,"createControl",null),u([s("build-map"),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],t.prototype,"createButtonControl",null),u([s("build-map"),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],t.prototype,"createToggleControl",null),t}();r.d(e,"WebMap",function(){return h}),e.default=h}]).default)},153:function(t,e,r){var n,o;"undefined"!=typeof self&&self,t.exports=(n=r(36),o=r(154),function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e){t.exports=n},function(t,e){t.exports=o},function(t,e,r){"use strict";r.r(e);var n,o=r(0),i=r.n(o),s=r(1),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),u=function(){return(u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})},p=function(t,e){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},l=function(t){function e(r,n,o,i){var s=t.call(this,u({},e.options,o))||this;return s.webMap=r,s.item=n,i&&s.tree.setParent(i),s.initProperties(),s._init(n),s}return a(e,t),e.prototype.initItem=function(t){return c(this,void 0,void 0,function(){var r,n,o,i=this;return p(this,function(s){switch(s.label){case 0:return r=t._layer,"group"!==t.item_type&&"root"!==t.item_type?[3,1]:(t.children&&t.children.length&&t.children.reverse().forEach(function(t){var r=new e(i.webMap,t,i.options,i);i.tree.addChild(r)}),[3,3]);case 1:return"layer"!==t.item_type?[3,3]:(n=t.adapter||t.layer_adapter.toUpperCase(),o=u({maxZoom:this.webMap.options.maxZoom,minZoom:this.webMap.options.minZoom},t),[4,this.webMap.addLayer(n,o)]);case 2:r=s.sent(),s.label=3;case 3:return r&&(t._layer=r,this.layer=r,this.properties&&"layer"===t.item_type&&t.layer_enabled&&this.properties.property("visibility").set(!0)),[2]}})})},e.prototype.bringToFront=function(){},e.prototype.fit=function(){"layer"===this.item.item_type&&console.log(this.item)},e.prototype._init=function(t){return c(this,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.initItem(t)];case 1:return e.sent(),this.emitter.emit("init"),[2]}})})},e.options={properties:[{type:"boolean",name:"visibility",getProperty:function(t){if(t){if("group"===t.item.item_type)return!0;if("layer"===t.item.item_type)return t.item.layer_enabled;if("root"===t.item.item_type)return!0}return!1},onSet:function(t,e,r){r&&r.layer&&"layer"===r.item.item_type&&(t?r.webMap.showLayer(r.layer):r.webMap.hideLayer(r.layer),r.item.layer_enabled=t)}}]},e}(r.n(s).a),f=function(){return(f=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},h=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})},d=function(t,e){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},y=function(){function t(t,e){this.map=t,this.options=e,this._dependsLayers=[];var r=e.resourceId;if(Array.isArray(r)?(this.resourceId=r[0],this.options.id=r[1]):this.resourceId=r,!this.resourceId)throw new Error("No NGW resouce id defined")}return t.prototype.addLayer=function(t){return h(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return this.options=f({},this.options,t),e=this,[4,this._getWebMapLayerItem()];case 1:return e.layer=r.sent(),[2,this.layer]}})})},t.prototype.showLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!0)},t.prototype.hideLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!1)},t.prototype.getExtent=function(){if(this.response){var t=this.response.webmap,e=t.extent_bottom,r=t.extent_left,n=t.extent_top,o=t.extent_right;if(e&&r&&n&&o){var i=[r,e,o,n];return i[3]>82&&(i[3]=82),i[1]<-82&&(i[1]=-82),i}}},t.prototype.getDependLayers=function(){var t=this;return!this._dependsLayers&&this.layer&&(this._dependsLayers=[],this.layer.tree.getDescendants().forEach(function(e){e.adapter&&t._dependsLayers.push(e.adapter.layer)})),this._dependsLayers},t.prototype._getWebMapLayerItem=function(){return h(this,void 0,void 0,function(){var t,e=this;return d(this,function(r){switch(r.label){case 0:return this.resourceId?[4,this.getWebMapConfig(this.resourceId)]:[3,2];case 1:if((t=r.sent())&&t.root_item)return[2,new Promise(function(r){var n=new l(e.options.webMap,t.root_item);n.emitter.on("init",function(){return r(n)})})];r.label=2;case 2:return[2]}})})},t.prototype.getWebMapConfig=function(t){return h(this,void 0,void 0,function(){var e,r;return d(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.options.connector.request("resource.item",{id:t})];case 1:return e=n.sent(),this.response=e,(r=e.webmap)?(this._updateItemsParams(r.root_item,this.options.webMap),[2,r]):[3,3];case 2:throw n.sent();case 3:return[2]}})})},t.prototype._updateItemsParams=function(t,e){var r=this;if(t)if("group"===t.item_type||"root"===t.item_type)t.children&&(t.children=t.children.map(function(t){return r._updateItemsParams(t,e)}));else if("layer"===t.item_type){var n=function(t){return t.replace(/([^:]\/)\/+/g,"$1")}(this.options.baseUrl+"/api/component/render/image"),o=t.layer_style_id;t.url=n,t.resourceId=o,t.updateWmsParams=function(t){return b(t,o)},t=f({},t,g({adapter:t.layer_adapter.toUpperCase(),resourceId:o},e,this.options.baseUrl))}return t},t}(),v=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),m=function(){return(m=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function b(t,e){return{resource:e,extent:t.bbox,size:t.width+","+t.height,timestamp:Date.now()}}function g(t,e,r){var n=t.adapter||"IMAGE",o=e.getLayerAdapters(),i=!o||o.IMAGE;if("IMAGE"===n){if(i)return{url:r+"/api/component/render/image",resourceId:t.resourceId,updateWmsParams:function(e){return b(e,t.resourceId)}};n="TILE"}if("TILE"===n)return{url:r+"/api/component/render/tile?z={z}&x={x}&y={y}&resource="+t.resourceId,adapter:n}}function _(t,e,r){var n=t.adapter||"IMAGE",o=e.getLayerAdapters();if(!o||o.IMAGE||(n="TILE"),"IMAGE"!==n&&"TILE"!==n)throw new Error(n+" not supported yet. Only TILE");var i=g(t,e,r);if(i){var s=m({},i,{resourceId:i.resourceId});return e.addLayer(n,s)}}var w=function(){function t(t){if(this.options=t,this.pixelRadius=10,this.options.pixelRadius&&(this.pixelRadius=this.options.pixelRadius),!this.options.baseUrl)throw new Error("url is not defined");this.url=this.options.baseUrl,this.connector=new i.a({baseUrl:this.url,auth:this.options.auth})}return t.prototype.onLoadSync=function(t){return function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})}(this,void 0,void 0,function(){var e,r,n,o,i,s,a;return function(t,e){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,function(u){switch(u.label){case 0:if(!this.options.resourceId||!this.options.baseUrl)return[3,5];if(!(e=[this.options.resourceId]).length)return[3,5];r=0,n=e,u.label=1;case 1:return r<n.length?(o=n[r],i={resourceId:o,connector:this.connector,baseUrl:this.options.baseUrl,webMap:t},[4,t.addLayer(y,i)]):[3,5];case 2:return(s=u.sent())?(t.showLayer(s),s.getExtent?[4,s.getExtent()]:[3,4]):[3,4];case 3:(a=u.sent())&&t.fit(a),u.label=4;case 4:return r++,[3,1];case 5:return[2]}})})},t.prototype.getLayerAdapters=function(){return Promise.resolve([this._getLayerAdapter()])},t.prototype.onMapClick=function(t,e){},t.prototype.sendIdentifyRequest=function(t,e,r){void 0===r&&(r={}),e.emitter.emit("start-identify",{ev:t});var n=e.requestGeomString(t.pixel,this.pixelRadius);if(r.layers){var o=r.layers,i={geom:n,srs:3857,layers:o};return this.connector.post("feature_layer.identify",{data:i}).then(function(r){return e.emitter.emit("identify",{ev:t,data:r}),r})}},t.prototype._getLayerAdapter=function(){var t=this;return{name:"WEBMAP",createAdapter:function(e){return Promise.resolve(t._createAdapter(e))}}},t.prototype._createAdapter=function(t){var e,r=this.connector,n=this.options.baseUrl;return e={webMap:t,connector:r,baseUrl:n},function(t){function r(r,n){return n=m({},e,n),t.call(this,r,n)||this}return v(r,t),r}(y)},t.updateWmsParams=b,t.getLayerAdapterOptions=g,t.addNgwLayer=_,t}();r.d(e,"NgwKit",function(){return w}),e.default=w}]).default)},154:function(t,e,r){var n;"undefined"!=typeof self&&self,t.exports=(n=function(){try{return r(24)}catch(t){}}(),function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e){if(void 0===n){var r=new Error("Cannot find module 'events'");throw r.code="MODULE_NOT_FOUND",r}t.exports=n},function(t,e,r){"use strict";function n(t,e,r,o){void 0===e&&(e=function(t){return!!t}),void 0===o&&(o=[]);var i=[];if(Array.isArray(t))i=t;else{e(t)&&o.push(t);var s=r(t);s&&(Array.isArray(s)?i=s:i.push(s))}for(var a=0;a<i.length;a++)i[a]&&n(i[a],e,r,o);return o}r.r(e);var o,i=function(){function t(t){this._children=[],this.item=t}return t.prototype.setParent=function(t){this._parent=t},t.prototype.addChild=function(t){this._children.push(t)},t.prototype.getParent=function(){return this._parent},t.prototype.getParents=function(t){var e=this.getParent();return e?n(e,t,function(t){return t.tree.getParent()}):[]},t.prototype.find=function(t){return n(this._children,t,function(t){return t.tree.getChildren()})[0]},t.prototype.all=function(t){return this.getDescendants(t)},t.prototype.getDescendants=function(t){return n(this._children,t,function(t){return t.tree.getChildren()})},t.prototype.getChildren=function(){return this._children},t}();try{o=r(0)}catch(t){}var s,a,u=o&&o.EventEmitter,c=function(){function t(t,e,r){this.emitter=u&&new u,this._blocked=!1,this.item=e,this.options=Object.assign({},r),this.name=t,this._value=this.getProperty()}return t.prototype.getProperty=function(){return"function"==typeof this.options.getProperty?this.options.getProperty.call(this,this.item):this.options.value},t.prototype.getParents=function(){return this.item.tree.getParents()||[]},t.prototype.getParent=function(){return this.item.tree.getParent()},t.prototype.isGroup=function(){return this.item.tree.getDescendants().length},t.prototype.isBlocked=function(){var t=this;if(void 0===this._blocked){var e=this.item.tree.getParents();if(e){var r=e.find(function(e){var r=e.properties&&e.properties.property(t.name);return!!r&&!r.get()});this._blocked=!!r}else this._blocked=!1}return this._blocked},t.prototype.set=function(t,e){this._value=this._prepareValue(t),this.update(this._value,e),this._fireChangeEvent(this._value,e)},t.prototype.get=function(){return this.getValue()},t.prototype.update=function(t,e){this._callOnSet(t,e)},t.prototype.getContainer=function(){return this._container},t.prototype.destroy=function(){if(this._container){var t=this._container.parentNode;t&&t.removeChild(this._container)}this._removeEventsListener&&this._removeEventsListener()},t.prototype.getValue=function(){return void 0!==this._value?this._value:this.getProperty()},t.prototype._prepareValue=function(t){return t},t.prototype._callOnSet=function(t,e){this.options.onSet&&this.options.onSet.call(this,t,e,this.item)},t.prototype._fireChangeEvent=function(t,e){var r=this;this.emitter&&(t=void 0!==t?t:this.getValue(),this.emitter.emit("change",{value:t,options:e}),this.item.tree.getParents().forEach(function(n){var o=n.properties&&n.properties.property(r.name);o&&o.emitter.emit("change-tree",{value:t,options:e,item:r.item})}))},t}(),p=(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),l=function(){return(l=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},f=function(t){function e(r,n,o){var i=t.call(this,r,n,l({},e.options,o))||this;return i.set(i.get()),i}return p(e,t),e.prototype.update=function(t,e){if(t){if(e&&e.bubble||this.options.bubble){this.unBlock(e);var r=this.getParent(),n=r&&r.properties&&r.properties.property(this.name);n&&n.set(t,Object.assign({},e,{bubble:!0,propagation:!1}))}this.isBlocked()||this._turnOn(e)}else this._turnOff(e);(e&&e.propagation||this.options.propagation)&&this._propagation(t,e)},e.prototype.getHierarchyValue=function(){var t=this;return this.get()&&this.getParents().every(function(e){var r=e.properties&&e.properties.get(t.name);return r&&r.get()})},e.prototype._prepareValue=function(t){return t},e.prototype._turnOff=function(t){this.options.turnOff&&this.options.turnOff.call(this,t),this._callOnSet(!1,t),this.options.hierarchy&&this.isGroup()&&this.blockChilds(t)},e.prototype._turnOn=function(t){this.options.turnOn&&this.options.turnOn.call(this,t),this._callOnSet(!0,t),this.options.hierarchy&&this.isGroup()&&this.unblockChilds(t)},e.prototype.block=function(t){this._blocked=!0,this._block(t)},e.prototype._block=function(t){this._turnOff(t)},e.prototype.unBlock=function(t){this._blocked=!1,this.getValue()&&this._unBlock(t)},e.prototype._unBlock=function(t){this._turnOn(t)},e.prototype.blockChilds=function(t){var e=this;this.item.tree.getDescendants().forEach(function(r){return e._blockChild(r,t)})},e.prototype.unblockChilds=function(t){var e=this;this.item.tree.getChildren().forEach(function(r){return e._unBlockChild(r,t)})},e.prototype._blockChild=function(t,e){var r=t.properties&&t.properties.property(this.name);r&&r.block&&r.block(e)},e.prototype._unBlockChild=function(t,e){var r=t.properties&&t.properties.property(this.name);r&&r.unBlock&&r.unBlock(e)},e.prototype._propagation=function(t,e){if(this.isGroup())for(var r=this.item.tree.getChildren(),n=0;n<r.length;n++){var o=r[n],i=o.properties&&o.properties.property(this.name);i&&i.set(t,l({},e,{propagation:!0,bubble:!1}))}},e.options={hierarchy:!0,bubble:!1,propagation:!1,label:"Toggle"},e}(c),h=function(){return(h=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},d=function(){function t(t,e){this.item=t,this.options={},this._properties={},this._propertiesList=[],e&&e.forEach(this._setPropertyHandler.bind(this))}return t.prototype.add=function(t){this._setPropertyHandler(t)},t.prototype._setPropertyHandler=function(e){var r=t.handlers,n=e.handler;if(!n&&e.type)switch(e.type){case"boolean":n=r.CheckProperty;break;case"string":n=r.BaseProperty;break;default:n=r.BaseProperty}if(n&&e.name){var o=h({},e||{});this._properties[e.name]=new n(e.name,this.item,o),this._propertiesList.push(e.name)}},t.prototype.update=function(){this.list().forEach(function(t){t.update()})},t.prototype.get=function(t){var e=this.property(t);if(e)return e.get()},t.prototype.set=function(t,e,r){var n=this.property(t);if(n)return n.set(e,r)},t.prototype.property=function(t){return this._properties[t]},t.prototype.list=function(){var t=this;return this._propertiesList.map(function(e){return t._properties[e]})},t.prototype.destroy=function(){for(var t in this._properties)if(this._properties.hasOwnProperty(t)){var e=this.property(t);e&&e.destroy&&e.destroy()}this._properties={},this._propertiesList=[]},t.handlers={CheckProperty:f},t}(),y=function(){return(y=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};try{a=r(0)}catch(t){}var v=a&&a.EventEmitter,m=function(){function t(t){this.options={},this.emitter=v&&new v,this.options=y({},t),this.tree=new i(this)}return t.prototype.initProperties=function(){this.properties=new d(this,this.options.properties)},t}();r.d(e,"Item",function(){return m}),e.default=m}]).default)},155:function(t,e,r){"undefined"!=typeof self&&self,t.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var n=function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o={tms:"TILE"};function i(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState&&200===n.status&&n.responseText)try{e(JSON.parse(n.responseText))}catch(t){r(t)}},n.open("GET",function(t){return t.replace(/([^:]\/)\/+/g,"$1")}(t),!0),n.send()})}var s=function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},a=function(){function t(t){this.options={url:"https://qms.nextgis.com"},this.options=s({},this.options,t),this.url=this.options.url}return t.prototype.getLayerAdapters=function(){var t=this;return Promise.resolve([{name:"QMS",createAdapter:function(e){return Promise.resolve(t._createAdapter(e))}}])},t.prototype._createAdapter=function(t){return function(t,e){return function(){function r(t,e){this.map=t,this.options=e,this.options=e}return r.prototype.addLayer=function(r){return function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})}(this,void 0,void 0,function(){var s,a,u,c,p;return function(t,e){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,function(l){switch(l.label){case 0:return[4,i(e+"/api/v1/geoservices/"+r.qmsId)];case 1:return(s=l.sent())&&(a=o[s.type],(u=t.mapAdapter.layerAdapters[a])&&"TILE"===a)?(c=("https:"===location.protocol?"https":"http")+"://",p=s.url.replace(/^(https?|ftp):\/\//,c),r.url=p,r.name=s.name,r.attribution=s.copyright_text,r.maxZoom=t.options.maxZoom,r.minZoom=t.options.minZoom,this.options=n({},this.options,r,{baseLayer:!0}),[2,new u(this.map,r).addLayer(r)]):[2]}})})},r}()}(t,this.url)},t}();r.d(e,"QmsKit",function(){return a}),e.default=a}]).default},36:function(t,e,r){"undefined"!=typeof self&&self,t.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";var n,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};n=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!=t};function a(){a.init.call(this)}t.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function c(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function p(t,e,r,n){var o,i,s,a;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),i=t._events),s=i[e]),void 0===s)s=i[e]=r,++t._eventsCount;else if("function"==typeof s?s=i[e]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(o=c(t))>0&&s.length>o&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=s.length,a=u,console&&console.warn&&console.warn(a)}return t}function l(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},o=function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,i(this.listener,this.target,t))}.bind(n);return o.listener=r,n.wrapFn=o,o}function f(t,e,r){var n=t._events;if(void 0===n)return[];var o=n[e];return void 0===o?[]:"function"==typeof o?r?[o.listener||o]:[o]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(o):d(o,o.length)}function h(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function d(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");u=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n="error"===t,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[t];if(void 0===u)return!1;if("function"==typeof u)i(u,this,e);else{var c=u.length,p=d(u,c);for(r=0;r<c;++r)i(p[r],this,e)}return!0},a.prototype.addListener=function(t,e){return p(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return p(this,t,e,!0)},a.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,l(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,l(this,t,e)),this},a.prototype.removeListener=function(t,e){var r,n,o,i,s;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(o=-1,i=r.length-1;i>=0;i--)if(r[i]===e||r[i].listener===e){s=r[i].listener,o=i;break}if(o<0)return this;0===o?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,o),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,s||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var o,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(o=i[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},a.prototype.listeners=function(t){return f(this,t,!0)},a.prototype.rawListeners=function(t){return f(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):h.call(t,e)},a.prototype.listenerCount=h,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(t,e,r){"use strict";(function(t,e){!function(){function r(t){var e=this.constructor;return this.then(function(r){return e.resolve(t()).then(function(){return r})},function(r){return e.resolve(t()).then(function(){return e.reject(r)})})}function n(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(t,this)}function i(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,o._immediateFn(function(){var r=1===t._state?e.onFulfilled:e.onRejected;if(null!==r){var n;try{n=r(t._value)}catch(t){return void a(e.promise,t)}s(e.promise,n)}else(1===t._state?s:a)(e.promise,t._value)})):t._deferreds.push(e)}function s(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof o)return t._state=3,t._value=e,void u(t);if("function"==typeof r)return void c(function(t,e){return function(){t.apply(e,arguments)}}(r,e),t)}t._state=1,t._value=e,u(t)}catch(e){a(t,e)}}function a(t,e){t._state=2,t._value=e,u(t)}function u(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,r=t._deferreds.length;r>e;e++)i(t,t._deferreds[e]);t._deferreds=null}function c(t,e){var r=!1;try{t(function(t){r||(r=!0,s(e,t))},function(t){r||(r=!0,a(e,t))})}catch(t){if(r)return;r=!0,a(e,t)}}var p=setTimeout;o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var r=new this.constructor(n);return i(this,new function(t,e,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=r}(t,e,r)),r},o.prototype.finally=r,o.all=function(t){return new o(function(e,r){function n(t,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){n(t,e)},r)}o[t]=s,0==--i&&e(o)}catch(t){r(t)}}if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var o=Array.prototype.slice.call(t);if(0===o.length)return e([]);for(var i=o.length,s=0;o.length>s;s++)n(s,o[s])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,r){r(t)})},o.race=function(t){return new o(function(e,r){for(var n=0,o=t.length;o>n;n++)t[n].then(e,r)})},o._immediateFn="function"==typeof t&&function(e){t(e)}||function(t){p(t,0)},o._unhandledRejectionFn=function(t){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw Error("unable to locate global object")}();"Promise"in l?l.Promise.prototype.finally||(l.Promise.prototype.finally=r):l.Promise=o}()}).call(this,r(3).setImmediate,r(0))},function(t,e,r){(function(t){var n=void 0!==t&&t||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;function i(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new i(o.call(setTimeout,n,arguments),clearTimeout)},e.setInterval=function(){return new i(o.call(setInterval,n,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(n,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},r(4),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,r(0))},function(t,e,r){(function(t,e){!function(t,r){"use strict";if(!t.setImmediate){var n,o,i,s,a,u=1,c={},p=!1,l=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?n=function(t){e.nextTick(function(){d(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,r=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=r,e}}()?(s="setImmediate$"+Math.random()+"$",a=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(s)&&d(+e.data.slice(s.length))},t.addEventListener?t.addEventListener("message",a,!1):t.attachEvent("onmessage",a),n=function(e){t.postMessage(s+e,"*")}):t.MessageChannel?((i=new MessageChannel).port1.onmessage=function(t){d(t.data)},n=function(t){i.port2.postMessage(t)}):l&&"onreadystatechange"in l.createElement("script")?(o=l.documentElement,n=function(t){var e=l.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,o.removeChild(e),e=null},o.appendChild(e)}):n=function(t){setTimeout(d,0,t)},f.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),r=0;r<e.length;r++)e[r]=arguments[r+1];var o={callback:t,args:e};return c[u]=o,n(u),u++},f.clearImmediate=h}function h(t){delete c[t]}function d(t){if(p)setTimeout(d,0,t);else{var e=c[t];if(e){p=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(r,n)}}(e)}finally{h(t),p=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,r(0),r(5))},function(t,e){var r,n,o=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(t){r=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var u,c=[],p=!1,l=-1;function f(){p&&u&&(p=!1,u.length?c=u.concat(c):l=-1,c.length&&h())}function h(){if(!p){var t=a(f);p=!0;for(var e=c.length;e;){for(u=c,c=[];++l<e;)u&&u[l].run();l=-1,e=c.length}u=null,p=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function y(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new d(t,e)),1!==c.length||p||a(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e,r){"use strict";r.r(e),r(2);var n=/\{ *([\w_-]+) *\}/g;function o(t,e){return t.replace(n,function(t,r){var n=e[r];if(void 0===n)throw new Error("No value provided for letiable "+t);return"function"==typeof n&&(n=n(e)),n})}var i=r(1),s=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})},a=function(t,e){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},u=function(){function t(t){void 0===t&&(t={}),this.options=t,this.emitter=new i.EventEmitter,this.routeStr="/api/component/pyramid/route",this._loadingQueue={},this._loadingStatus={},this.options.route&&(this.routeStr=this.options.route)}return t.prototype.connect=function(){return s(this,void 0,void 0,function(){var t,e,r,n=this;return a(this,function(o){switch(o.label){case 0:return this.route?[2,Promise.resolve(this.route)]:[3,1];case 1:return this.options.auth?(t=this.options.auth,e=t.login,r=t.password,e&&r?[4,this.getUserInfo({login:e,password:r})]:[3,3]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.makeQuery(this.routeStr,{},{}).then(function(t){return n.route=t,t})];case 4:return[2,o.sent()]}})})},t.prototype.getUserInfo=function(t){var e=this;return t&&(this.options.auth=t),this.makeQuery("/api/component/auth/current_user",{},{headers:this.getAuthorizationHeaders(t)}).then(function(t){return e.user=t,e.emitter.emit("login",t),t}).catch(function(t){throw e.emitter.emit("login:error",t),t})},t.prototype.getAuthorizationHeaders=function(t){return{Authorization:"Basic "+this.makeClientId(t)}},t.prototype.makeClientId=function(t){if(t=t||this.options.auth){var e=t.login,r=t.password;return window.btoa(unescape(encodeURIComponent(e+":"+r)))}},t.prototype.request=function(t,e,r){return void 0===e&&(e={}),s(this,void 0,void 0,function(){var n,i,s,u,c,p,l,f,h;return a(this,function(a){switch(a.label){case 0:return[4,this.connect()];case 1:for(i in n=a.sent())if(n.hasOwnProperty(i)&&i===t){if(s=n[i].slice(),u=s.shift(),s.length){for(c={},p=0;p<s.length;p++)if(l=s[p],c[p]="{"+l+"}",void 0===e[l])throw new Error("`"+l+"` url api argument is not specified");u&&(u=o(u,c))}if(e){for(h in f=[],e)e.hasOwnProperty(h)&&-1===s.indexOf(h)&&f.push(h+"="+e[h]);f.length&&(u=u+"/?"+f.join("&"))}if(u)return[2,this.makeQuery(u,e,r)];throw new Error("request url is not set")}return[2]}})})},t.prototype.post=function(t,e,r){return(e=e||{}).method="POST",e.nocache=!0,this.request(t,r,e)},t.prototype.get=function(t,e,r){return(e=e||{}).method="GET",e.nocache=!0,this.request(t,r,e)},t.prototype.makeQuery=function(t,e,r){var n=this;if(void 0===r&&(r={}),t=(this.options.baseUrl?this.options.baseUrl:"")+t)return e&&(t=o(t,e)),t=t.replace(/([^:]\/)\/+/g,"$1"),!this._loadingStatus[t]||r.nocache?(this._loadingStatus[t]=!0,this._getJson(t,r).then(function(e){return n._loadingStatus[t]=!1,n._executeLoadingQueue(t,e),e}).catch(function(e){throw n._loadingStatus[t]=!1,n._executeLoadingQueue(t,e,!0),n.emitter.emit("error",e),e})):(this._loadingStatus[t]=!1,new Promise(function(e,r){n._setLoadingQueue(t,e,r)}));throw new Error("No `url` parameter set for option "+name)},t.prototype._setLoadingQueue=function(t,e,r){this._loadingQueue[t]=this._loadingQueue[t]||{name:t,waiting:[]},this._loadingQueue[t].waiting.push({resolve:e,reject:r,timestamp:new Date})},t.prototype._executeLoadingQueue=function(t,e,r){var n=this._loadingQueue[t];if(n){for(var o=0;o<n.waiting.length;o++){var i=n.waiting[o];r?i.reject&&i.reject():i.resolve(e)}n.waiting=[]}},t.prototype._getJson=function(t,e){var r=this;return new Promise(function(n,o){r.user&&((e=e||{}).headers=r.getAuthorizationHeaders()),function(t,e,r,n){var o;void 0===r&&(r={}),r.method=r.method||"GET",(o=new XMLHttpRequest).open(r.method||"GET",t,!0);var i=function(t){void 0===t&&(t=!1);var r=t?n:e;if(o.responseText)try{r(JSON.parse(o.responseText))}catch(t){n({message:""})}else n({message:""})};o.onreadystatechange=function(){4===o.readyState&&200===o.status||3===o.readyState&&201===o.status?i():3===o.readyState&&400===o.status?i():4===o.readyState&&500===o.status&&i()},o.onerror=function(t){n(t)},o.upload.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;r.onProgress&&r.onProgress(e)}};var s,a=r.headers;if(a)for(var u in a)if(a.hasOwnProperty(u)){var c=a[u];"string"==typeof c&&o.setRequestHeader(u,c)}if(void 0!==r.withCredentials&&(o.withCredentials=r.withCredentials),r.file){if((s=new FormData).append("file",r.file),r.data)for(var p in s)s.hasOwnProperty(p)&&s.append(p,s[p])}else s=r.data?JSON.stringify(r.data):null;o.send(s)}(t,n,e,o)})},t}();r.d(e,"NgwConnector",function(){return u}),e.default=u}]).default},69:function(t,e,r){"undefined"!=typeof self&&self,t.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e),r.d(e,"getIcon",function(){return i});var n={brill:'<path d="m6 0-5 6 5 6 5-6z"/>',circle:'<circle cx="6" cy="6" r="6"/>',rect:'<rect width="12" height="12"/>',marker:'<path d="m6 0c-1.85 0-4 1.19-4 4.22 0 2.05 3.08 6.59 4 7.78 0.821-1.19 4-5.62 4-7.78 0-3.03-2.15-4.22-4-4.22z"/>',cross:'<path d="M 2.4,12 6,8.4 9.6,12 12,9.6 8.4,6 12,2.4 9.6,0 6,3.6 2.4,0 0,2.4 3.6,6 0,9.6 Z"/>',star:'<path d="m6 0.25 1.71 4.18 4.29-1.04e-4 -3.43 3.14 0.857 4.18-3.43-3.14-3.43 3.14 0.857-4.18-3.43-3.14 4.29-0.209z"/>',triangle:'<path d="m12 11.7h-12l6-11.2z"/>',plus:'<path d="m7.5 12v-4.5h4.5v-3h-4.5v-4.5h-3v4.5h-4.5v3h4.5v4.5z"/>',minus:'<path d="m12 7.5v-3h-12v3z"/>',asterisk:'<path d="m7.59 12v-3.27l2.83 1.64 1.58-2.74-2.85-1.64 2.83-1.64-1.56-2.74-2.83 1.64v-3.24h-3.17v3.24l-2.85-1.64-1.57 2.74 2.84 1.64-2.84 1.64 1.57 2.74 2.85-1.64v3.27z"/>'},o=.8;function i(t){void 0===t&&(t={});var e=t.shape||"circle",r=t.color||"blue",i=t.strokeColor||"white",s=t.size||12,a=s/2,u="number"==typeof t.stroke?t.stroke:o,c=s/12,p=n[e]||"circle",l=function(t,e,r,n){void 0===r&&(r=0);var o=r/2,i='<svg\n    version="1.1"\n    xmlns="http://www.w3.org/2000/svg"\n    width="'+t+'"\n    height="'+e+'"\n    viewBox="-'+o+" -"+o+" "+(t+r)+" "+(e+r)+'"\n  >'+n+"</svg>";return(new DOMParser).parseFromString(i,"image/svg+xml").documentElement}(s,s,u*c,"string"==typeof p?p:p(t)),f=l.firstChild,h="scale("+c+")";return f.setAttribute("fill",r),u&&(f.setAttribute("stroke",i),f.setAttribute("stroke-width",String(u))),f.setAttribute("transform",h),{type:"icon",iconSize:[s,s],iconAnchor:[a,a],html:(new XMLSerializer).serializeToString(l)}}}])},75:function(t,e,r){var n,o,i,s,a,u,c,p;"undefined"!=typeof self&&self,t.exports=(n=r(152),o=r(153),i=r(69),s=r(36),a=r(155),u=r(24),c=r(156),p=r(157),function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=8)}([function(t,e){t.exports=n},function(t,e,r){"use strict";var n=r(0),o=r.n(n),i=r(4),s=r.n(i),a=r(5),u=r.n(a),c=r(2),p=r.n(c),l=r(3);function f(){return h("map:created")}function h(t){return function(e,r,n){var o=n.value;return n.value=function(){for(var e=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return new Promise(function(n,i){var s=function(){var t=o.apply(e,r);t&&t.then?t.then(n).catch(i):n(t)};void 0!==e._eventsStatus[t]&&e._eventsStatus[t]?s():e.emitter.once(t,function(){s()})})},n}}r(9);var d,y=(d=function(t,e){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),v=function(){return(v=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function m(t){return t.replace(/([^:]\/)\/+/g,"$1")}function b(t){for(var e,r={},n=0;n<t.length;n++)r[t[n]]=1+(r[t[n]]||0);for(var o in r)if(r.hasOwnProperty(o)){var i=void 0!==e?r[e]:0;r[o]>(i||0)&&(e=o)}return e}var g=r(6),_=r(7);r.d(e,"a",function(){return j});var w=function(){return(w=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},O=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},L=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},P={"EPSG:3857":"+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"},x={Point:"circle",LineString:"line",MultiPoint:"circle",Polygon:"fill",MultiLineString:"line",MultiPolygon:"fill"},j=function(){function t(t,e){var r=this;this.options={target:"map",baseUrl:"http://dev.nextgis.com/sandbox",controls:["ZOOM","ATTRIBUTION"],controlsOptions:{ZOOM:{position:"top-left"},ATTRIBUTION:{position:"bottom-right",customAttribution:['<a href="http://nextgis.ru" target="_blank">©NextGIS</a>']}},geoJsonDefaultPaint:{circle:{type:"circle",color:"blue",opacity:1,radius:6,stroke:!1},path:{type:"path",color:"blue",opacity:1,stroke:!1,weight:1},icon:Object(l.getIcon)({shape:"circle"})}},this.emitter=new g.EventEmitter,this._eventsStatus={},this._ngwLayers={},this.options=function t(e,r,n){void 0===n&&(n=!1);var o=Array.isArray(r),i=o&&[]||{};return o?n?(e=e||[],i=i.concat(e),r.forEach(function(r,o){void 0===i[o]?i[o]=r:"object"==typeof r?i[o]=t(e[o],r,n):-1===e.indexOf(r)&&i.push(r)})):i=r:(e&&"object"==typeof e&&Object.keys(e).forEach(function(t){i[t]=e[t]}),Object.keys(r).forEach(function(o){"object"==typeof r[o]&&r[o]&&"object"==typeof e[o]&&"object"==typeof r[o]?i[o]=t(e[o],r[o],n):i[o]=r[o]})),i}(this.options,e),this.connector=new s.a({baseUrl:this.options.baseUrl});var n=[new u.a];if(this.options.baseUrl&&this.options.webmapId){var i=this.options.webmapId;n.push(new p.a({baseUrl:this.options.baseUrl,resourceId:i}))}this.webMap=new o.a({mapAdapter:t,starterKits:n}),this._createWebMap().then(function(){r._addControls()}),this._addEventsListeners()}return t.prototype.fit=function(){var t=this.options,e=t.center,r=t.zoom,n=t.bounds;e?(this.webMap.setCenter(e),r&&this.webMap.setZoom(r)):n&&this.fitBounds(n)},t.prototype.fitBounds=function(t){var e=t[0],r=t[1],n=t[2],o=t[3];this.webMap.fit([e,r,n,o])},t.prototype.addControl=function(t,e,r){this.webMap.addControl(t,e,r)},t.prototype.addNgwLayer=function(e,r){return function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})}(this,void 0,void 0,function(){var n,o,i=this;return function(t,e){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,function(s){if(!e.resourceId)throw new Error("resourceId is required parameter to add NGW layer");return"GEOJSON"===e.adapter?(n=this.connector.makeQuery("/api/resource/{id}/geojson",{id:e.resourceId}).then(function(r){var n={data:r=t.toWgs84(r)};return e.id&&(n.id=e.id),i._updateGeojsonAdapterOptions(n)}),a=n,u=this.webMap.mapAdapter,o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.addLayer=function(e){var r=this;return a.then(function(n){return t.prototype.addLayer.call(r,v({},e,n))})},e}(u.layerAdapters.GEOJSON),[2,this.addGeoJsonLayer(r||{},o)]):this.options.baseUrl&&(o=p.a.addNgwLayer(e,this.webMap,this.options.baseUrl))?[2,o.then(function(t){var r=t&&i.webMap.getLayerId(t);if(t&&r)return i._ngwLayers[r]={layer:t,resourceId:e.resourceId},i.webMap.showLayer(t),t})]:[2];var a,u})})},t.prototype.addGeoJsonLayer=function(t,e){var r=this;return(t=t||{}).multiselect=void 0!==t.multiselect&&t.multiselect,t.unselectOnSecondClick=void 0===t.unselectOnSecondClick||t.unselectOnSecondClick,e||(t=this._updateGeojsonAdapterOptions(t)),this.webMap.addLayer(e||"GEOJSON",t).then(function(t){return r.webMap.showLayer(t),t})},t.prototype.zoomToLayer=function(t){var e,r=this,n=(e="string"==typeof t||"number"==typeof t?String(e):t.id)&&this._ngwLayers[e];if(n){var o=n.resourceId;return this.connector.request("resource.item",{id:o}).then(function(t){if(t)return"raster_style"===t.resource.cls?r.connector.request("resource.item",{id:t.resource.parent.id}).then(function(t){return r._fitNgwLayerExtend(t.resource.id)}):r._fitNgwLayerExtend(o)})}},t.prototype._updateGeojsonAdapterOptions=function(t){if(t.data){var e=x[function(t){return"FeatureCollection"===t.type?b(t.features.map(function(t){return t.geometry.type})):"GeometryCollection"===t.type?b(t.geometries.map(function(t){return t.type})):"Feature"===t.type?t.geometry.type:t.type}(t.data)],r=t.paint;"object"==typeof r&&(r.type=r.type?r.type:"fill"===e||"line"===e?"path":"html"in r||"className"in r?"icon":e,this.options.geoJsonDefaultPaint&&("circle"===r.type?t.paint=w({},this.options.geoJsonDefaultPaint.circle,r):"path"===r.type?t.paint=w({},this.options.geoJsonDefaultPaint.path,r):"icon"===r.type&&(t.paint=w({},this.options.geoJsonDefaultPaint.icon,r)))),t.type=e}return t},t.prototype._fitNgwLayerExtend=function(t){var e=this;return this.connector.request("layer.extent",{id:t}).then(function(t){var r=t.extent,n=r.maxLat,o=r.maxLon,i=r.minLat,s=r.minLon;e.fitBounds([s,i,o,n])})},t.prototype._createWebMap=function(){var t=this;return this.webMap.create(w({},this.options)).then(function(){if(t._emitStatusEvent("map:created"),t.options.qmsId){var e=void 0,r=void 0;Array.isArray(t.options.qmsId)?(e=t.options.qmsId[0],r=t.options.qmsId[1]):e=t.options.qmsId;var n={qmsId:e};r&&(n.id=r),t.webMap.addBaseLayer("QMS",n).then(function(e){t.webMap.showLayer(e)})}t.fit()})},t.prototype._addControls=function(){var t=this;this.options.controls&&this.options.controls.forEach(function(e){var r={};"string"==typeof e&&t.options.controlsOptions&&(r=t.options.controlsOptions[e]);var n=r.position,o=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&(r[n[o]]=t[n[o]])}return r}(r,["position"]);t.webMap.addControl(e,n||"top-left",o)}),this._emitStatusEvent("control:created")},t.prototype._addEventsListeners=function(){var t=this;this.webMap.emitter.on("click",function(e){return t.emitter.emit("click",e)}),this.webMap.emitter.on("layer:click",function(e){return t.emitter.emit("layer:click",e)})},t.prototype._emitStatusEvent=function(t){this._eventsStatus[t]=!0,this.emitter.emit(t)},t.utils={fixUrlStr:m},t.decorators={onMapLoad:f},t.getIcon=l.getIcon,t.toWgs84=function(t){return Object(_.toWgs84)(t,P["EPSG:3857"],P)},O([h("control:created"),L("design:type",Function),L("design:paramtypes",[Object,String,Object]),L("design:returntype",void 0)],t.prototype,"addControl",null),O([f(),L("design:type",Function),L("design:paramtypes",[Object,Object]),L("design:returntype",Promise)],t.prototype,"addNgwLayer",null),O([f(),L("design:type",Function),L("design:paramtypes",[Object,Object]),L("design:returntype",void 0)],t.prototype,"addGeoJsonLayer",null),t}()},function(t,e){t.exports=o},function(t,e){t.exports=i},function(t,e){t.exports=s},function(t,e){t.exports=a},function(t,e){t.exports=u},function(t,e){t.exports=c},function(t,e,r){"use strict";r.r(e);var n=r(1);r.d(e,"NgwMap",function(){return n.a});var o=r(0);for(var i in o)["NgwMap","default"].indexOf(i)<0&&function(t){r.d(e,t,function(){return o[t]})}(i);e.default=n.a},function(t,e){t.exports=p}]).default)},81:function(t,e,r){var n,o,i;"undefined"!=typeof self&&self,t.exports=(n=r(140),o=r(24),i=function(){try{return r(141)}catch(t){}}(),function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e){t.exports=n},function(t,e){t.exports=o},function(t,e){if(void 0===i){var r=new Error("Cannot find module 'canvg'");throw r.code="MODULE_NOT_FOUND",r}t.exports=i},function(t,e,r){"use strict";r.r(e);var n,o,i=0,s=function(){function t(t,e){this.map=t,this.options=e,this._layerId="layer-"+i++}return t.prototype.addLayer=function(t){return[""]},t}(),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),u=function(){return(u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.addLayer=function(t){var e=(t=this.options=u({},this.options,t||{})).id||this._layerId,r={id:e,type:t.type||"fill","source-layer":t["source-layer"]||e,source:{type:"vector",tiles:[t.url]},layout:{visibility:"none"}};return t.paint&&(r.paint=t.paint),this.map.addLayer(r,t.before),this.layer=[e],this.layer},e}(s),p=r(0),l=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),f=function(){return(f=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.addLayer=function(t){var e={type:"raster",tiles:(t=f({},this.options,t||{}))&&t.subdomains?t.subdomains.split("").map(function(e){return t.url.replace("{s}",e)}):[t.url],tileSize:256};return t.attribution&&(e.attribution=t.attribution),this.map.addLayer({id:this._layerId,type:"raster",layout:{visibility:"none"},source:e},t.before),this.layer=[this._layerId]},e}(s),d=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),y={url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright" target="_blank">OpenStreetMap</a> contributors',subdomains:"abc"},v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return d(e,t),e.prototype.addLayer=function(e){return t.prototype.addLayer.call(this,Object.assign({},y,e))},e}(h),m=r(1),b=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),g=function(){return(g=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},_=function(t){function e(e){return void 0===e&&(e={}),e=g({},e,{showCompass:!1}),t.call(this,e)||this}return b(e,t),e.prototype._createButton=function(e,r,n){var o=t.prototype._createButton.call(this,e,r,n),i={"Zoom in":"zoomInTitle","Zoom out":"zoomOutTitle"}[r],s=i&&this.options[i];return s&&(o.title=s,o.setAttribute("aria-label",s)),o},e}(p.NavigationControl),w=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),O=function(t){function e(e){return void 0===e&&(e={}),e=Object.assign({},e,{showZoom:!1}),t.call(this,e)||this}return w(e,t),e}(p.NavigationControl),L=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return L(e,t),e}(p.AttributionControl);try{o=r(2)}catch(t){}function x(t,e){var r=window.document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return r.setAttribute("width",String(e.width)),r.setAttribute("height",String(e.height)),!o&&t instanceof HTMLImageElement?n.drawImage(t,0,0,e.width,e.height):"string"==typeof t&&o(r,t),n.getImageData(0,0,e.width,e.height)}var j=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),k=function(){return(k=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},E=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})},I=function(t,e){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},A=["color","opacity"],S={circle:A.concat(["radius"]),line:A.concat([["weight","width"]]),fill:A.concat([])},C={Point:"circle",LineString:"line",MultiPoint:"circle",Polygon:"fill",MultiLineString:"line",MultiPolygon:"fill",GeometryCollection:"fill"},M={};for(var T in C)if(C.hasOwnProperty(T)){var F=C[T],R=M[F]||[];R.push(T),M[F]=R}var N={color:"blue",opacity:1,radius:10},D=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.map=e,n.options=r,n.selected=!1,n._features=[],n._selectedFeatureIds=[],n._filteredFeatureIds=[],n.$onLayerClick=n._onLayerClick.bind(n),n}return j(e,t),e.prototype.addLayer=function(t){return E(this,void 0,void 0,function(){var e,r,n,o;return I(this,function(i){switch(i.label){case 0:return t=this.options=k({},this.options,t||{}),e=t.data,t.type&&(r=t.type),!r&&e&&(n=function(t){var e;if("FeatureCollection"===t.type){var r=t.features.map(function(t){return t.geometry.type});e=U(r)}else if("GeometryCollection"===t.type){var n=t.geometries.map(function(t){return t.type});e=U(n)}else e="Feature"===t.type?t.geometry.type:t.type;return e}(e),r=C[n]),e&&r?(this._data=this.filterGeometries(e,r),this._features.forEach(function(t,e){var r="_"+e;t._rendrom_id=r,t.properties&&(t.properties._rendrom_id=r)}),o=e,this.layer=[this._layerId],t.paint?[4,this._addLayer(this._layerId,o,t.paint,r)]:[3,3]):[3,4];case 1:return i.sent(),t.selectedPaint?(this._selectionName=this._layerId+"-highlighted",[4,this._addLayer(this._selectionName,o,t.selectedPaint,r)]):[3,3];case 2:i.sent(),this.map.setFilter(this._selectionName,["in","_rendrom_id",""]),this.layer.push(this._selectionName),i.label=3;case 3:return this._addEventsListeners(),[2,this.layer];case 4:throw new Error("No geometry for given type")}})})},e.prototype.getLayers=function(){var t=this,e=this._filteredFeatureIds.length;return this._features.map(function(r){var n=!1;if(e){var o=t._getRendromId(r);void 0!==o&&(n=-1!==t._filteredFeatureIds.indexOf(o))}return{feature:r,visible:n}})},e.prototype.filter=function(t){var e=this;this._filteredFeatureIds=[],this._features.forEach(function(r){var n=t({feature:r}),o=e._getRendromId(r);n&&o&&e._filteredFeatureIds.push(o)}),this._updateFilter()},e.prototype.getSelected=function(){var t=this,e=[];return this._features.forEach(function(r){var n=t._getRendromId(r);n&&-1!==t._selectedFeatureIds.indexOf(n)&&e.push({feature:r})}),e},e.prototype.select=function(t){if(t){var e=this._features.filter(function(e){return t({feature:e})});this._selectFeature(e)}else this.selected||this._selectFeature(this._features);this.selected=!0},e.prototype.unselect=function(t){if(t){var e=this._features.filter(function(e){return t({feature:e})});this._unselectFeature(e)}else this.selected&&this._unselectFeature(this._features);this.selected=!!this._selectedFeatureIds.length},e.prototype._addLayer=function(t,e,r,n){return E(this,void 0,void 0,function(){var o,i;return I(this,function(s){switch(s.label){case 0:return o={id:String(t),source:{type:"geojson",data:e},layout:{visibility:"none"}},[4,this._createPaintForType(r,n,t)];case 1:return"icon-image"in(i=s.sent())?(i["icon-allow-overlap"]=!0,o.layout=k({},o.layout,i),o.type="symbol"):(o.paint=i,o.type=n),this.map.addLayer(o),[2]}})})},e.prototype.filterGeometries=function(t,e){if("FeatureCollection"===t.type){var r=t.features=t.features.filter(function(t){return G(t.geometry.type,e)});this._features=r}else if("Feature"===t.type){if(!G(t.geometry.type,e))return!1;this._features.push(t)}else"GeometryCollection"===t.type&&(t.geometries=t.geometries.filter(function(t){return G(t.type,e)}));return t},e.prototype._createPaintForType=function(t,e,r){return E(this,void 0,void 0,function(){var n,o,i,s;return I(this,function(a){switch(a.label){case 0:return"function"!=typeof t?[3,2]:[4,this._getPaintFromCallback(t,e,r)];case 1:return[2,a.sent()];case 2:return n={},o=k({},N,t||{}),"icon"===t.type&&t.html?[4,this._registrateImage(t)]:[3,4];case 3:return a.sent(),[2,{"icon-image":t.html}];case 4:for(s in i=function(t){if(o.hasOwnProperty(t)){var r=S[e];if(r){var i=r.find(function(e){return"string"==typeof e?e===t:!!Array.isArray(e)&&e[0]===t});if(i){var s=Array.isArray(i)?i[1]:i;n[e+"-"+s]=o[t]}}}},o)i(s);return[2,n]}})})},e.prototype._getPaintFromCallback=function(t,e,r){return E(this,void 0,void 0,function(){var n,o,i,s,a,u,c;return I(this,function(p){switch(p.label){case 0:n={},o=0,i=this._features,p.label=1;case 1:return o<i.length?(s=i[o],"icon"!==(a=t(s)).type?[3,3]:[4,this._registrateImage(a)]):[3,5];case 2:return p.sent(),s.properties&&(s.properties["_icon-image-"+r]=a.html),n["icon-image"]="{_icon-image-"+r+"}",[3,4];case 3:for(u in a)a.hasOwnProperty(u)&&(c=a[u],s.properties&&(s.properties["_paint_"+u+"_"+r]=c),n[u]=["get","_paint_"+u+"_"+r]);p.label=4;case 4:return o++,[3,1];case 5:return"icon-image"in n?[2,n]:[2,this._createPaintForType(n,e,r)]}})})},e.prototype._registrateImage=function(t){return E(this,void 0,void 0,function(){var e,r,n;return I(this,function(i){switch(i.label){case 0:return t.html?this.map.hasImage(t.html)?[3,2]:(e=12,r=12,t.iconSize&&(e=t.iconSize[0],r=t.iconSize[1]),[4,(s=t.html,a={width:e,height:r},new Promise(function(t){if(o)t(x(s,a));else{var e=new Image;e.crossOrigin="Anonymous",e.src="data:image/svg+xml;base64,"+btoa(s),e.onload=function(){var r=x(e,a);t(r)}}}))]):[3,2];case 1:n=i.sent(),this.map.addImage(t.html,n),i.label=2;case 2:return[2]}var s,a})})},e.prototype._onLayerClick=function(t){t.preventDefault();var e=this.map.queryRenderedFeatures(t.point,{layers:this.layer})[0],r=this._getRendromId(e);if(e&&void 0!==r){var n=-1!==this._selectedFeatureIds.indexOf(r);n?this.options&&this.options.unselectOnSecondClick&&(this._unselectFeature(e),n=!1):(this._selectFeature(e),n=!0),this.options.onLayerClick&&this.options.onLayerClick({layer:this,feature:e,selected:n})}},e.prototype._selectFeature=function(t){var e=this;this.options&&!this.options.multiselect&&(this._selectedFeatureIds=[]),(Array.isArray(t)?t:[t]).forEach(function(t){var r=e._getRendromId(t);void 0!==r&&e._selectedFeatureIds.push(r)}),this._updateFilter()},e.prototype._unselectFeature=function(t){var e=this;(Array.isArray(t)?t:[t]).forEach(function(t){var r=e._getRendromId(t);if(void 0!==r){var n=e._selectedFeatureIds.indexOf(r);-1!==n&&e._selectedFeatureIds.splice(n,1)}}),this._updateFilter()},e.prototype._updateFilter=function(){var t=this,e=[],r=[];this._filteredFeatureIds.length?this._features.forEach(function(n){var o=t._getRendromId(n);void 0!==o&&-1!==t._filteredFeatureIds.indexOf(o)&&(-1!==t._selectedFeatureIds.indexOf(o)?e.push(o):r.push(o))}):e=this._selectedFeatureIds,this._selectionName&&this.map.setFilter(this._selectionName,["in","_rendrom_id"].concat(e)),this._filteredFeatureIds.length?this.map.setFilter(this._layerId,["in","_rendrom_id"].concat(r)):this.map.setFilter(this._layerId,["!in","_rendrom_id"].concat(e))},e.prototype._addEventsListeners=function(){var t=this;this.layer&&this.options&&this.options.selectable&&this.layer.forEach(function(e){if(t.$onLayerClick){var r=t.$onLayerClick;t.map.on("click",e,function(t){r(t)})}t.map.on("mousemove",e,function(){t.map.getCanvas().style.cursor="pointer"}),t.map.on("mouseleave",e,function(){t.map.getCanvas().style.cursor=""})})},e.prototype._getRendromId=function(t){var e=t._rendrom_id;return void 0!==e?e:t.properties&&void 0!==t.properties._rendrom_id?t.properties._rendrom_id:void 0},e}(s);function G(t,e){var r=M[e];return!!r&&-1!==r.indexOf(t)}function U(t){for(var e={},r=0;r<t.length;r++)e[t[r]]=1+(e[t[r]]||0);var n="";for(var o in e)if(e.hasOwnProperty(o)){var i=n?e[n]:0;e[o]>i&&(n=o)}return n}function B(t,e){return void 0===e&&(e={}),new(function(){function r(){}return r.prototype.getDefaultPosition=function(){return"top-left"},r.prototype.onAdd=function(r){var n=document.createElement("div"),o=t.onAdd();return n.classList.add("mapboxgl-ctrl"),e.bar&&n.classList.add("mapboxgl-bar"),e.addClass&&n.classList.add(e.addClass),n.appendChild(o),this._container=n,this._container},r.prototype.onRemove=function(){if(this._container){var e=this._container.parentNode;e&&e.removeChild(this._container)}return t.onRemove()},r.prototype.remove=function(){this.onRemove()},r}())}var z=function(){return(z=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Z=function(){function t(){this.options={},this.emitter=new m.EventEmitter,this.layerAdapters=t.layerAdapters,this.controlAdapters=t.controlAdapters,this.isLoaded=!1,this._sourceDataLoading={}}return t.prototype.create=function(t){this.map||(this.options=t,t.target&&(this.map=new p.Map({container:t.target,center:[96,63],zoom:2,attributionControl:!1,style:{version:8,name:"Empty style",sources:{},layers:[]}}),this._addEventsListeners(),this.onMapLoad()))},t.prototype.getContainer=function(){return this.map&&this.map.getContainer()},t.prototype.setView=function(t,e){this.map&&this.map.jumpTo({center:t,zoom:e})},t.prototype.setCenter=function(t){this.map&&this.map.setCenter(t)},t.prototype.setZoom=function(t){this.map&&this.map.setZoom(t)},t.prototype.getZoom=function(){if(this.map)return this.map.getZoom()},t.prototype.fit=function(t,e){void 0===e&&(e={}),this.map&&this.map.fitBounds([[t[0],t[1]],[t[2],t[3]]],z({linear:!0},e))},t.prototype.setRotation=function(t){},t.prototype.showLayer=function(t){var e=this;t.forEach(function(t){e._toggleLayer(t,!0)})},t.prototype.hideLayer=function(t){var e=this;t.forEach(function(t){e._toggleLayer(t,!1)})},t.prototype.removeLayer=function(t){if(this.map){var e=this.map;t.forEach(function(t){e.removeLayer(t),e.removeSource(t)})}},t.prototype.setLayerOrder=function(t,e,r){var n=this.map;if(n){var o=[],i=[];for(var s in r)if(r.hasOwnProperty(s)){var a=r[s];a.options.baseLayer?o.push(a):i.push(a)}var u=(i=i.sort(function(t,e){return void 0!==t.options.order&&void 0!==e.options.order?t.options.order-e.options.order:0})).find(function(t){return Array.isArray(t.layer)});if(u){var c=this._getLayerIds(u)[0];o.forEach(function(t){t.layer&&t.layer.forEach(function(t){n.moveLayer(t,c)})})}for(var p=function(t){var e=i[t+1],r=e&&e.layer&&e.layer[0],o=i[t];l._getLayerIds(o).forEach(function(t){n.moveLayer(t,r)})},l=this,f=0;f<i.length;f++)p(f)}},t.prototype.setLayerOpacity=function(t,e){var r=this,n=this.map;n&&t.forEach(function(t){r.onMapLoad().then(function(){var r=n.getLayer(t);r&&n.setPaintProperty(t,r.type+"-opacity",e)})})},t.prototype.onMapLoad=function(t){var e=this;return new Promise(function(r){var n=function(){t&&t(),e.map&&r(e.map)};e.isLoaded?n():e.map&&e.map.once("load",function(){e.isLoaded=!0,n()})})},t.prototype.createControl=function(t){return B(t)},t.prototype.createButtonControl=function(t){return function(t){var e=document.createElement("button");e.className="mapboxgl-ctrl-icon",e.setAttribute("role","button"),t.title&&(e.title=t.title,e.setAttribute("aria-label",t.title)),t.html&&(t.html instanceof HTMLElement?e.appendChild(t.html):e.innerHTML=t.html),t.addClass&&t.addClass.split(" ").forEach(function(t){return e.classList.add(t)});var r=function(e){e.stopPropagation(),t.onClick()};return t.onClick&&e.addEventListener("click",r),B({onAdd:function(){return e},onRemove:function(){var n=e.parentNode;n&&n.removeChild(e),t.onClick&&e.removeEventListener("click",r)}},{bar:!0,addClass:"mapboxgl-ctrl-group"})}(t)},t.prototype.addControl=function(t,e){if(this.map)return this.map.addControl(t,e),t},t.prototype.removeControl=function(t){this.map&&this.map.removeControl(t)},t.prototype.onMapClick=function(t){var e=t.lngLat,r=t.point,n=r.x,o=r.y;this.emitter.emit("click",{latLng:e,pixel:{top:o,left:n}})},t.prototype._getLayerIds=function(t){var e=[];return t&&(Array.isArray(t.layer)?e=t.layer:t.getDependLayers&&t.getDependLayers().forEach(function(t){t.forEach(function(t){e.push(t)})})),e},t.prototype._toggleLayer=function(t,e){this.onMapLoad().then(function(r){r.setLayoutProperty(t,"visibility",e?"visible":"none")})},t.prototype._onMapSourceData=function(t){var e=this;if("source"===t.dataType){var r=t.isSourceLoaded;this._onDataLoad(t,r,function(t){e.emitter.emit("data-loaded",{target:t})})}},t.prototype._onMapError=function(t){var e=this;if(this._sourceDataLoading[t.sourceId]){var r=t.isSourceLoaded;this._onDataLoad(t,r,function(t){e.emitter.emit("data-error",{target:t})})}},t.prototype._onDataLoad=function(t,e,r){if(void 0===e&&(e=!1),e)Object.keys(this._sourceDataLoading).forEach(function(t){r(t)}),this._sourceDataLoading={};else{var n=this._sourceDataLoading[t.sourceId];if(n&&t.tile){var o=n.indexOf(t.tile);-1!==o&&this._sourceDataLoading[t.sourceId].splice(o,1),n.length||(r(t.sourceId),delete this._sourceDataLoading[t.sourceId])}}},t.prototype._addEventsListeners=function(){var t=this;this.map&&(this.map.on("sourcedataloading",function(e){t._sourceDataLoading[e.sourceId]=t._sourceDataLoading[e.sourceId]||[],e.tile&&t._sourceDataLoading[e.sourceId].push(e.tile)}),this.map.on("sourcedata",this._onMapSourceData.bind(this)),this.map.on("error",this._onMapError.bind(this)),this.map.on("click",function(e){t.onMapClick(e)}))},t.layerAdapters={TILE:h,MVT:c,OSM:v,GEOJSON:D},t.controlAdapters={ZOOM:_,COMPASS:O,ATTRIBUTION:P},t}();r.d(e,"MapboxglMapAdapter",function(){return Z}),e.default=Z}]).default)}}]);
//# sourceMappingURL=npm.nextgis-b2ff613.js.map