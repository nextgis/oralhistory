(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{227:function(t,e,r){"use strict";var n=r(39),o=r(30),i=r(21),a=r(44),s=r(38),u=r(221);function c(){return a.a.decorators.onLoad("build-map")}var l=function(){return(l=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function p(t,e,r,n){if("number"==typeof e||"string"==typeof e)e=Number(e),t.push(l(l({},r),{resourceId:e}));else if(Array.isArray(e)){var o=e[0],i=e[1];t.push(l(l(l({},r),{resourceId:o,id:i}),n))}else"object"==typeof e&&t.push(l(l(l({},r),e),n))}var f=r(56),h=r(133),d={target:"map",baseUrl:"",controls:["ZOOM","ATTRIBUTION"],controlsOptions:{ZOOM:{position:"top-left"},ATTRIBUTION:{position:"bottom-right",customAttribution:['<a href="http://nextgis.ru" target="_blank">Â©NextGIS</a>']}},pixelRadius:10};var y,v=(y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),b=function(){return(b=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},m=function(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},w=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},g=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},_=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},I=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r},L=function(t){function e(e,r){var o=t.call(this,function(t,e){var r=[new h.a];e.connector?e.connector&&(e.baseUrl=e.connector.options.baseUrl):e.connector=new f.a({baseUrl:e.baseUrl||"",auth:e.auth});var n=Object(i.b)(d,e);return n.connector&&r.push(new s.a({connector:n.connector,auth:n.auth,identification:n.identification})),{mapAdapter:t,starterKits:r,runtimeParams:e.runtimeParams}}(e,r))||this;return o.emitter=new n.EventEmitter,o.options={},o._ngwLayers={},r.connector&&(o.connector=r.connector),o.options=Object(i.b)(d,r),o._createWebMap().then((function(){var t=o.getContainer();t&&t.classList.add("ngw-map-container"),o._addControls()})),o}return v(e,t),e.prototype.fit=function(){var t=this.options,e=t.center,r=t.zoom,n=t.bounds;e?(this.setCenter(e),r&&this.setZoom(r)):n&&this.fitBounds(n)},e.prototype.addControl=function(e,r,n){return g(this,void 0,void 0,(function(){return _(this,(function(o){return[2,t.prototype.addControl.call(this,e,r,n)]}))}))},e.prototype.addNgwLayer=function(t){return g(this,void 0,void 0,(function(){var e,r,n,o,i,a,u;return _(this,(function(c){switch(c.label){case 0:if(e=t.keyname,r=t.resourceId,n=t.resource,!e&&!r&&!n)throw new Error("resourceId or keyname is required parameter to add NGW layer");if(!this.options.baseUrl&&""!==this.options.baseUrl)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),o=s.a.utils.addNgwLayer(t,this,this.options.baseUrl,this.connector),[4,this.addLayer(o,b(b({visibility:!0},t),t.adapterOptions))];case 2:return i=c.sent(),a=i&&this.getLayerId(i),i&&a&&(this._ngwLayers[a]={layer:i,resourceId:i.resourceId},i.options.baseLayer&&this.getActiveBaseLayer()),[2,i];case 3:return u=c.sent(),console.error("can't add ngw layer",u),[3,4];case 4:return[2]}}))}))},e.prototype.getNgwLayerItem=function(t){return g(this,void 0,o.a,(function(){return _(this,(function(e){return[2,s.a.utils.getNgwLayerItem(b({connector:this.connector},t))]}))}))},e.prototype.getNgwLayerItems=function(t){return g(this,void 0,o.a,(function(){return _(this,(function(e){return[2,s.a.utils.getNgwLayerItems(b({connector:this.connector},t))]}))}))},e.prototype.getNgwLayerFeature=function(t){return g(this,void 0,o.a,(function(){return _(this,(function(e){return[2,s.a.utils.getNgwLayerFeature(b({connector:this.connector},t))]}))}))},e.prototype.getNgwLayerFeatures=function(t){return g(this,void 0,o.a,(function(){return _(this,(function(e){return[2,s.a.utils.getNgwLayerFeatures(b({connector:this.connector},t))]}))}))},e.prototype.getIdentifyGeoJson=function(t,e){return void 0===e&&(e=!1),g(this,void 0,o.a,(function(){return _(this,(function(r){return[2,s.a.utils.getIdentifyGeoJson({identify:t,connector:this.connector,multiple:e})]}))}))},e.prototype.getNgwLayers=function(){return g(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this.onLoad()];case 1:return t.sent(),[2,this._ngwLayers]}}))}))},e.prototype.getNgwLayerByResourceId=function(t){return g(this,void 0,void 0,(function(){var e,r,n,o,i,a,s,u;return _(this,(function(c){switch(c.label){case 0:for(r in e=[],this._ngwLayers)e.push(r);n=0,c.label=1;case 1:return n<e.length?(o=e[n],(i=this._ngwLayers[o]).resourceId!==t?[3,2]:[2,i&&i.layer]):[3,6];case 2:return i.layer.getIdentificationIds?[4,i.layer.getIdentificationIds()]:[3,4];case 3:if((a=c.sent())&&a.some((function(e){return e===t})))return[2,i.layer];c.label=4;case 4:if(i.layer.getDependLayers&&(s=i.layer.getDependLayers(),u=s.find((function(e){return e.item&&e.item.parentId===t}))))return[2,u.layer];c.label=5;case 5:return n++,[3,1];case 6:return[2]}}))}))},e.prototype.zoomToLayer=function(t){return g(this,void 0,void 0,(function(){var e,r,n,o,i,a=this;return _(this,(function(u){switch(u.label){case 0:return e="string"==typeof t||"number"==typeof t?String(e):t.id,(r=e&&this._ngwLayers[e])?r.layer.getExtent?[4,r.layer.getExtent()]:[3,2]:[3,6];case 1:return(n=u.sent())&&this.fitBounds(n),[3,6];case 2:return o=void 0,r.layer.item?(o=r.layer.item,[3,5]):[3,3];case 3:return i=r.resourceId,[4,this.connector.get("resource.item",null,{id:i})];case 4:o=u.sent(),u.label=5;case 5:s.a.utils.getNgwResourceExtent(o,this.connector).then((function(t){t&&a.fitBounds(t)})),u.label=6;case 6:return[2]}}))}))},e.prototype.onLoad=function(e){return void 0===e&&(e="ngw-map:create"),t.prototype.onLoad.call(this,e)},e.prototype.removeLayer=function(e){var r=this.getLayer(e);if(r){var n=this.getLayerId(r);n&&delete this._ngwLayers[n],t.prototype.removeLayer.call(this,r)}},e.prototype.enableSelection=function(){var t=this;this.__selectFromNgwRaster||(this.__selectFromNgwRaster=function(e){return t._selectFromNgwRaster(e)},this.__selectFromNgwVector=function(e){return t._selectFromNgwVector(e)},this.emitter.on("click",this.__selectFromNgwRaster),this.emitter.on("layer:click",this.__selectFromNgwVector))},e.prototype.disableSelection=function(){this.__selectFromNgwRaster&&(this.emitter.off("click",this.__selectFromNgwRaster),this.emitter.off("click",this._selectFromNgwVector),this.__selectFromNgwRaster=void 0,this.__selectFromNgwVector=void 0)},e.prototype._isFitFromResource=function(){var t=this._initMapState;return!t.zoom||!t.center},e.prototype._createWebMap=function(){return g(this,void 0,void 0,(function(){var t,e,r,n,o,i,a,s,u=this;return _(this,(function(c){switch(c.label){case 0:return[4,this.create(b({},this.options))];case 1:c.sent(),this.options.qmsId&&(t=void 0,e=void 0,Array.isArray(this.options.qmsId)?(t=this.options.qmsId[0],e=this.options.qmsId[1]):t=Number(this.options.qmsId),r={qmsId:t},e&&(r.id=e),this.addBaseLayer("QMS",r).then((function(t){u.showLayer(t)}))),n=[],o=this._isFitFromResource(),this.options.webmapId&&p(n,this.options.webmapId,{fit:o}),this.options.resources&&Array.isArray(this.options.resources)&&this.options.resources.forEach((function(t){var e={};o||(e.fit=!1),p(n,t,{},e)})),i=0,a=n,c.label=2;case 2:return i<a.length?(s=a[i],[4,this.addNgwLayer(s)]):[3,5];case 3:c.sent(),c.label=4;case 4:return i++,[3,2];case 5:return this._emitStatusEvent("ngw-map:create",this),this.enableSelection(),[2]}}))}))},e.prototype._addControls=function(){var t=this;this.options.controls&&this.options.controls.forEach((function(e){var r=e,n={};"string"==typeof e&&t.options.controlsOptions&&t.options.controlsOptions[e]&&void 0!==(n=t.options.controlsOptions[e]).control&&(r=n.control);var o=n.position,i=I(n,["position"]);t.addControl(r,o||"top-left",i)})),this._emitStatusEvent("controls:create")},e.prototype._selectFromNgwVector=function(t){return g(this,void 0,void 0,(function(){var e,r,n,o,i,a,s;return _(this,(function(u){return e=t.layer,r=e.item&&e.item.resource.id,n=t.feature,void 0!==r&&n&&(o=n.id)?(i={id:Number(o),fields:n.properties,label:"#"+r,layerId:Number(r),parent:"",geom:n.geometry},(s={featureCount:1})[r]={featureCount:1,features:[i]},a=s,this._emitStatusEvent("ngw:select",b(b({},a),{resources:[r],sourceType:"vector"})),[2,a]):[2]}))}))},e.prototype._selectFromNgwRaster=function(t){return g(this,void 0,void 0,(function(){var e,r,n,o,i,a,u,c,l,p,f=this;return _(this,(function(h){switch(h.label){case 0:for(r in this._emitStatusEvent("ngw:preselect"),e=[],this._ngwLayers)(n=this._ngwLayers[r].layer).getIdentificationIds&&n.options.selectable&&e.push(n.getIdentificationIds());return[4,Promise.all(e)];case 1:return o=h.sent(),i=[],o.forEach((function(t){t&&t.forEach((function(t){return i.push(t)}))})),i.length?(a=this.options.pixelRadius||10,u=this.getCenter(),c=this.getZoom(),u&&c?(l=40075016.686*Math.abs(Math.cos(180*u[1]/Math.PI))/Math.pow(2,c+8),p=a*l*5e-4,[2,s.a.utils.sendIdentifyRequest(t,{layers:i,connector:this.connector,radius:p}).then((function(e){return f._emitStatusEvent("ngw:select",b(b({},e),{resources:i,sourceType:"raster",event:t})),e}))]):(this._emitStatusEvent("ngw:select",null),[2])):(this._emitStatusEvent("ngw:select",null),[2])}}))}))},e.utils=b(b(b({},a.a.utils),s.a.utils),{fixUrlStr:i.c,deepmerge:i.b}),e.decorators=b({onMapLoad:c},a.a.decorators),e.getIcon=u.a,m([a.a.decorators.onLoad("controls:create"),w("design:type",Function),w("design:paramtypes",[Object,String,Object]),w("design:returntype",Promise)],e.prototype,"addControl",null),m([c(),w("design:type",Function),w("design:paramtypes",[Object]),w("design:returntype",Promise)],e.prototype,"addNgwLayer",null),e}(a.a);e.a=L},246:function(t,e,r){"use strict";function n(t,e,r,n,o){void 0===r&&(r={}),r.method=r.method||"GET";var i=new XMLHttpRequest;i.open(r.method||"GET",t,!0),"blob"===r.responseType&&(i.responseType=r.responseType);var a=function(t){void 0===t&&(t=!1);var o=t?n:e;if("blob"===r.responseType)o(i.response);else if(i.responseText)try{o(JSON.parse(i.responseText))}catch(t){o(i.responseText)}else n({message:""})};i.onreadystatechange=function(){4===i.readyState&&200===i.status||3===i.readyState&&201===i.status||3===i.readyState&&400===i.status||4===i.readyState&&500===i.status?a():4===i.readyState&&401===i.status?n(i.statusText):4===i.readyState&&n("request error")},i.onerror=function(t){n(t)},i.upload.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;r.onProgress&&r.onProgress(e)}};var s,u=r.headers;if(u)for(var c in u){var l=u[c];"string"==typeof l&&i.setRequestHeader(c,l)}if(void 0!==r.withCredentials&&(i.withCredentials=r.withCredentials),r.file){if((s=new FormData).append("file",r.file),r.data)for(var p in s)s.append(p,s[p])}else s=r.data?"string"==typeof r.data?r.data:JSON.stringify(r.data):null;o&&o.push((function(){i.abort()})),i.send(s)}r.r(e),r.d(e,"default",(function(){return n}))},247:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return loadJSONNode}));var url=eval('require("url")'),http=eval('require("http")'),https=eval('require("https")'),adapterFor=function(t){return{"http:":http,"https:":https}[url.parse(t).protocol]};function loadJSONNode(t,e,r,n,o){return new Promise((function(e,r){adapterFor(t).get(t,(function(t){var r="";t.on("data",(function(t){r+=t})),t.on("end",(function(){e(JSON.parse(r))}))})).on("error",(function(t){r(t)}))})).then((function(t){return e&&e(t),t})).catch((function(t){throw n&&n(t),new Error(t)}))}},38:function(t,e,r){"use strict";var n=r(56),o=r(133),i=r(39),a=r(44),s=r(21),u=r(30),c=r(32),l=function(){return(l=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},p=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},f={srs:4326,geom_format:"geojson"};function h(t){var e=t.geom;return{id:t.id,type:"Feature",properties:t.fields,geometry:e}}function d(t){var e=l({},f);return t.connector.get("feature_layer.feature.item",null,l({id:t.resourceId,fid:t.featureId},e))}function y(t){return d(t).then((function(t){return h(t)}))}function v(t){var e=t.filterById[2],r="number"==typeof e?[e]:e.split(",").map((function(t){return Number(t)}));if("eq"!==t.filterById[1]&&"in"!==t.filterById[1])throw new Error("Unable to filter by object id. Except `eq` or `in` operator");var n=r.map((function(e){return d({connector:t.connector,resourceId:t.resourceId,featureId:e})}));return u.a.all(n)}function b(t){var e=l({},f),r=t.connector,n=t.limit,o=t.fields,i=t.intersects,a=t.orderBy,s=t.resourceId,u=t.paramList;return n&&(e.limit=n),o&&(e.fields=o.join()),i&&(e.intersects=i),u&&(e.paramList=u),a&&(e.order_by=a.join(",")),r.get("feature_layer.feature.collection",null,l({id:s},e))}function m(t){var e=t.filters;return e?function t(e,r,n){void 0===r&&(r=[]),void 0===n&&(n=[]);var o=e.filters,i=e.connector,a=e.resourceId,s="string"==typeof o[0]?o[0]:"all",f=o.filter((function(t){return Array.isArray(t)})),h=function(t){return["fld_"+t[0]+"__"+t[1],t[2]]};if("any"===s)f.forEach((function(o){"id"===o[0]&&r.push(v({filterById:o,connector:i,resourceId:a})),Object(c.a)(o)?r.push(b(l(l({},e),{paramList:p(n,[h(o)])}))):t(l(l({},e),{filters:o}),r,p(n))}));else if("all"===s){var d=f.find((function(t){return"id"===t[0]}));if(d)r.push(v({filterById:d,connector:i,resourceId:a}));else{var y=[],m=[];f.forEach((function(t){Object(c.a)(t)?y.push(h(t)):m.push(t)})),m.length?m.forEach((function(o){t(l(l({},e),{filters:o}),r,p(n,y))})):r.push(b(l(l({},e),{paramList:p(n,y)})))}}return u.a.all(r).then((function(t){var r=t.reduce((function(t,e){return t.concat(e)}),[]);return e.limit?r.splice(0,e.limit):r}))}(l(l({},t),{filters:e})):b(t).then((function(t){return e?t.filter((function(t){var r=t.fields;r&&Object(c.c)(r,e)})):t}))}function w(t){return m(t).then((function(t){var e=[];return t.forEach((function(t){e.push(h(t))})),{type:"FeatureCollection",features:e}}))}var g=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},_=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function I(t,e){return g(this,void 0,void 0,(function(){var r,n,o,i;return _(this,(function(a){switch(a.label){case 0:return r=t.resource,n=t.keyname,o=t.resourceId,r?"string"!=typeof r?[3,1]:(n=r,[3,4]):[3,4];case 1:return"number"!=typeof r?[3,2]:(o=r,[3,4]);case 2:return[4,I(r,e)];case 3:o=a.sent(),a.label=4;case 4:return o||!n?[3,6]:[4,e.getResourceByKeyname(n)];case 5:i=a.sent(),o=i.resource.id,a.label=6;case 6:return[2,o]}}))}))}var L=r(140);var O=["fields","intersects","limit","orderBy","strategy"];function x(t){var e={};return O.forEach((function(r){var n=t[r];void 0!==n&&(e[r]=n)})),e}var M,E=(M=function(t,e){return(M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}M(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),N=function(){return(N=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},k=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},P=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function S(t,e,r,n){var o,u;return k(this,void 0,void 0,(function(){var c,l,p,f,h,d,y,v,b=this;return P(this,(function(m){switch(m.label){case 0:return c=e.mapAdapter.layerAdapters.GEOJSON,p=!1,[4,I(t,r)];case 1:return h=m.sent(),(null===(u=null===(o=t.adapterOptions)||void 0===o?void 0:o.popupOptions)||void 0===u?void 0:u.fromProperties)&&(t.adapterOptions.popupOptions.createPopupContent=function(t){var e=t.feature;return e&&function(t,e){var r,n=Object(L.a)("div");if(e)null===(r=e.feature_layer)||void 0===r||r.fields.forEach((function(e){if(e.grid_visibility){var r=t.properties&&t.properties[e.keyname];if(r)Object(L.a)("div",null,n).innerHTML="<span>"+e.display_name+"</span>: "+r+"<span></span>"}}));else if(t.properties)for(var o in t.properties){Object(L.a)("div",null,n).innerHTML="<span>"+o+"</span>: "+t.properties[o]+"<span></span>"}return n}(e,n)}),d=function(t,e){return k(b,void 0,void 0,(function(){return P(this,(function(n){switch(n.label){case 0:return v(),f={filters:t,options:e},[4,l=w(N({resourceId:h,filters:t,connector:r},e))];case 1:return[2,n.sent()]}}))}))},y=!1,v=function(){l&&(l.cancel(),l=void 0)},[2,function(r){function o(){var t=null!==r&&r.apply(this,arguments)||this;return t.emitter=new i.EventEmitter,t}return E(o,r),o.prototype.addLayer=function(e){return k(this,void 0,void 0,(function(){var o;return P(this,(function(i){return void 0!==t.id&&(e.id=t.id),n&&n.vector_layer&&(e.type=pt[n.vector_layer.geometry_type]),e.data&&0===Object.keys(e.data).length&&(e.data=void 0),o=r.prototype.addLayer.call(this,e),this.options.strategy=e.strategy||void 0,f={filters:e.propertiesFilter,options:x(e)},e.data||this.updateLayer(),"BBOX"===this.options.strategy&&this._addBboxEventListener(),[2,o]}))}))},o.prototype.beforeRemove=function(){y=!0,this._removeMoveEventListener(),this._removeBboxEventListener(),this.__disableMapMoveListener=void 0,this.__enableMapMoveListener=void 0,this.__onMapMove=void 0,v()},o.prototype.updateLayer=function(t){return k(this,void 0,void 0,(function(){var r;return P(this,(function(n){switch(n.label){case 0:return t=t||f||{},"BBOX"!==this.options.strategy?[3,2]:[4,e.onLoad()];case 1:n.sent(),t.options=t.options||{},t.options.intersects=this._getMapBbox(),n.label=2;case 2:return y?[2]:[4,d(t.filters,t.options)];case 3:return r=n.sent(),e.setLayerData(this,r),this.emitter.emit("updated"),[2]}}))}))},o.prototype.propertiesFilter=function(t,e){return k(this,void 0,void 0,(function(){var r;return P(this,(function(n){switch(n.label){case 0:return v(),this.filter&&p?(this.filter((function(e){return!e.feature||!e.feature.properties||a.a.utils.propertiesFilter(e.feature.properties,t)})),[3,3]):[3,1];case 1:return this.setData?(this.clearLayer&&this.clearLayer(),[4,d(t,e)]):[3,3];case 2:r=n.sent(),this.setData(r),n.label=3;case 3:return[2]}}))}))},o.prototype.removeFilter=function(){f=void 0,this.propertiesFilter([]),this.filter&&this.filter((function(){return!0}))},o.prototype._addBboxEventListener=function(){var t=this;this.__enableMapMoveListener=function(){t._removeMoveEventListener(),e.isLayerVisible(t)&&(t.updateLayer(),t._addMoveEventListener())},this.__disableMapMoveListener=function(){e.isLayerVisible(t)||t._removeMoveEventListener()},e.emitter.on("layer:show",this.__enableMapMoveListener),e.emitter.on("layer:hide",this.__disableMapMoveListener),this.__enableMapMoveListener()},o.prototype._removeBboxEventListener=function(){this.__enableMapMoveListener&&e.emitter.on("layer:show",this.__enableMapMoveListener),this.__disableMapMoveListener&&e.emitter.on("layer:hide",this.__disableMapMoveListener)},o.prototype._addMoveEventListener=function(){var t=this;this.__onMapMove=Object(s.a)((function(){return t.updateLayer()})),e.emitter.on("moveend",this.__onMapMove)},o.prototype._removeMoveEventListener=function(){this.__onMapMove&&e.emitter.off("moveend",this.__onMapMove)},o.prototype._getMapBbox=function(){var t=e.getBounds();if(t){var r=t[0],n=t[1],o=t[2],i=t[3];return"POLYGON(("+[[r,n],[o,n],[o,i],[r,i],[r,n]].map((function(t){var e=gt(t[0],t[1]);return e[0]+" "+e[1]})).join(", ")+"))"}},o}(c)]}}))}))}function j(t,e,r){var n=t.adapter||"IMAGE",o=e.getLayerAdapters(),i=!o||o.IMAGE,a=t.resourceId;if(a){if("IMAGE"===n){if(i)return{url:r+"/api/component/render/image",resourceId:a,headers:t.headers,updateWmsParams:function(t){return lt(t,a)}};n="TILE"}if("WMS"===n)return{url:r+"/api/resource/"+a+"/wms",format:"image/png",version:"1.1.1",layers:t.layers,headers:t.headers};if("MVT"===n)return{url:r+"/api/component/feature_layer/mvt?x={x}&y={y}&z={z}&resource="+a+"&simplification="+(t.simplification||0)};if("TERRAIN"===n)return{url:r+"/api/resource/"+a+"/terrain_provider",adapter:n};if("TILE"===n)return{url:r+"/api/component/render/tile?z={z}&x={x}&y={y}&resource="+a,adapter:n}}else console.log("Options `resourceId` not set")}var T=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),A=function(){return(A=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},R=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},C=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function G(t,e,r,n,o){return R(this,void 0,void 0,(function(){var i,a,s,u,c;return C(this,(function(l){switch(l.label){case 0:return i={wmsserver_service:"WMS",terrain_provider:"TERRAIN"},void 0!==(a=t.adapter||o&&i[o]||"IMAGE")&&(t.adapter=a),"IMAGE"===a&&(s=e.getLayerAdapters(),!s||s.IMAGE||(a="TILE")),(u=e.mapAdapter.layerAdapters[a])?[4,I(t,n)]:[3,2];case 1:return c=l.sent(),[2,function(n){function o(o,i){var a=n.call(this,o,i)||this;a.map=o,a.resourceId=c;var s=j(t,e,r);if(s)if(s.resourceId){var u=A(A({},s),{layers:String(s.resourceId),resourceId:s.resourceId});a.options=A(A({},a.options),u)}else{var l=s;a.options=A(A({},a.options),l)}return a}return T(o,n),o.prototype.addLayer=function(t){return n.prototype.addLayer.call(this,A(A({},this.options),t))},o.prototype.getIdentificationIds=function(){return R(this,void 0,void 0,(function(){var t;return C(this,(function(e){return(t=this.item&&this.item.resource.parent.id)?[2,[t]]:[2]}))}))},o}(u)];case 2:throw new Error(a+" not supported yet. Only TILE")}}))}))}var U=r(226),q=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),F=function(){return(F=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},B=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},D=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Q=function(t){function e(r,n,o,i){var a=t.call(this,F(F({},e.options),o))||this;if(a.webMap=r,a._rootDescendantsCount=0,i&&a.tree.setParent(i),a.item=n,"root"===a.item.item_type)a._rootDescendantsCount=a._sumUp(a.item.children);else{var s=a.tree.getRoot();s&&(a._rootDescendantsCount=s._rootDescendantsCount)}return a.initProperties(),a._init(n),a}return q(e,t),e.prototype.initItem=function(t){return B(this,void 0,void 0,(function(){var r,n,o,i,a,s,u,c,l,p=this;return D(this,(function(f){switch(f.label){case 0:return r=t._layer,n=t,"group"!==t.item_type&&"root"!==t.item_type?[3,1]:(t.children&&t.children.length&&t.children.reverse().forEach((function(t){var r=new e(p.webMap,t,p.options,p);p.tree.addChild(r)})),[3,3]);case 1:return"layer"!==t.item_type?[3,3]:(o=t.adapter||t.layer_adapter.toUpperCase(),i=t.layer_max_scale_denom?this._mapScaleToZoomLevel(t.layer_max_scale_denom):this.webMap.options.maxZoom,a=t.layer_min_scale_denom?this._mapScaleToZoomLevel(t.layer_min_scale_denom):this.webMap.options.minZoom,s=F(F({maxZoom:i,minZoom:a,minScale:t.layer_min_scale_denom,maxScale:t.layer_max_scale_denom},t),{headers:this.options.headers}),this.options.order&&(u=this.options.drawOrderEnabled?this._rootDescendantsCount-t.draw_order_position:this.id,s.order=Number((0|this.options.order)+"."+u)),[4,this.webMap.addLayer(o,s)]);case 2:r=f.sent(),f.label=3;case 3:return r&&(n._layer=r,this.layer=r,this.properties&&"layer"===t.item_type&&t.layer_enabled&&this.properties.property("visibility").set(!0),"number"==typeof(c="layer"===t.item_type&&t.layer_transparency)&&(l=(100-c)/100,this.webMap.setLayerOpacity(r,l))),[2]}}))}))},e.prototype.bringToFront=function(){},e.prototype.fit=function(){"layer"===this.item.item_type&&console.log(this.item)},e.prototype._mapScaleToZoomLevel=function(t){return Lt(t)},e.prototype._init=function(t){return B(this,void 0,void 0,(function(){return D(this,(function(e){switch(e.label){case 0:return[4,this.initItem(t)];case 1:return e.sent(),this.emitter.emit("init"),[2]}}))}))},e.prototype._sumUp=function(t,e){void 0===e&&(e=0);for(var r=0,n=t;r<n.length;r++){var o=n[r];"layer"===o.item_type?(e+=1,o.draw_order_position=o.draw_order_position||e):"group"===o.item_type&&(e=this._sumUp(o.children,e))}return e},e.options={properties:[{type:"boolean",name:"visibility",getProperty:function(t){if(t){if("group"===t.item.item_type)return!0;if("layer"===t.item.item_type)return t.item.layer_enabled;if("root"===t.item.item_type)return!0}return!1},onSet:function(t,e,r){r&&r.layer&&"layer"===r.item.item_type&&(t?r.webMap.showLayer(r.layer):r.webMap.hideLayer(r.layer),r.item.layer_enabled=t)}}]},e}(U.a),W=function(){return(W=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},J=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},Z=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},z=function(){function t(t,e){this.map=t,this.options=e,this.pixelRadius=10,this.emitter=new i.EventEmitter;var r=e.resourceId;if(Array.isArray(r)?(this.resourceId=r[0],this.options.id=r[1]):this.resourceId=r,!this.resourceId)throw new Error("NGW `resourceId` is not defined")}return t.prototype.addLayer=function(t){return J(this,void 0,void 0,(function(){var e,r,n=this;return Z(this,(function(o){switch(o.label){case 0:return this.options=W(W({},this.options),t),e=this,[4,this._getWebMapLayerItem()];case 1:return e.layer=o.sent(),this.options.identification?[4,this._getWebMapIds()]:[3,3];case 2:(r=o.sent())&&(this._webmapLayersIds=r,this.$$onMapClick=function(t){return n._onMapClick(t)},this.options.webMap.emitter.on("click",this.$$onMapClick)),o.label=3;case 3:return[2,this.layer]}}))}))},t.prototype.removeLayer=function(){var t=this.options.webMap.mapAdapter;this.$$onMapClick&&this.options.webMap.emitter.off("click",this.$$onMapClick),this.getDependLayers().forEach((function(e){"layer"in e&&t.removeLayer(e.layer.layer)})),this.$$onMapClick=void 0,delete this.options,delete this.layer,delete this.response,delete this._webmapLayersIds},t.prototype.showLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!0)},t.prototype.hideLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!1)},t.prototype.getExtent=function(){var t=this.response&&this.response.webmap;if(t)return dt(t)},t.prototype.getDependLayers=function(){return this.layer&&this.layer.tree.getDescendants()||[]},t.prototype.getIdentificationIds=function(){return J(this,void 0,void 0,(function(){var t,e;return Z(this,(function(r){switch(r.label){case 0:return t=[],(e=this._webmapLayersIds)?[3,2]:[4,this._getWebMapIds()];case 1:e=r.sent(),this._webmapLayersIds=e,r.label=2;case 2:return e&&e.length&&this.getDependLayers().sort((function(t,e){return t.id-e.id})).forEach((function(e){var r=e.item,n=r.parentId;if(void 0!==n&&"layer"===r.item_type){var o=e.properties.property("visibility");o.get()&&!o.isBlocked()&&t.push(n)}})),[2,t]}}))}))},t.prototype._getWebMapLayerItem=function(){return J(this,void 0,void 0,(function(){var t,e=this;return Z(this,(function(r){switch(r.label){case 0:return this.resourceId?[4,this.getWebMapConfig(this.resourceId)]:[3,2];case 1:if((t=r.sent())&&t.root_item)return[2,new Promise((function(r){var n={};if(e.options.connector&&e.options.connector.options.auth){var o=e.options.connector.getAuthorizationHeaders();o&&(n.headers=o)}n.order=e.options.order,n.drawOrderEnabled=t.draw_order_enabled;var i=new Q(e.options.webMap,t.root_item,n);i.emitter.on("init",(function(){return r(i)}))}))];r.label=2;case 2:return[2]}}))}))},t.prototype.getWebMapConfig=function(t){return J(this,void 0,void 0,(function(){var e,r;return Z(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.options.connector.get("resource.item",null,{id:t})];case 1:return e=n.sent(),this.response=e,(r=e.webmap)?(this._updateItemsParams(r.root_item,this.options.webMap,e),[2,r]):[3,3];case 2:throw n.sent();case 3:return[2]}}))}))},t.prototype._updateItemsParams=function(t,e,r){var n=this;if(t)if("group"===t.item_type||"root"===t.item_type)t.children&&(t.children=t.children.map((function(t){return n._updateItemsParams(t,e,r)}))),"root"===t.item_type&&(t.display_name=r.resource.display_name);else if("layer"===t.item_type){var o=Object(s.c)(this.options.baseUrl+"/api/component/render/image"),i=t.layer_style_id;t.url=o,t.resourceId=i,t.updateWmsParams=function(t){return lt(t,i)},t=W(W({},t),ft({adapter:t.layer_adapter.toUpperCase(),resourceId:i},e,this.options.baseUrl))}return t},t.prototype._getWebMapIds=function(){return J(this,void 0,void 0,(function(){var t,e,r,n=this;return Z(this,(function(o){switch(o.label){case 0:return(t=this.layer)&&"root"===t.item.item_type?(e=t.tree.getDescendants(),r=[],e.forEach((function(t){var e=t.item;if("layer"===e.item_type){var o=e.layer_style_id,i=n.options.connector.get("resource.item",{},{id:o}).then((function(t){if(t){var r=Number(t.resource.parent.id);return e.parentId=r,r}}));r.push(i)}})),[4,Promise.all(r)]):[3,2];case 1:return[2,o.sent().filter((function(t){return void 0!==t}))];case 2:return[2]}}))}))},t.prototype._sendIdentifyRequest=function(t){var e=this;if(this._webmapLayersIds)return _t(t,{layers:this._webmapLayersIds,connector:this.options.connector,radius:this.pixelRadius}).then((function(r){return e.emitter.emit("identify",{ev:t,data:r}),r}))},t.prototype._onMapClick=function(t){this._sendIdentifyRequest(t)},t}(),$=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),H=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},V=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};var Y=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},K=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},X=function(){function t(){}return t.prototype.getExtent=function(){return Y(this,void 0,void 0,(function(){var t;return K(this,(function(e){switch(e.label){case 0:return this._extent?[2,this._extent]:this.item?(t=this,[4,vt(this.item,this.connector).then()]):[3,2];case 1:return t._extent=e.sent(),[2,this._extent];case 2:return[2]}}))}))},t}(),tt=function(){return(tt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},et=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},rt=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},nt=["mapserver_style","qgis_vector_style","qgis_raster_style","wmsserver_service","raster_style","terrain_provider"];function ot(t,e,r,n,o){return et(this,void 0,void 0,(function(){var i,a;return rt(this,(function(s){switch(s.label){case 0:return[4,o.get("resource.collection",null,{parent:t})];case 1:return i=s.sent(),(a=i&&i[0])?[2,it(tt(tt({},e),{resourceId:a.resource.id}),r,n,o)]:[2]}}))}))}function it(t,e,r,n){return et(this,void 0,void 0,(function(){var i,a,s,u,c,l;return rt(this,(function(p){switch(p.label){case 0:return p.trys.push([0,4,,5]),s=t.adapter,[4,I(t,n)];case 1:return(u=p.sent())?[4,n.get("resource.item",null,{id:u})]:[3,3];case 2:if(!(a=p.sent()))throw new Error("Can't add NGW layer because Resource item is not found");if(c=tt(tt({},t),{resourceId:u}),a.webmap)i=function(t,e,r,n){return H(this,void 0,void 0,(function(){var o;return V(this,(function(i){switch(i.label){case 0:return[4,I(t,n)];case 1:return o=i.sent(),[2,function(t){function i(i){return t.call(this,i,{webMap:e,resourceId:o,baseUrl:r,connector:n})||this}return $(i,t),i}(z)]}}))}))}(c,e,r,n);else if(-1!==nt.indexOf(a.resource.cls))"GEOJSON"===s?(l=tt(tt({},t),{resourceId:a.resource.parent.id}),i=S(l,e,n,a)):i=G(c,e,r,n,a.resource.cls);else if("vector_layer"===a.resource.cls)if(void 0!==s&&"GEOJSON"!==s){if("MVT"!==s)return[2,ot(a.resource.id,c,e,r,n)];i=G(c,e,r,n,a.resource.cls)}else i=S(c,e,n,a);else{if("raster_layer"===a.resource.cls)return[2,ot(a.resource.id,c,e,r,n)];a.basemap_layer&&a.basemap_layer.qms&&(i=Promise.resolve(o.a.utils.createQmsAdapter(e))).then((function(t){if(t&&a&&a.basemap_layer&&a.basemap_layer.qms){var e=JSON.parse(a.basemap_layer.qms);t.prototype.qms=e,t.prototype.baseLayer=!0}}))}p.label=3;case 3:return[3,5];case 4:return p.sent(),[3,5];case 5:return i?[2,i.then((function(t){if(t){var e=t;return e.prototype.item=a,e.prototype.resourceId=null==a?void 0:a.resource.id,e.prototype.connector=n,r=e,[X].forEach((function(t){Object.getOwnPropertyNames(t.prototype).forEach((function(e){var n=Object.getOwnPropertyDescriptor(t.prototype,e);n&&Object.defineProperty(r.prototype,e,n)}))})),e}var r}))]:[2]}}))}))}var at=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),st=function(){return(st=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},ut=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},ct=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function lt(t,e){return{resource:e,extent:t.bbox,size:t.width+","+t.height,timestamp:Date.now()}}var pt={POINT:"circle",LINESTRING:"line",POLYGON:"fill",MULTIPOINT:"circle",MULTILINESTRING:"line",MULTIPOLYGON:"fill",POINTZ:"circle",LINESTRINGZ:"line",POLYGONZ:"fill",MULTIPOINTZ:"circle",MULTILINESTRINGZ:"line",MULTIPOLYGONZ:"fill"};function ft(t,e,r){return j(t,e,r)}function ht(t,e,r,n){var o=n.getAuthorizationHeaders();return o&&(t.headers=o),it(t,e,r,n)}function dt(t){var e=t.extent_bottom,r=t.extent_left,n=t.extent_top,o=t.extent_right;if(e&&r&&n&&o){var i=[r,e,o,n];return i[3]>82&&(i[3]=82),i[1]<-82&&(i[1]=-82),i}}function yt(t,e){return e.get("layer.extent",name,{id:t}).then((function(t){if(t){var e=t.extent,r=e.maxLat,n=e.maxLon,o=e.minLat;return[e.minLon,o,n,r]}}))}function vt(t,e){return ut(this,void 0,void 0,(function(){var r;return ct(this,(function(n){return t.webmap?[2,dt(t.webmap)]:-1!==(r=t.resource).cls.indexOf("style")?[2,e.get("resource.item",null,{id:r.parent.id}).then((function(t){return yt(t.resource.id,e)}))]:[2,yt(r.id,e)]}))}))}var bt,mt=Math.PI/180,wt=180/Math.PI;function gt(t,e){e=e>85.06?85.06:e<-85.06?-85.06:e;var r=20037508.34*t/180,n=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return[r,n=20037508.34*n/180]}function _t(t,e){var r=function(t,e,r,n){void 0===r&&(r=10),void 0===n&&(n=6);for(var o=r/3963*wt,i=o/Math.cos(e*mt),a=[],s=0;s<n+1;s++){var u=Math.PI*(s/(n/2)),c=t+i*Math.cos(u),l=e+o*Math.sin(u);a.push([c,l])}return a}(t.latLng.lng,t.latLng.lat,e.radius),n=[];r.forEach((function(t){var e=gt(t[0],t[1]),r=e[0],o=e[1];n.push(r+" "+o)}));var o={geom:"POLYGON(("+n.join(", ")+"))",srs:3857,layers:e.layers};return e.connector.post("feature_layer.identify",{data:o})}function It(){if(void 0===bt){var t=document.createElement("div");t.style.cssText="position: absolute;  left: -100%;  top: -100%;  width: 100cm;",document.body.appendChild(t);var e=t.offsetWidth;document.body.removeChild(t),bt=e}return bt}function Lt(t,e){if(void 0===e&&(e=104),e){var r=e;return function(t){return Math.log(t/256)/Math.LN2}(It()*function(t){return 12756274*Math.PI*Math.cos(t*Math.PI/180)}(r)/t)}return Math.round(Math.log(591657550.5/(t/2))/Math.log(2))}var Ot=function(){return(Ot=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function xt(t,e){var r;void 0===e&&(e=!1);var n=[],o=[];for(var i in t){var a=Number(i);isNaN(a)||n.push(a)}var s=t.resources;s&&n.sort((function(t,e){return s.indexOf(t)-s.indexOf(e)}));for(var u=0;u<n.length;u++){var c=t[i=n[u]].features,l=Number(i),p=c[0];if(p&&(r={featureId:p.id,resourceId:l},o.push(r),!e))break}return o}function Mt(t){var e=t.connector,r=t.identify;for(var n in r){var o=Number(n);if(!isNaN(o)){var i=r[n].features.find((function(t){return t.geom}));if(i&&i.geom){var a=i.geom;return h(Ot(Ot({},i),{geom:a}))}}}var s=xt(r);if(s)return y(Ot({connector:e},s[0]))}var Et=function(){return(Et=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Nt=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},kt=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Pt=function(){function t(t){if(this.options=t,this.options.connector)this.url=this.options.connector.options.baseUrl,this.connector=this.options.connector;else{if(!this.options.baseUrl)throw new Error("url is not defined");this.url=this.options.baseUrl,this.connector=new n.a({baseUrl:this.url,auth:this.options.auth})}}return t.prototype.onLoadSync=function(t){return Nt(this,void 0,void 0,(function(){var e,r,n,o,i;return kt(this,(function(a){switch(a.label){case 0:if(!this.options.resourceId||!this.url)return[3,4];if(!(e=[this.options.resourceId]).length)return[3,4];r=0,n=e,a.label=1;case 1:return r<n.length?(o=n[r],i={resourceId:o,connector:this.connector,baseUrl:this.url,webMap:t},[4,t.addLayer(z,Et({visibility:!0,fit:!0,identification:this.options.identification,pixelRadius:this.options.pixelRadius},i))]):[3,4];case 2:return[2,a.sent()];case 3:return r++,[3,1];case 4:return[2]}}))}))},t.prototype.getLayerAdapters=function(){return Promise.resolve([this._getLayerAdapter()])},t.prototype._getLayerAdapter=function(){var t=this;return{name:"WEBMAP",createAdapter:function(e){return Promise.resolve(t._createAdapter(e))}}},t.prototype._createAdapter=function(t){var e,r=this.connector,n=this.url;return e={webMap:t,connector:r,baseUrl:n},function(t){function r(r,n){return n=st(st({},e),n),t.call(this,r,n)||this}return at(r,t),r}(z)},t.utils={addNgwLayer:ht,getNgwResourceExtent:vt,sendIdentifyRequest:_t,pixelsInMeterWidth:It,getNgwLayerFeature:y,getNgwLayerFeatures:w,getNgwLayerItems:m,getNgwLayerItem:d,getIdentifyGeoJson:Mt,getIdentifyGeoJsonParams:xt,createGeoJsonFeature:h,setScaleRatio:Lt},t.updateWmsParams=lt,t.getLayerAdapterOptions=ft,t.addNgwLayer=ht,t}();e.a=Pt},56:function(t,e,r){"use strict";var n,o=r(30),i=r(39),a=new Function("try {return this===window;}catch(e){ return false;}")();n=a?r(246).default:r(247).default;var s=/\{ *([\w_-]+) *\}/g;function u(t,e){return t.replace(s,(function(t,r){var n=e[r];if(void 0===n)throw new Error("No value provided for letiable "+t);return"function"==typeof n&&(n=n(e)),n}))}var c=function(){return(c=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},l=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},p=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},f=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},h=function(){function t(t){this.options=t,this.emitter=new i.EventEmitter,this.routeStr="/api/component/pyramid/route",this._loadingQueue={},this._loadingStatus={},this._queriesCache={},this._keynames={},this.options.route&&(this.routeStr=this.options.route)}return t.prototype.setNextGisWeb=function(t){this.logout(),this.options.baseUrl=t},t.prototype.connect=function(){return l(this,void 0,o.a,(function(){var t,e,r,n=this;return p(this,(function(o){switch(o.label){case 0:return this.route?[2,Promise.resolve(this.route)]:[3,1];case 1:return this.options.auth?(t=this.options.auth,e=t.login,r=t.password,e&&r?[4,this.getUserInfo({login:e,password:r})]:[3,3]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.makeQuery(this.routeStr,{},{}).then((function(t){return n.route=t,t}))];case 4:return[2,o.sent()]}}))}))},t.prototype.login=function(t){return l(this,void 0,void 0,(function(){return p(this,(function(e){return this.logout(),[2,this.getUserInfo(t)]}))}))},t.prototype.logout=function(){this._rejectLoadingQueue(),this._loadingStatus={},this.options.auth=void 0,this.route=void 0,this.user=void 0,this.emitter.emit("logout")},t.prototype.getUserInfo=function(t){var e=this;if(this.user&&this.user.id)return o.a.resolve(this.user);t&&(this.options.auth=t);var r={headers:this.getAuthorizationHeaders(t)};return this.makeQuery("/api/component/auth/current_user",{},r).then((function(t){return e.user=t,e.emitter.emit("login",t),t})).catch((function(t){throw e.emitter.emit("login:error",t),t}))},t.prototype.getAuthorizationHeaders=function(t){var e=this.makeClientId(t);if(e)return{Authorization:"Basic "+e}},t.prototype.makeClientId=function(t){if(t=t||this.options.auth){var e=t.login,r=t.password;return window.btoa(unescape(encodeURIComponent(e+":"+r)))}},t.prototype.getResourceByKeyname=function(t){return l(this,void 0,void 0,(function(){var e,r;return p(this,(function(n){switch(n.label){case 0:return(e=this._keynames.keyname)?[3,2]:[4,this.get("resource.search",null,{keyname:t})];case 1:r=n.sent(),(e=r[0])&&(this._keynames[t]=e),n.label=2;case 2:return[2,e]}}))}))},t.prototype.getResourceChildren=function(t){return l(this,void 0,void 0,(function(){var e,r;return p(this,(function(n){switch(n.label){case 0:if(e=t.resourceId,!t.keyname&&!t.resourceId)throw new Error("No keyname or resourceId is set");return t.keyname?[4,this.getResourceByKeyname(t.keyname)]:[3,2];case 1:r=n.sent(),e=r.resource.id,n.label=2;case 2:return[4,this.get("resource.collection",null,{parent:e})];case 3:return[2,n.sent()]}}))}))},t.prototype.request=function(t,e,r){return void 0===e&&(e={}),l(this,void 0,o.a,(function(){var n,i,a,s,c,l,h,d,y;return p(this,(function(p){switch(p.label){case 0:return[4,this.connect()];case 1:if(n=p.sent(),i=n&&n[t]){if(i=f(i),a=i.shift(),i.length){for(s={},c=0;c<i.length;c++)if(l=i[c],s[c]="{"+l+"}",void 0===e[l])throw new Error("`"+l+"` url api argument is not specified");a&&(a=u(a,s))}if(e){for(y in h=[],d=e.paramList,Array.isArray(d)&&(delete e.paramList,d.forEach((function(t){h.push(t[0]+"="+t[1])}))),e)-1===i.indexOf(y)&&h.push(y+"="+e[y]);h.length&&(a=a+"?"+h.join("&"))}if(a)return[2,this.makeQuery(a,e,r)];throw new Error("request url is not set")}return[2,o.a.resolve({})]}}))}))},t.prototype.post=function(t,e,r){return(e=e||{}).method="POST",e.nocache=!0,this.request(t,r,e)},t.prototype.get=function(t,e,r){return(e=e||{}).method="GET",e.nocache=!0,this.request(t,r,e)},t.prototype.patch=function(t,e,r){return(e=e||{}).method="PATCH",e.nocache=!0,this.request(t,r,e)},t.prototype.put=function(t,e,r){return(e=e||{}).method="PUT",e.nocache=!0,this.request(t,r,e)},t.prototype.delete=function(t,e,r){return(e=e||{}).method="DELETE",e.nocache=!0,this.request(t,r,e)},t.prototype.makeQuery=function(t,e,r){var n=this;if(void 0===r&&(r={}),t=(this.options.baseUrl?this.options.baseUrl:"")+t)return e&&(t=u(t,e)),t=t.replace(/([^:]\/)\/+/g,"$1"),r.cache&&this._queriesCache[t]?this._queriesCache[t]:!this._loadingStatus[t]||r.nocache?(this._loadingStatus[t]=!0,this._getJson(t,r).then((function(e){return n._loadingStatus[t]=!1,r.cache&&(n._queriesCache[t]=e),n._executeLoadingQueue(t,e),e})).catch((function(e){throw n._loadingStatus[t]=!1,n._executeLoadingQueue(t,e,!0),n.emitter.emit("error",e),e}))):(this._loadingStatus[t]=!1,new o.a((function(e,r){n._setLoadingQueue(t,e,r)})));throw new Error("No `url` parameter set for option "+name)},t.prototype._setLoadingQueue=function(t,e,r){this._loadingQueue[t]=this._loadingQueue[t]||{name:t,waiting:[]},this._loadingQueue[t].waiting.push({resolve:e,reject:r,timestamp:new Date})},t.prototype._rejectLoadingQueue=function(){for(var t in this._loadingQueue){this._loadingQueue[t].waiting.forEach((function(t){t.reject()})),delete this._loadingQueue[t]}},t.prototype._executeLoadingQueue=function(t,e,r){var n=this._loadingQueue[t];if(n){for(var o=0;o<n.waiting.length;o++){var i=n.waiting[o];r?i.reject&&i.reject():i.resolve(e)}n.waiting=[]}},t.prototype._getJson=function(t,e){var r=this,i=[];return e.responseType=e.responseType||"json",new o.a((function(o,a){r.user&&((e=e||{}).headers=c(c({},r.getAuthorizationHeaders()),e.headers)),n(t,o,e,a,i)}),(function(){i.forEach((function(t){return t()}))}))},t}();e.a=h}}]);
//# sourceMappingURL=main~2d9f1139-3559708.js.map