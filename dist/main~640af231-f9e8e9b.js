(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{129:function(t,e,r){"use strict";var n=r(13),o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},i=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},a=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},s={tms:"TILE"};function u(t){return new Promise((function(e,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState&&200===o.status&&o.responseText)try{e(JSON.parse(o.responseText))}catch(t){r(t)}},o.open("GET",Object(n.f)(t),!0),o.send()}))}function c(t,e){return void 0===e&&(e="https://qms.nextgis.com"),function(){function r(t,e){this.map=t,this.options=e,this.options.baseLayer=!0}return r.prototype.addLayer=function(r){return i(this,void 0,void 0,(function(){var n,i,c,l;return a(this,(function(a){switch(a.label){case 0:return this.qms||!r.qmsId?[3,2]:(n=this,[4,u(e+"/api/v1/geoservices/"+r.qmsId)]);case 1:n.qms=a.sent(),a.label=2;case 2:return(i=this.qms)&&(c=s[i.type||"tms"],(l=t.mapAdapter.layerAdapters[c])&&"TILE"===c)?(r=o(o({maxZoom:t.options.maxZoom,minZoom:t.options.minZoom},this.options),function(t){var e=("https:"===location.protocol?"https":"http")+"://";return{url:t.url.replace(/^(https?|ftp):\/\//,e),name:t.name,attribution:t.copyright_text,maxZoom:t.z_max,minZoom:t.z_min}}(i)),this.options=r,[2,new l(this.map,r).addLayer(r)]):[2]}}))}))},r}()}var l=function(){return(l=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},p=function(){function t(t){this.options={url:"https://qms.nextgis.com"},this.options=l(l({},this.options),t),this.url=this.options.url}return t.prototype.getLayerAdapters=function(){var t=this;return Promise.resolve([{name:"QMS",createAdapter:function(e){return Promise.resolve(t._createAdapter(e))}}])},t.prototype._createAdapter=function(t){return c(t,this.url)},t.utils={createQmsAdapter:c},t}();e.a=p},226:function(t,e,r){"use strict";var n=r(41),o=r(13),i=r(38),a=r(35),s=r(126);function u(){return i.b.decorators.onLoad("build-map")}var c=r(53),l=r(129),p=function(){return(p=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function f(t,e,r,n){if("number"==typeof e||"string"==typeof e)e=Number(e),t.push(p(p({},r),{resourceId:e}));else if(Array.isArray(e)){var o=e[0],i=e[1];t.push(p(p(p({},r),{resourceId:o,id:i}),n))}else"object"==typeof e&&t.push(p(p(p({},r),e),n))}var h={target:"map",baseUrl:"",controls:["ZOOM","ATTRIBUTION"],controlsOptions:{ZOOM:{position:"top-left"},ATTRIBUTION:{position:"bottom-right",customAttribution:['<a href="http://nextgis.ru" target="_blank">Â©NextGIS</a>']}},pixelRadius:10};var y,d=(y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),v=function(){return(v=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},b=function(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},m=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},w=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},g=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},_=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r},I=function(t){function e(e,r){var i=t.call(this,function(t,e){var r=[new l.a];!e.connector&&e.baseUrl?e.connector=new c.a({baseUrl:e.baseUrl,auth:e.auth}):e.connector&&(e.baseUrl=e.connector.options.baseUrl);var n=Object(o.d)(h,e);return n.connector&&r.push(new a.a({connector:n.connector,auth:n.auth,identification:n.identification})),{mapAdapter:t,starterKits:r,runtimeParams:e.runtimeParams}}(e,r))||this;return i.emitter=new n.EventEmitter,i.options={},i._ngwLayers={},r.connector&&(i.connector=r.connector),i.options=Object(o.d)(h,r),i._createWebMap().then((function(){var t=i.getContainer();t&&t.classList.add("ngw-map-container"),i._addControls()})),i}return d(e,t),e.prototype.fit=function(){var t=this.options,e=t.center,r=t.zoom,n=t.bounds;e?(this.setCenter(e),r&&this.setZoom(r)):n&&this.fitBounds(n)},e.prototype.addControl=function(e,r,n){return w(this,void 0,void 0,(function(){return g(this,(function(o){return[2,t.prototype.addControl.call(this,e,r,n)]}))}))},e.prototype.addNgwLayer=function(t){return w(this,void 0,void 0,(function(){var e,r,n,o,i,s;return g(this,(function(u){switch(u.label){case 0:if(e=t.keyname,r=t.resourceId,!e&&!r)throw new Error("resourceId or keyname is required parameter to add NGW layer");if(!this.options.baseUrl&&""!==this.options.baseUrl)return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),n=a.a.utils.addNgwLayer(t,this,this.options.baseUrl,this.connector),[4,this.addLayer(n,v(v({visibility:!0},t),t.adapterOptions))];case 2:return o=u.sent(),i=o&&this.getLayerId(o),o&&i&&(this._ngwLayers[i]={layer:o,resourceId:o.resourceId},o.options.baseLayer&&this.getActiveBaseLayer()),[2,o];case 3:return s=u.sent(),console.error("can't add ngw layer",s),[3,4];case 4:return[2]}}))}))},e.prototype.getNgwLayerItem=function(t){return w(this,void 0,o.a,(function(){return g(this,(function(e){return[2,a.a.utils.getNgwLayerItem(v({connector:this.connector},t))]}))}))},e.prototype.getNgwLayerItems=function(t){return w(this,void 0,o.a,(function(){return g(this,(function(e){return[2,a.a.utils.getNgwLayerItems(v({connector:this.connector},t))]}))}))},e.prototype.getNgwLayerFeature=function(t){return w(this,void 0,o.a,(function(){return g(this,(function(e){return[2,a.a.utils.getNgwLayerFeature(v({connector:this.connector},t))]}))}))},e.prototype.getNgwLayerFeatures=function(t){return w(this,void 0,o.a,(function(){return g(this,(function(e){return[2,a.a.utils.getNgwLayerFeatures(v({connector:this.connector},t))]}))}))},e.prototype.getIdentifyGeoJson=function(t,e){return void 0===e&&(e=!1),w(this,void 0,o.a,(function(){return g(this,(function(r){return[2,a.a.utils.getIdentifyGeoJson({identify:t,connector:this.connector,multiple:e})]}))}))},e.prototype.getNgwLayers=function(){return w(this,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,this.onLoad()];case 1:return t.sent(),[2,this._ngwLayers]}}))}))},e.prototype.getNgwLayerByResourceId=function(t){return w(this,void 0,void 0,(function(){var e,r,n,o,i,a,s,u;return g(this,(function(c){switch(c.label){case 0:for(r in e=[],this._ngwLayers)e.push(r);n=0,c.label=1;case 1:return n<e.length?(o=e[n],(i=this._ngwLayers[o]).resourceId!==t?[3,2]:[2,i&&i.layer]):[3,6];case 2:return i.layer.getIdentificationIds?[4,i.layer.getIdentificationIds()]:[3,4];case 3:if((a=c.sent())&&a.some((function(e){return e===t})))return[2,i.layer];c.label=4;case 4:if(i.layer.getDependLayers&&(s=i.layer.getDependLayers(),u=s.find((function(e){return e.item&&e.item.parentId===t}))))return[2,u.layer];c.label=5;case 5:return n++,[3,1];case 6:return[2]}}))}))},e.prototype.zoomToLayer=function(t){return w(this,void 0,void 0,(function(){var e,r,n,o,i,s=this;return g(this,(function(u){switch(u.label){case 0:return e="string"==typeof t||"number"==typeof t?String(e):t.id,(r=e&&this._ngwLayers[e])?r.layer.getExtent?[4,r.layer.getExtent()]:[3,2]:[3,6];case 1:return(n=u.sent())&&this.fitBounds(n),[3,6];case 2:return o=void 0,r.layer.item?(o=r.layer.item,[3,5]):[3,3];case 3:return i=r.resourceId,[4,this.connector.get("resource.item",null,{id:i})];case 4:o=u.sent(),u.label=5;case 5:a.a.utils.getNgwResourceExtent(o,this.connector).then((function(t){t&&s.fitBounds(t)})),u.label=6;case 6:return[2]}}))}))},e.prototype.onLoad=function(e){return void 0===e&&(e="ngw-map:create"),t.prototype.onLoad.call(this,e)},e.prototype.removeLayer=function(e){var r=this.getLayer(e);if(r){var n=this.getLayerId(r);n&&delete this._ngwLayers[n],t.prototype.removeLayer.call(this,r)}},e.prototype.enableSelection=function(){var t=this;this.__selectFromNgwRaster||(this.__selectFromNgwRaster=function(e){return t._selectFromNgwRaster(e)},this.__selectFromNgwVector=function(e){return t._selectFromNgwVector(e)},this.emitter.on("click",this.__selectFromNgwRaster),this.emitter.on("layer:click",this.__selectFromNgwVector))},e.prototype.disableSelection=function(){this.__selectFromNgwRaster&&(this.emitter.off("click",this.__selectFromNgwRaster),this.emitter.off("click",this._selectFromNgwVector),this.__selectFromNgwRaster=void 0,this.__selectFromNgwVector=void 0)},e.prototype._isFitFromResource=function(){var t=this._initMapState;return!t.zoom||!t.center},e.prototype._createWebMap=function(){return w(this,void 0,void 0,(function(){var t,e,r,n,o,i,a,s,u=this;return g(this,(function(c){switch(c.label){case 0:return[4,this.create(v({},this.options))];case 1:return c.sent(),this.options.qmsId?(t=void 0,e=void 0,Array.isArray(this.options.qmsId)?(t=this.options.qmsId[0],e=this.options.qmsId[1]):t=Number(this.options.qmsId),r={qmsId:t},e&&(r.id=e),[4,this.addBaseLayer("QMS",r).then((function(t){u.showLayer(t)}))]):[3,3];case 2:c.sent(),c.label=3;case 3:n=[],o=this._isFitFromResource(),this.options.webmapId&&f(n,this.options.webmapId,{fit:o}),this.options.resources&&Array.isArray(this.options.resources)&&this.options.resources.forEach((function(t){var e={};o||(e.fit=!1),f(n,t,{},e)})),i=0,a=n,c.label=4;case 4:return i<a.length?(s=a[i],[4,this.addNgwLayer(s)]):[3,7];case 5:c.sent(),c.label=6;case 6:return i++,[3,4];case 7:return this._emitStatusEvent("ngw-map:create",this),this.enableSelection(),[2]}}))}))},e.prototype._addControls=function(){var t=this;this.options.controls&&this.options.controls.forEach((function(e){var r=e,n={};"string"==typeof e&&t.options.controlsOptions&&t.options.controlsOptions[e]&&void 0!==(n=t.options.controlsOptions[e]).control&&(r=n.control);var o=n.position,i=_(n,["position"]);t.addControl(r,o||"top-left",i)})),this._emitStatusEvent("controls:create")},e.prototype._selectFromNgwVector=function(t){return w(this,void 0,void 0,(function(){var e,r,n,o,i,a,s;return g(this,(function(u){return e=t.layer,r=e.item&&e.item.resource.id,n=t.feature,void 0!==r&&n&&(o=n.id)?(i={id:Number(o),fields:n.properties,label:"#"+r,layerId:Number(r),parent:"",geom:n.geometry},(s={featureCount:1})[r]={featureCount:1,features:[i]},a=s,this._emitStatusEvent("ngw:select",v(v({},a),{resources:[r],sourceType:"vector"})),[2,a]):[2]}))}))},e.prototype._selectFromNgwRaster=function(t){return w(this,void 0,void 0,(function(){var e,r,n,o,i,s,u,c,l,p,f=this;return g(this,(function(h){switch(h.label){case 0:for(r in this._emitStatusEvent("ngw:preselect"),e=[],this._ngwLayers)(n=this._ngwLayers[r].layer).getIdentificationIds&&n.options.selectable&&e.push(n.getIdentificationIds());return[4,Promise.all(e)];case 1:return o=h.sent(),i=[],o.forEach((function(t){t&&t.forEach((function(t){return i.push(t)}))})),i.length?(s=this.options.pixelRadius||10,u=this.getCenter(),c=this.getZoom(),u&&c?(l=40075016.686*Math.abs(Math.cos(180*u[1]/Math.PI))/Math.pow(2,c+8),p=s*l*5e-4,[2,a.a.utils.sendIdentifyRequest(t,{layers:i,connector:this.connector,radius:p}).then((function(e){return f._emitStatusEvent("ngw:select",v(v({},e),{resources:i,sourceType:"raster",event:t})),e}))]):(this._emitStatusEvent("ngw:select",null),[2])):(this._emitStatusEvent("ngw:select",null),[2])}}))}))},e.utils=v(v(v({},i.b.utils),a.a.utils),{fixUrlStr:o.f,deepmerge:o.d}),e.decorators=v({onMapLoad:u},i.b.decorators),e.getIcon=s.a,b([i.b.decorators.onLoad("controls:create"),m("design:type",Function),m("design:paramtypes",[Object,String,Object]),m("design:returntype",Promise)],e.prototype,"addControl",null),b([u(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",Promise)],e.prototype,"addNgwLayer",null),e}(i.b);e.a=I},35:function(t,e,r){"use strict";var n=r(53),o=r(129),i=r(38),a=r(13),s=function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},u=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},c={srs:4326,geom_format:"geojson"};function l(t){var e=t.geom;return{id:t.id,type:"Feature",properties:t.fields,geometry:e}}function p(t){var e=s({},c);return t.connector.get("feature_layer.feature.item",null,s({id:t.resourceId,fid:t.featureId},e))}function f(t){return p(t).then((function(t){return l(t)}))}function h(t){var e=t.filterById[2],r="number"==typeof e?[e]:e.split(",").map((function(t){return Number(t)}));if("eq"!==t.filterById[1]&&"in"!==t.filterById[1])throw new Error("Unable to filter by object id. Except `eq` or `in` operator");var n=r.map((function(e){return p({connector:t.connector,resourceId:t.resourceId,featureId:e})}));return a.a.all(n)}function y(t){var e=s({},c),r=t.connector,n=t.limit,o=t.fields,i=t.intersects,a=t.resourceId,u=t.paramList;return n&&(e.limit=n),o&&(e.fields=o.join()),i&&(e.intersects=i),u&&(e.paramList=u),r.get("feature_layer.feature.collection",null,s({id:a},e))}function d(t){var e=t.filters;return e?function t(e,r,n){void 0===r&&(r=[]),void 0===n&&(n=[]);var o=e.filters,i=e.connector,c=e.resourceId,l="string"==typeof o[0]?o[0]:"all",p=o.filter((function(t){return Array.isArray(t)})),f=function(t){return["fld_"+t[0]+"__"+t[1],t[2]]};if("any"===l)p.forEach((function(o){"id"===o[0]&&r.push(h({filterById:o,connector:i,resourceId:c})),Object(a.b)(o)?r.push(y(s(s({},e),{paramList:u(n,[f(o)])}))):t(s(s({},e),{filters:o}),r,u(n))}));else if("all"===l){var d=p.find((function(t){return"id"===t[0]}));if(d)r.push(h({filterById:d,connector:i,resourceId:c}));else{var v=[],b=[];p.forEach((function(t){Object(a.b)(t)?v.push(f(t)):b.push(t)})),b.length?b.forEach((function(o){t(s(s({},e),{filters:o}),r,u(n,v))})):r.push(y(s(s({},e),{paramList:u(n,v)})))}}return a.a.all(r).then((function(t){var r=t.reduce((function(t,e){return t.concat(e)}),[]);return e.limit?r.splice(0,e.limit):r}))}(s(s({},t),{filters:e})):y(t).then((function(t){return e?t.filter((function(t){var r=t.fields;r&&Object(a.g)(r,e)})):t}))}function v(t){return d(t).then((function(t){var e=[];return t.forEach((function(t){e.push(l(t))})),{type:"FeatureCollection",features:e}}))}var b=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},m=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function w(t,e){return b(this,void 0,void 0,(function(){var r,n,o;return m(this,(function(i){switch(i.label){case 0:return r=t.keyname,(n=t.resourceId)||!r?[3,2]:[4,e.getResourceByKeyname(r)];case 1:o=i.sent(),n=o.resource.id,i.label=2;case 2:return[2,n]}}))}))}var g,_=(g=function(t,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),I=function(){return(I=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},x=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},O=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function L(t,e,r){return x(this,void 0,void 0,(function(){var n,o,a,s,u,c,l,p,f=this;return O(this,(function(h){switch(h.label){case 0:return n=e.mapAdapter.layerAdapters.GEOJSON,a=!1,[4,w(t,r)];case 1:return u=h.sent(),c=function(t,e){return x(f,void 0,void 0,(function(){return O(this,(function(n){switch(n.label){case 0:return s={filters:t,options:e},[4,o=v(I({resourceId:u,filters:t,connector:r},e))];case 1:return[2,n.sent()]}}))}))},l=function(){o&&(o.cancel(),o=void 0)},p=function(e){var r={data:e};return t.id&&(r.id=t.id),i.b.utils.updateGeoJsonAdapterOptions(r)},[2,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return _(e,t),e.prototype.addLayer=function(e){return x(this,void 0,void 0,(function(){var r,n,o;return O(this,(function(i){switch(i.label){case 0:return r={},e.data?[3,2]:[4,c(e.propertiesFilter,{limit:e.limit})];case 1:r=i.sent(),i.label=2;case 2:return n=p(r),(o=I(I({},e),n)).data&&0===Object.keys(o.data).length&&(o.data=void 0),[2,t.prototype.addLayer.call(this,o)]}}))}))},e.prototype.beforeRemove=function(){l()},e.prototype.updateLayer=function(){return x(this,void 0,void 0,(function(){var t,e,r,n;return O(this,(function(o){switch(o.label){case 0:return e=(t=s||{}).filters,r=t.options,[4,c(e,r)];case 1:return n=o.sent(),this.setData&&this.setData(n),[2]}}))}))},e.prototype.propertiesFilter=function(t,e){return x(this,void 0,void 0,(function(){var r;return O(this,(function(n){switch(n.label){case 0:return l(),this.filter&&a?(this.filter((function(e){return!e.feature||!e.feature.properties||i.b.utils.propertiesFilter(e.feature.properties,t)})),[3,3]):[3,1];case 1:return this.setData?(this.clearLayer&&this.clearLayer(),[4,c(t,e)]):[3,3];case 2:r=n.sent(),this.setData(r),n.label=3;case 3:return[2]}}))}))},e.prototype.removeFilter=function(){s=void 0,this.propertiesFilter([]),this.filter&&this.filter((function(){return!0}))},e}(n)]}}))}))}var E=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),k=function(){return(k=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},P=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},S=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function j(t,e,r,n){return P(this,void 0,void 0,(function(){var o,i,a,s;return S(this,(function(u){switch(u.label){case 0:return"IMAGE"===(o=t.adapter||"IMAGE")&&(i=e.getLayerAdapters(),!i||i.IMAGE||(o="TILE")),"IMAGE"!==o&&"TILE"!==o&&"MVT"!==o?[3,2]:(a=e.mapAdapter.layerAdapters[o],[4,w(t,n)]);case 1:return s=u.sent(),[2,function(n){function o(o,i){var a=n.call(this,o,i)||this;a.map=o,a.resourceId=s;var u=it(t,e,r);if(u)if(u.resourceId){var c=k(k({},u),{resourceId:u.resourceId});a.options=k(k({},a.options),c)}else{var l=u;a.options=k(k({},a.options),l)}return a}return E(o,n),o.prototype.addLayer=function(t){return n.prototype.addLayer.call(this,k(k({},this.options),t))},o.prototype.getIdentificationIds=function(){return P(this,void 0,void 0,(function(){var t;return S(this,(function(e){return(t=this.item&&this.item.resource.parent.id)?[2,[t]]:[2]}))}))},o}(a)];case 2:throw new Error(o+" not supported yet. Only TILE")}}))}))}var M=r(224),N=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),A=function(){return(A=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},T=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},R=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},C=function(t){function e(r,n,o,i){var a=t.call(this,A(A({},e.options),o))||this;if(a.webMap=r,a._rootDescendantsCount=0,i&&a.tree.setParent(i),a.item=n,"root"===a.item.item_type)a._rootDescendantsCount=a._sumUp(a.item.children);else{var s=a.tree.getRoot();s&&(a._rootDescendantsCount=s._rootDescendantsCount)}return a.initProperties(),a._init(n),a}return N(e,t),e.prototype.initItem=function(t){return T(this,void 0,void 0,(function(){var r,n,o,i,a,s,u,c,l,p=this;return R(this,(function(f){switch(f.label){case 0:return r=t._layer,n=t,"group"!==t.item_type&&"root"!==t.item_type?[3,1]:(t.children&&t.children.length&&t.children.reverse().forEach((function(t){var r=new e(p.webMap,t,p.options,p);p.tree.addChild(r)})),[3,3]);case 1:return"layer"!==t.item_type?[3,3]:(o=t.adapter||t.layer_adapter.toUpperCase(),i=t.layer_max_scale_denom?this._mapScaleToZoomLevel(t.layer_max_scale_denom):this.webMap.options.maxZoom,a=t.layer_min_scale_denom?this._mapScaleToZoomLevel(t.layer_min_scale_denom):this.webMap.options.minZoom,s=A(A({maxZoom:i,minZoom:a,minScale:t.layer_min_scale_denom,maxScale:t.layer_max_scale_denom},t),{headers:this.options.headers}),this.options.order&&(u=this.options.drawOrderEnabled?this._rootDescendantsCount-t.draw_order_position:this.id,s.order=Number((0|this.options.order)+"."+u)),[4,this.webMap.addLayer(o,s)]);case 2:r=f.sent(),f.label=3;case 3:return r&&(n._layer=r,this.layer=r,this.properties&&"layer"===t.item_type&&t.layer_enabled&&this.properties.property("visibility").set(!0),"number"==typeof(c="layer"===t.item_type&&t.layer_transparency)&&(l=(100-c)/100,this.webMap.setLayerOpacity(r,l))),[2]}}))}))},e.prototype.bringToFront=function(){},e.prototype.fit=function(){"layer"===this.item.item_type&&console.log(this.item)},e.prototype._mapScaleToZoomLevel=function(t){return dt(t)},e.prototype._init=function(t){return T(this,void 0,void 0,(function(){return R(this,(function(e){switch(e.label){case 0:return[4,this.initItem(t)];case 1:return e.sent(),this.emitter.emit("init"),[2]}}))}))},e.prototype._sumUp=function(t,e){void 0===e&&(e=0);for(var r=0,n=t;r<n.length;r++){var o=n[r];"layer"===o.item_type?(e+=1,o.draw_order_position=o.draw_order_position||e):"group"===o.item_type&&(e=this._sumUp(o.children,e))}return e},e.options={properties:[{type:"boolean",name:"visibility",getProperty:function(t){if(t){if("group"===t.item.item_type)return!0;if("layer"===t.item.item_type)return t.item.layer_enabled;if("root"===t.item.item_type)return!0}return!1},onSet:function(t,e,r){r&&r.layer&&"layer"===r.item.item_type&&(t?r.webMap.showLayer(r.layer):r.webMap.hideLayer(r.layer),r.item.layer_enabled=t)}}]},e}(M.a),G=r(41),q=function(){return(q=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},F=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},U=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Q=function(){function t(t,e){this.map=t,this.options=e,this.pixelRadius=10,this.emitter=new G.EventEmitter;var r=e.resourceId;if(Array.isArray(r)?(this.resourceId=r[0],this.options.id=r[1]):this.resourceId=r,!this.resourceId)throw new Error("NGW `resourceId` is not defined")}return t.prototype.addLayer=function(t){return F(this,void 0,void 0,(function(){var e,r,n=this;return U(this,(function(o){switch(o.label){case 0:return this.options=q(q({},this.options),t),e=this,[4,this._getWebMapLayerItem()];case 1:return e.layer=o.sent(),this.options.identification?[4,this._getWebMapIds()]:[3,3];case 2:(r=o.sent())&&(this._webmapLayersIds=r,this.$$onMapClick=function(t){return n._onMapClick(t)},this.options.webMap.emitter.on("click",this.$$onMapClick)),o.label=3;case 3:return[2,this.layer]}}))}))},t.prototype.removeLayer=function(){var t=this.options.webMap.mapAdapter;this.$$onMapClick&&this.options.webMap.emitter.off("click",this.$$onMapClick),this.getDependLayers().forEach((function(e){"layer"in e&&t.removeLayer(e.layer.layer)})),this.$$onMapClick=void 0,delete this.options,delete this.layer,delete this.response,delete this._webmapLayersIds},t.prototype.showLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!0)},t.prototype.hideLayer=function(){this.layer&&this.layer.properties&&this.layer.properties.property("visibility").set(!1)},t.prototype.getExtent=function(){var t=this.response&&this.response.webmap;if(t)return st(t)},t.prototype.getDependLayers=function(){return this.layer&&this.layer.tree.getDescendants()||[]},t.prototype.getIdentificationIds=function(){return F(this,void 0,void 0,(function(){var t,e;return U(this,(function(r){switch(r.label){case 0:return t=[],(e=this._webmapLayersIds)?[3,2]:[4,this._getWebMapIds()];case 1:e=r.sent(),this._webmapLayersIds=e,r.label=2;case 2:return e&&e.length&&this.getDependLayers().sort((function(t,e){return t.id-e.id})).forEach((function(e){var r=e.item,n=r.parentId;if(void 0!==n&&"layer"===r.item_type){var o=e.properties.property("visibility");o.get()&&!o.isBlocked()&&t.push(n)}})),[2,t]}}))}))},t.prototype._getWebMapLayerItem=function(){return F(this,void 0,void 0,(function(){var t,e=this;return U(this,(function(r){switch(r.label){case 0:return this.resourceId?[4,this.getWebMapConfig(this.resourceId)]:[3,2];case 1:if((t=r.sent())&&t.root_item)return[2,new Promise((function(r){var n={};if(e.options.connector&&e.options.connector.options.auth){var o=e.options.connector.getAuthorizationHeaders();o&&(n.headers=o)}n.order=e.options.order,n.drawOrderEnabled=t.draw_order_enabled;var i=new C(e.options.webMap,t.root_item,n);i.emitter.on("init",(function(){return r(i)}))}))];r.label=2;case 2:return[2]}}))}))},t.prototype.getWebMapConfig=function(t){return F(this,void 0,void 0,(function(){var e,r;return U(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.options.connector.get("resource.item",null,{id:t})];case 1:return e=n.sent(),this.response=e,(r=e.webmap)?(this._updateItemsParams(r.root_item,this.options.webMap,e),[2,r]):[3,3];case 2:throw n.sent();case 3:return[2]}}))}))},t.prototype._updateItemsParams=function(t,e,r){var n=this;if(t)if("group"===t.item_type||"root"===t.item_type)t.children&&(t.children=t.children.map((function(t){return n._updateItemsParams(t,e,r)}))),"root"===t.item_type&&(t.display_name=r.resource.display_name);else if("layer"===t.item_type){var o=Object(a.f)(this.options.baseUrl+"/api/component/render/image"),i=t.layer_style_id;t.url=o,t.resourceId=i,t.updateWmsParams=function(t){return ot(t,i)},t=q(q({},t),it({adapter:t.layer_adapter.toUpperCase(),resourceId:i},e,this.options.baseUrl))}return t},t.prototype._getWebMapIds=function(){return F(this,void 0,void 0,(function(){var t,e,r,n=this;return U(this,(function(o){switch(o.label){case 0:return(t=this.layer)&&"root"===t.item.item_type?(e=t.tree.getDescendants(),r=[],e.forEach((function(t){var e=t.item;if("layer"===e.item_type){var o=e.layer_style_id,i=n.options.connector.get("resource.item",{},{id:o}).then((function(t){if(t){var r=Number(t.resource.parent.id);return e.parentId=r,r}}));r.push(i)}})),[4,Promise.all(r)]):[3,2];case 1:return[2,o.sent().filter((function(t){return void 0!==t}))];case 2:return[2]}}))}))},t.prototype._sendIdentifyRequest=function(t){var e=this;if(this._webmapLayersIds)return ht(t,{layers:this._webmapLayersIds,connector:this.options.connector,radius:this.pixelRadius}).then((function(r){return e.emitter.emit("identify",{ev:t,data:r}),r}))},t.prototype._onMapClick=function(t){this._sendIdentifyRequest(t)},t}(),D=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),B=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},W=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};var J=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},Z=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},z=function(){function t(){}return t.prototype.getExtent=function(){return J(this,void 0,void 0,(function(){var t;return Z(this,(function(e){switch(e.label){case 0:return this._extent?[2,this._extent]:this.item?(t=this,[4,ct(this.item,this.connector).then()]):[3,2];case 1:return t._extent=e.sent(),[2,this._extent];case 2:return[2]}}))}))},t}(),$=function(){return($=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},H=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},V=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},K=["mapserver_style","qgis_vector_style","qgis_raster_style","raster_style"];function X(t,e,r,n,o){return H(this,void 0,void 0,(function(){var i,a;return V(this,(function(s){switch(s.label){case 0:return[4,o.get("resource.collection",null,{parent:t})];case 1:return i=s.sent(),(a=i&&i[0])?[2,Y($($({},e),{resourceId:a.resource.id}),r,n,o)]:[2]}}))}))}function Y(t,e,r,n){return H(this,void 0,void 0,(function(){var i,a,s,u,c,l;return V(this,(function(p){switch(p.label){case 0:return p.trys.push([0,4,,5]),s=t.adapter,[4,w(t,n)];case 1:return(u=p.sent())?[4,n.get("resource.item",null,{id:u})]:[3,3];case 2:if(!(a=p.sent()))throw new Error("Can't add NGW layer because Resource item is not found");if(c=$($({},t),{resourceId:u}),a.webmap)i=function(t,e,r,n){return B(this,void 0,void 0,(function(){var o;return W(this,(function(i){switch(i.label){case 0:return[4,w(t,n)];case 1:return o=i.sent(),[2,function(t){function i(i){return t.call(this,i,{webMap:e,resourceId:o,baseUrl:r,connector:n})||this}return D(i,t),i}(Q)]}}))}))}(c,e,r,n);else if(-1!==K.indexOf(a.resource.cls))"GEOJSON"===s?(l=$($({},t),{resourceId:a.resource.parent.id}),i=L(l,e,n)):i=j(c,e,r,n);else if("vector_layer"===a.resource.cls)if(void 0!==s&&"GEOJSON"!==s){if("MVT"!==s)return[2,X(a.resource.id,c,e,r,n)];i=j(c,e,r,n)}else i=L(c,e,n);else{if("raster_layer"===a.resource.cls)return[2,X(a.resource.id,c,e,r,n)];a.basemap_layer&&a.basemap_layer.qms&&(i=Promise.resolve(o.a.utils.createQmsAdapter(e))).then((function(t){if(t&&a&&a.basemap_layer&&a.basemap_layer.qms){var e=JSON.parse(a.basemap_layer.qms);t.prototype.qms=e,t.prototype.baseLayer=!0}}))}p.label=3;case 3:return[3,5];case 4:return p.sent(),[3,5];case 5:return i?[2,i.then((function(t){if(t){var e=t;return e.prototype.item=a,e.prototype.connector=n,r=e,[z].forEach((function(t){Object.getOwnPropertyNames(t.prototype).forEach((function(e){var n=Object.getOwnPropertyDescriptor(t.prototype,e);n&&Object.defineProperty(r.prototype,e,n)}))})),e}var r}))]:[2]}}))}))}var tt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),et=function(){return(et=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},rt=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},nt=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function ot(t,e){return{resource:e,extent:t.bbox,size:t.width+","+t.height,timestamp:Date.now()}}function it(t,e,r){var n=t.adapter||"IMAGE",o=e.getLayerAdapters(),i=!o||o.IMAGE,a=t.resourceId;if(a){if("IMAGE"===n){if(i)return{url:r+"/api/component/render/image",resourceId:a,headers:t.headers,updateWmsParams:function(t){return ot(t,a)}};n="TILE"}if("MVT"===n)return{url:r+"/api/component/feature_layer/mvt?x={x}&y={y}&z={z}&resource="+a+"&simplification="+(t.simplification||0)};if("TILE"===n)return{url:r+"/api/component/render/tile?z={z}&x={x}&y={y}&resource="+a,adapter:n}}else console.log("Options `resourceId` not set")}function at(t,e,r,n){var o=n.getAuthorizationHeaders();return o&&(t.headers=o),Y(t,e,r,n)}function st(t){var e=t.extent_bottom,r=t.extent_left,n=t.extent_top,o=t.extent_right;if(e&&r&&n&&o){var i=[r,e,o,n];return i[3]>82&&(i[3]=82),i[1]<-82&&(i[1]=-82),i}}function ut(t,e){return e.get("layer.extent",name,{id:t}).then((function(t){if(t){var e=t.extent,r=e.maxLat,n=e.maxLon,o=e.minLat;return[e.minLon,o,n,r]}}))}function ct(t,e){return rt(this,void 0,void 0,(function(){var r;return nt(this,(function(n){return t.webmap?[2,st(t.webmap)]:-1!==(r=t.resource).cls.indexOf("style")?[2,e.get("resource.item",null,{id:r.parent.id}).then((function(t){return ut(t.resource.id,e)}))]:[2,ut(r.id,e)]}))}))}var lt,pt=Math.PI/180,ft=180/Math.PI;function ht(t,e){var r=function(t,e,r,n){void 0===r&&(r=10),void 0===n&&(n=6);for(var o=r/3963*ft,i=o/Math.cos(e*pt),a=[],s=0;s<n+1;s++){var u=Math.PI*(s/(n/2)),c=t+i*Math.cos(u),l=e+o*Math.sin(u);a.push([c,l])}return a}(t.latLng.lng,t.latLng.lat,e.radius),n=[];r.forEach((function(t){var e=function(t,e){var r=20037508.34*t/180,n=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return[r,n=20037508.34*n/180]}(t[0],t[1]),r=e[0],o=e[1];n.push(r+" "+o)}));var o={geom:"POLYGON(("+n.join(", ")+"))",srs:3857,layers:e.layers};return e.connector.post("feature_layer.identify",{data:o})}function yt(){if(void 0===lt){var t=document.createElement("div");t.style.cssText="position: absolute;  left: -100%;  top: -100%;  width: 100cm;",document.body.appendChild(t);var e=t.offsetWidth;document.body.removeChild(t),lt=e}return lt}function dt(t,e){if(void 0===e&&(e=104),e){var r=e;return function(t){return Math.log(t/256)/Math.LN2}(yt()*function(t){return 12756274*Math.PI*Math.cos(t*Math.PI/180)}(r)/t)}return Math.round(Math.log(591657550.5/(t/2))/Math.log(2))}var vt=function(){return(vt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function bt(t,e){var r;void 0===e&&(e=!1);var n=[],o=[];for(var i in t){var a=Number(i);isNaN(a)||n.push(a)}var s=t.resources;s&&n.sort((function(t,e){return s.indexOf(t)-s.indexOf(e)}));for(var u=0;u<n.length;u++){var c=t[i=n[u]].features,l=Number(i),p=c[0];if(p&&(r={featureId:p.id,resourceId:l},o.push(r),!e))break}return o}function mt(t){var e=t.connector,r=t.identify;for(var n in r){var o=Number(n);if(!isNaN(o)){var i=r[n].features.find((function(t){return t.geom}));if(i&&i.geom){var a=i.geom;return l(vt(vt({},i),{geom:a}))}}}var s=bt(r);if(s)return f(vt({connector:e},s[0]))}var wt=function(){return(wt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},gt=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},_t=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},It=function(){function t(t){if(this.options=t,this.options.connector)this.url=this.options.connector.options.baseUrl,this.connector=this.options.connector;else{if(!this.options.baseUrl)throw new Error("url is not defined");this.url=this.options.baseUrl,this.connector=new n.a({baseUrl:this.url,auth:this.options.auth})}}return t.prototype.onLoadSync=function(t){return gt(this,void 0,void 0,(function(){var e,r,n,o,i;return _t(this,(function(a){switch(a.label){case 0:if(!this.options.resourceId||!this.url)return[3,4];if(!(e=[this.options.resourceId]).length)return[3,4];r=0,n=e,a.label=1;case 1:return r<n.length?(o=n[r],i={resourceId:o,connector:this.connector,baseUrl:this.url,webMap:t},[4,t.addLayer(Q,wt({visibility:!0,fit:!0,identification:this.options.identification,pixelRadius:this.options.pixelRadius},i))]):[3,4];case 2:return[2,a.sent()];case 3:return r++,[3,1];case 4:return[2]}}))}))},t.prototype.getLayerAdapters=function(){return Promise.resolve([this._getLayerAdapter()])},t.prototype._getLayerAdapter=function(){var t=this;return{name:"WEBMAP",createAdapter:function(e){return Promise.resolve(t._createAdapter(e))}}},t.prototype._createAdapter=function(t){var e,r=this.connector,n=this.url;return e={webMap:t,connector:r,baseUrl:n},function(t){function r(r,n){return n=et(et({},e),n),t.call(this,r,n)||this}return tt(r,t),r}(Q)},t.utils={addNgwLayer:at,getNgwResourceExtent:ct,sendIdentifyRequest:ht,pixelsInMeterWidth:yt,getNgwLayerFeature:f,getNgwLayerFeatures:v,getNgwLayerItems:d,getNgwLayerItem:p,getIdentifyGeoJson:mt,getIdentifyGeoJsonParams:bt,createGeoJsonFeature:l,setScaleRatio:dt},t.updateWmsParams=ot,t.getLayerAdapterOptions=it,t.addNgwLayer=at,t}();e.a=It},53:function(t,e,r){"use strict";var n=r(13),o=r(41);var i=/\{ *([\w_-]+) *\}/g;function a(t,e){return t.replace(i,(function(t,r){var n=e[r];if(void 0===n)throw new Error("No value provided for letiable "+t);return"function"==typeof n&&(n=n(e)),n}))}var s=function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},u=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},c=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},l=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},p=function(){function t(t){this.options=t,this.emitter=new o.EventEmitter,this.routeStr="/api/component/pyramid/route",this._loadingQueue={},this._loadingStatus={},this._keynames={},this.options.route&&(this.routeStr=this.options.route)}return t.prototype.setNextGisWeb=function(t){this.logout(),this.options.baseUrl=t},t.prototype.connect=function(){return u(this,void 0,n.a,(function(){var t,e,r,n=this;return c(this,(function(o){switch(o.label){case 0:return this.route?[2,Promise.resolve(this.route)]:[3,1];case 1:return this.options.auth?(t=this.options.auth,e=t.login,r=t.password,e&&r?[4,this.getUserInfo({login:e,password:r})]:[3,3]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.makeQuery(this.routeStr,{},{}).then((function(t){return n.route=t,t}))];case 4:return[2,o.sent()]}}))}))},t.prototype.login=function(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){return this.logout(),[2,this.getUserInfo(t)]}))}))},t.prototype.logout=function(){this._rejectLoadingQueue(),this._loadingStatus={},this.options.auth=void 0,this.route=void 0,this.user=void 0,this.emitter.emit("logout")},t.prototype.getUserInfo=function(t){var e=this;if(this.user&&this.user.id)return n.a.resolve(this.user);t&&(this.options.auth=t);var r={headers:this.getAuthorizationHeaders(t)};return this.makeQuery("/api/component/auth/current_user",{},r).then((function(t){return e.user=t,e.emitter.emit("login",t),t})).catch((function(t){throw e.emitter.emit("login:error",t),t}))},t.prototype.getAuthorizationHeaders=function(t){var e=this.makeClientId(t);if(e)return{Authorization:"Basic "+e}},t.prototype.makeClientId=function(t){if(t=t||this.options.auth){var e=t.login,r=t.password;return window.btoa(unescape(encodeURIComponent(e+":"+r)))}},t.prototype.getResourceByKeyname=function(t){return u(this,void 0,void 0,(function(){var e,r;return c(this,(function(n){switch(n.label){case 0:return(e=this._keynames.keyname)?[3,2]:[4,this.get("resource.search",null,{keyname:t})];case 1:r=n.sent(),(e=r[0])&&(this._keynames[t]=e),n.label=2;case 2:return[2,e]}}))}))},t.prototype.getResourceChildren=function(t){return u(this,void 0,void 0,(function(){var e,r;return c(this,(function(n){switch(n.label){case 0:if(e=t.resourceId,!t.keyname&&!t.resourceId)throw new Error("No keyname or resourceId is set");return t.keyname?[4,this.getResourceByKeyname(t.keyname)]:[3,2];case 1:r=n.sent(),e=r.resource.id,n.label=2;case 2:return[4,this.get("resource.collection",null,{parent:e})];case 3:return[2,n.sent()]}}))}))},t.prototype.request=function(t,e,r){return void 0===e&&(e={}),u(this,void 0,n.a,(function(){var o,i,s,u,p,f,h,y,d;return c(this,(function(c){switch(c.label){case 0:return[4,this.connect()];case 1:if(o=c.sent(),i=o&&o[t]){if(i=l(i),s=i.shift(),i.length){for(u={},p=0;p<i.length;p++)if(f=i[p],u[p]="{"+f+"}",void 0===e[f])throw new Error("`"+f+"` url api argument is not specified");s&&(s=a(s,u))}if(e){for(d in h=[],y=e.paramList,Array.isArray(y)&&(delete e.paramList,y.forEach((function(t){h.push(t[0]+"="+t[1])}))),e)-1===i.indexOf(d)&&h.push(d+"="+e[d]);h.length&&(s=s+"?"+h.join("&"))}if(s)return[2,this.makeQuery(s,e,r)];throw new Error("request url is not set")}return[2,n.a.resolve({})]}}))}))},t.prototype.post=function(t,e,r){return(e=e||{}).method="POST",e.nocache=!0,this.request(t,r,e)},t.prototype.get=function(t,e,r){return(e=e||{}).method="GET",e.nocache=!0,this.request(t,r,e)},t.prototype.patch=function(t,e,r){return(e=e||{}).method="PATCH",e.nocache=!0,this.request(t,r,e)},t.prototype.put=function(t,e,r){return(e=e||{}).method="PUT",e.nocache=!0,this.request(t,r,e)},t.prototype.delete=function(t,e,r){return(e=e||{}).method="DELETE",e.nocache=!0,this.request(t,r,e)},t.prototype.makeQuery=function(t,e,r){var o=this;if(void 0===r&&(r={}),t=(this.options.baseUrl?this.options.baseUrl:"")+t)return e&&(t=a(t,e)),t=t.replace(/([^:]\/)\/+/g,"$1"),!this._loadingStatus[t]||r.nocache?(this._loadingStatus[t]=!0,this._getJson(t,r).then((function(e){return o._loadingStatus[t]=!1,o._executeLoadingQueue(t,e),e})).catch((function(e){throw o._loadingStatus[t]=!1,o._executeLoadingQueue(t,e,!0),o.emitter.emit("error",e),e}))):(this._loadingStatus[t]=!1,new n.a((function(e,r){o._setLoadingQueue(t,e,r)})));throw new Error("No `url` parameter set for option "+name)},t.prototype._setLoadingQueue=function(t,e,r){this._loadingQueue[t]=this._loadingQueue[t]||{name:t,waiting:[]},this._loadingQueue[t].waiting.push({resolve:e,reject:r,timestamp:new Date})},t.prototype._rejectLoadingQueue=function(){for(var t in this._loadingQueue){this._loadingQueue[t].waiting.forEach((function(t){t.reject()})),delete this._loadingQueue[t]}},t.prototype._executeLoadingQueue=function(t,e,r){var n=this._loadingQueue[t];if(n){for(var o=0;o<n.waiting.length;o++){var i=n.waiting[o];r?i.reject&&i.reject():i.resolve(e)}n.waiting=[]}},t.prototype._getJson=function(t,e){var r=this,o=[];return e.responseType=e.responseType||"json",new n.a((function(n,i){r.user&&((e=e||{}).headers=s(s({},r.getAuthorizationHeaders()),e.headers)),function(t,e,r,n,o){void 0===r&&(r={}),r.method=r.method||"GET";var i=new XMLHttpRequest;i.open(r.method||"GET",t,!0),"blob"===r.responseType&&(i.responseType=r.responseType);var a=function(t){void 0===t&&(t=!1);var o=t?n:e;if("blob"===r.responseType)o(i.response);else if(i.responseText)try{o(JSON.parse(i.responseText))}catch(t){o(i.responseText)}else n({message:""})};i.onreadystatechange=function(){4===i.readyState&&200===i.status||3===i.readyState&&201===i.status?a():3===i.readyState&&400===i.status?a():4===i.readyState&&500===i.status?a():4===i.readyState&&401===i.status?n(i.statusText):4===i.readyState&&n("request error")},i.onerror=function(t){n(t)},i.upload.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;r.onProgress&&r.onProgress(e)}};var s,u=r.headers;if(u)for(var c in u){var l=u[c];"string"==typeof l&&i.setRequestHeader(c,l)}if(void 0!==r.withCredentials&&(i.withCredentials=r.withCredentials),r.file){if((s=new FormData).append("file",r.file),r.data)for(var p in s)s.append(p,s[p])}else s=r.data?"string"==typeof r.data?r.data:JSON.stringify(r.data):null;o&&o.push((function(){i.abort()})),i.send(s)}(t,n,e,i,o)}),(function(){o.forEach((function(t){return t()}))}))},t}();e.a=p}}]);
//# sourceMappingURL=main~640af231-f9e8e9b.js.map